----item----
version: 1
id: {5488599B-2DF6-48DD-894F-1C046ECB729F}
database: master
path: /sitecore/media library/Themes/GPN/Corporate/CorporateDummySite/Custom/Animation Pack/scripts/jqueryscrollmagic
parent: {05052A73-41F1-4310-A3ED-8396CB432BA0}
name: jqueryscrollmagic
master: {00000000-0000-0000-0000-000000000000}
template: {962B53C4-F93B-4DF9-9821-415C867B8903}
templatekey: File

----field----
field: {40E50ED9-BA07-4702-992E-A912738D32DC}
name: Blob
key: blob
content-length: 131328

LyoNClNjcm9sbE1hZ2ljIHYxLjMuMA0KVGhlIGpRdWVyeSBwbHVnaW4gZm9yIGRvaW5nIG1hZ2ljYWwgc2Nyb2xsIGludGVyYWN0aW9ucy4NCihjKSAyMDE0IEphbiBQYWVwa2UgKEBqYW5wYWVwa2UpDQpMaWNlbnNlICYgSW5mbzogaHR0cDovL2phbnBhZXBrZS5naXRodWIuaW8vU2Nyb2xsTWFnaWMNCgkNCkluc3BpcmVkIGJ5IGFuZCBwYXJ0aWFsbHkgYmFzZWQgb24gU1VQRVJTQ1JPTExPUkFNQSBieSBKb2huIFBvbGFjZWsgKEBqb2hucG9sYWNlaykNCmh0dHA6Ly9qb2hucG9sYWNlay5naXRodWIuY29tL3N1cGVyc2Nyb2xsb3JhbWEvDQoNClBvd2VyZWQgYnkgdGhlIEdyZWVuc29jayBUd2VlbmluZyBQbGF0Zm9ybSAoR1NBUCk6IGh0dHA6Ly93d3cuZ3JlZW5zb2NrLmNvbS9qcw0KR3JlZW5zb2NrIExpY2Vuc2UgaW5mbyBhdCBodHRwOi8vd3d3LmdyZWVuc29jay5jb20vbGljZW5zaW5nLw0KKi8KLyoqDQpAb3ZlcnZpZXcJIyNJbmZvDQpAdmVyc2lvbgkxLjMuMA0KQGxpY2Vuc2UJRHVhbCBsaWNlbnNlZCB1bmRlciBNSVQgbGljZW5zZSBhbmQgR1BMLg0KQGF1dGhvcgkJSmFuIFBhZXBrZSAtIGUtbWFpbEBqYW5wYWVwa2UuZGUNCg0KQHRvZG86IGVuaGFuY2VtZW50OiByZW1vdmUgZGVwZW5kZW5jaWVzIGFuZCBtb3ZlIHRvIHBsdWdpbnMgLT4gMi4wDQpAdG9kbzogYnVnOiB3aGVuIGNhc2NhZGluZyBwaW5zIChwaW5uaW5nIG9uZSBlbGVtZW50IG11bHRpcGxlIHRpbWVzKSBhbmQgbGF0ZXIgcmVtb3ZpbmcgdGhlbSB3aXRob3V0IHJlc2V0LCBwb3NpdGlvbmluZyBlcnJvcnMgb2NjdXIuDQpAdG9kbzogYnVnOiBoYXZpbmcgbXVsdGlwbGUgc2Nyb2xsIGRpcmVjdGlvbnMgd2l0aCBjYXNjYWRlZCBwaW5zIGRvZXNuJ3Qgd29yayAob25lIHNjcm9sbCB2ZXJ0aWNhbCwgb25lIGhvcml6b250YWwpDQpAdG9kbzogZmVhdHVyZTogb3B0aW1pemUgcGVyZm9ybWFuY2Ugb24gZGVidWcgcGx1Z2luIChodWdlIGRyYXdiYWNrcywgd2hlbiB1c2luZyBtYW55IHNjZW5lcykNCiovDQooZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHsNCglpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7DQoJCS8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS4NCgkJZGVmaW5lKFsnanF1ZXJ5JywgJ1R3ZWVuTWF4JywgJ1RpbWVsaW5lTWF4J10sIGZhY3RvcnkpOw0KCX0gZWxzZSB7DQoJCS8vIEJyb3dzZXIgZ2xvYmFscw0KCQl2YXIgc20gPSBmYWN0b3J5KHJvb3QualF1ZXJ5LCByb290LlR3ZWVuTWF4LCByb290LlRpbWVsaW5lTWF4KTsNCgkJcm9vdC5TY3JvbGxNYWdpYyA9IHNtLkNvbnRyb2xsZXI7DQoJCXJvb3QuU2Nyb2xsU2NlbmUgPSBzbS5TY2VuZTsNCgl9DQp9KHRoaXMsIGZ1bmN0aW9uICgkLCBUd2Vlbk1heCwgVGltZWxpbmVNYXgpIHsNCg0KCS8qKg0KCSAqIFRoZSBtYWluIGNsYXNzIHRoYXQgaXMgbmVlZGVkIG9uY2UgcGVyIHNjcm9sbCBjb250YWluZXIuDQoJICoNCgkgKiBAY2xhc3MNCgkgKiBAZ2xvYmFsDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqIC8vIGJhc2ljIGluaXRpYWxpemF0aW9uDQoJICogdmFyIGNvbnRyb2xsZXIgPSBuZXcgU2Nyb2xsTWFnaWMoKTsNCgkgKg0KCSAqIC8vIHBhc3Npbmcgb3B0aW9ucw0KCSAqIHZhciBjb250cm9sbGVyID0gbmV3IFNjcm9sbE1hZ2ljKHtjb250YWluZXI6ICIjbXlDb250YWluZXIiLCBsb2dsZXZlbDogM30pOw0KCSAqDQoJICogQHBhcmFtIHtvYmplY3R9IFtvcHRpb25zXSAtIEFuIG9iamVjdCBjb250YWluaW5nIG9uZSBvciBtb3JlIG9wdGlvbnMgZm9yIHRoZSBjb250cm9sbGVyLg0KCSAqIEBwYXJhbSB7KHN0cmluZ3xvYmplY3QpfSBbb3B0aW9ucy5jb250YWluZXI9d2luZG93XSAtIEEgc2VsZWN0b3IsIERPTSBvYmplY3Qgb3IgYSBqUXVlcnkgb2JqZWN0IHRoYXQgcmVmZXJlbmNlcyB0aGUgbWFpbiBjb250YWluZXIgZm9yIHNjcm9sbGluZy4NCgkgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnZlcnRpY2FsPXRydWVdIC0gU2V0cyB0aGUgc2Nyb2xsIG1vZGUgdG8gdmVydGljYWwgKGB0cnVlYCkgb3IgaG9yaXpvbnRhbCAoYGZhbHNlYCkgc2Nyb2xsaW5nLg0KCSAqIEBwYXJhbSB7b2JqZWN0fSBbb3B0aW9ucy5nbG9iYWxTY2VuZU9wdGlvbnM9e31dIC0gVGhlc2Ugb3B0aW9ucyB3aWxsIGJlIHBhc3NlZCB0byBldmVyeSBTY2VuZSB0aGF0IGlzIGFkZGVkIHRvIHRoZSBjb250cm9sbGVyIHVzaW5nIHRoZSBhZGRTY2VuZSBtZXRob2QuIEZvciBtb3JlIGluZm9ybWF0aW9uIG9uIFNjZW5lIG9wdGlvbnMgc2VlIHtAbGluayBTY3JvbGxTY2VuZX0uDQoJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLmxvZ2xldmVsPTJdIExvZ2xldmVsIGZvciBkZWJ1Z2dpbmcuIE5vdGUgdGhhdCBsb2dnaW5nIGlzIGRpc2FibGVkIGluIHRoZSBtaW5pZmllZCB2ZXJzaW9uIG9mIFNjcm9sbE1hZ2ljLg0KCQkJCQkJCQkJCQkgKiogYDBgID0+IHNpbGVudA0KCQkJCQkJCQkJCQkgKiogYDFgID0+IGVycm9ycw0KCQkJCQkJCQkJCQkgKiogYDJgID0+IGVycm9ycywgd2FybmluZ3MNCgkJCQkJCQkJCQkJICoqIGAzYCA9PiBlcnJvcnMsIHdhcm5pbmdzLCBkZWJ1Z2luZm8NCgkgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnJlZnJlc2hJbnRlcnZhbD0xMDBdIC0gU29tZSBjaGFuZ2VzIGRvbid0IGNhbGwgZXZlbnRzIGJ5IGRlZmF1bHQsIGxpa2UgY2hhbmdpbmcgdGhlIGNvbnRhaW5lciBzaXplIG9yIG1vdmluZyBhIHNjZW5lIHRyaWdnZXIgZWxlbWVudC4gIA0KCSAJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCSBUaGlzIGludGVydmFsIHBvbGxzIHRoZXNlIHBhcmFtZXRlcnMgdG8gZmlyZSB0aGUgbmVjZXNzYXJ5IGV2ZW50cy4gIA0KCSAJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCQkJCSBJZiB5b3UgZG9uJ3QgdXNlIGN1c3RvbSBjb250YWluZXJzLCB0cmlnZ2VyIGVsZW1lbnRzIG9yIGhhdmUgc3RhdGljIGxheW91dHMsIHdoZXJlIHRoZSBwb3NpdGlvbnMgb2YgdGhlIHRyaWdnZXIgZWxlbWVudHMgZG9uJ3QgY2hhbmdlLCB5b3UgY2FuIHNldCB0aGlzIHRvIDAgZGlzYWJsZSBpbnRlcnZhbCBjaGVja2luZyBhbmQgaW1wcm92ZSBwZXJmb3JtYW5jZS4NCgkgKg0KCSAqLw0KCXZhciBTY3JvbGxNYWdpYyA9IGZ1bmN0aW9uKG9wdGlvbnMpIHsNCg0KCQkvKg0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqIHNldHRpbmdzDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICovDQoJCXZhcg0KCQkJTkFNRVNQQUNFID0gIlNjcm9sbE1hZ2ljIiwNCgkJCURFRkFVTFRfT1BUSU9OUyA9IHsNCgkJCQljb250YWluZXI6IHdpbmRvdywNCgkJCQl2ZXJ0aWNhbDogdHJ1ZSwNCgkJCQlnbG9iYWxTY2VuZU9wdGlvbnM6IHt9LA0KCQkJCWxvZ2xldmVsOiAyLA0KCQkJCXJlZnJlc2hJbnRlcnZhbDogMTAwDQoJCQl9Ow0KDQoJCS8qDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICogcHJpdmF0ZSB2YXJzDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICovDQoNCgkJdmFyDQoJCQlTY3JvbGxNYWdpYyA9IHRoaXMsDQoJCQlfb3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBERUZBVUxUX09QVElPTlMsIG9wdGlvbnMpLA0KCQkJX3NjZW5lT2JqZWN0cyA9IFtdLA0KCQkJX3VwZGF0ZVNjZW5lc09uTmV4dEN5Y2xlID0gZmFsc2UsCQkvLyBjYW4gYmUgYm9vbGVhbiAodHJ1ZSA9PiBhbGwgc2NlbmVzKSBvciBhbiBhcnJheSBvZiBzY2VuZXMgdG8gYmUgdXBkYXRlZA0KCQkJX3Njcm9sbFBvcyA9IDAsDQoJCQlfc2Nyb2xsRGlyZWN0aW9uID0gIlBBVVNFRCIsDQoJCQlfaXNEb2N1bWVudCA9IHRydWUsDQoJCQlfdmlld1BvcnRTaXplID0gMCwNCgkJCV9lbmFibGVkID0gdHJ1ZSwNCgkJCV91cGRhdGVDeWNsZSwNCgkJCV9yZWZyZXNoSW50ZXJ2YWw7DQoNCgkJLyoNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKiBwcml2YXRlIGZ1bmN0aW9ucw0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqLw0KDQoJCS8qKg0KCQkgKiBJbnRlcm5hbCBjb25zdHJ1Y3RvciBmdW5jdGlvbiBvZiBTY3JvbGxNYWdpYw0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIGNvbnN0cnVjdCA9IGZ1bmN0aW9uICgpIHsNCgkJCVNjcm9sbE1hZ2ljLnZlcnNpb24gPSBTY3JvbGxNYWdpYy5jb25zdHJ1Y3Rvci52ZXJzaW9uOw0KCQkJJC5lYWNoKF9vcHRpb25zLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgew0KCQkJCWlmICghREVGQVVMVF9PUFRJT05TLmhhc093blByb3BlcnR5KGtleSkpIHsNCgkJCQkJbG9nKDIsICJXQVJOSU5HOiBVbmtub3duIG9wdGlvbiBcIiIgKyBrZXkgKyAiXCIiKTsNCgkJCQkJZGVsZXRlIF9vcHRpb25zW2tleV07DQoJCQkJfQ0KCQkJfSk7DQoJCQlfb3B0aW9ucy5jb250YWluZXIgPSAkKF9vcHRpb25zLmNvbnRhaW5lcikuZmlyc3QoKTsNCgkJCS8vIGNoZWNrIFNjcm9sbENvbnRhaW5lcg0KCQkJaWYgKF9vcHRpb25zLmNvbnRhaW5lci5sZW5ndGggPT09IDApIHsNCgkJCQlsb2coMSwgIkVSUk9SIGNyZWF0aW5nIG9iamVjdCAiICsgTkFNRVNQQUNFICsgIjogTm8gdmFsaWQgc2Nyb2xsIGNvbnRhaW5lciBzdXBwbGllZCIpOw0KCQkJCXRocm93IE5BTUVTUEFDRSArICIgaW5pdCBmYWlsZWQuIjsgLy8gY2FuY2VsDQoJCQl9DQoJCQlfaXNEb2N1bWVudCA9ICEkLmNvbnRhaW5zKGRvY3VtZW50LCBfb3B0aW9ucy5jb250YWluZXIuZ2V0KDApKTsNCgkJCS8vIHByZXZlbnQgYnViYmxpbmcgb2YgZmFrZSByZXNpemUgZXZlbnQgdG8gd2luZG93DQoJCQlpZiAoIV9pc0RvY3VtZW50KSB7DQoJCQkJX29wdGlvbnMuY29udGFpbmVyLm9uKCdyZXNpemUnLCBmdW5jdGlvbiAoIGUgKSB7DQogICAgICAgICAgZS5zdG9wUHJvcGFnYXRpb24oKTsNCiAgICAgICAgfSk7DQoJCQl9DQoJCQkvLyB1cGRhdGUgY29udGFpbmVyIHNpemUgaW1tZWRpYXRlbHkNCgkJCV92aWV3UG9ydFNpemUgPSBfb3B0aW9ucy52ZXJ0aWNhbCA/IF9vcHRpb25zLmNvbnRhaW5lci5oZWlnaHQoKSA6IF9vcHRpb25zLmNvbnRhaW5lci53aWR0aCgpOw0KCQkJLy8gc2V0IGV2ZW50IGhhbmRsZXJzDQoJCQlfb3B0aW9ucy5jb250YWluZXIub24oInNjcm9sbCByZXNpemUiLCBvbkNoYW5nZSk7DQoNCgkJCV9vcHRpb25zLnJlZnJlc2hJbnRlcnZhbCA9IHBhcnNlSW50KF9vcHRpb25zLnJlZnJlc2hJbnRlcnZhbCk7DQoJCQlpZiAoX29wdGlvbnMucmVmcmVzaEludGVydmFsID4gMCkgew0KCQkJCV9yZWZyZXNoSW50ZXJ2YWwgPSB3aW5kb3cuc2V0SW50ZXJ2YWwocmVmcmVzaCwgX29wdGlvbnMucmVmcmVzaEludGVydmFsKTsNCgkJCX0NCg0KCQkJLy8gc3RhcnQgY2hlY2tpbmcgZm9yIGNoYW5nZXMNCgkJCV91cGRhdGVDeWNsZSA9IGFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sodXBkYXRlU2NlbmVzKTsNCgkJCWxvZygzLCAiYWRkZWQgbmV3ICIgKyBOQU1FU1BBQ0UgKyAiIGNvbnRyb2xsZXIgKHYiICsgU2Nyb2xsTWFnaWMudmVyc2lvbiArICIpIik7DQoJCX07DQoNCgkJLyoqDQoJCSogRGVmYXVsdCBmdW5jdGlvbiB0byBnZXQgc2Nyb2xsIHBvcyAtIG92ZXJ3cml0ZWFibGUgdXNpbmcgYFNjcm9sbE1hZ2ljLnNjcm9sbFBvcyhuZXdGdW5jdGlvbilgDQoJCSogQHByaXZhdGUNCgkJKi8NCgkJdmFyIGdldFNjcm9sbFBvcyA9IGZ1bmN0aW9uICgpIHsNCgkJCXJldHVybiBfb3B0aW9ucy52ZXJ0aWNhbCA/IF9vcHRpb25zLmNvbnRhaW5lci5zY3JvbGxUb3AoKSA6IF9vcHRpb25zLmNvbnRhaW5lci5zY3JvbGxMZWZ0KCk7DQoJCX07DQoJCS8qKg0KCQkqIERlZmF1bHQgZnVuY3Rpb24gdG8gc2V0IHNjcm9sbCBwb3MgLSBvdmVyd3JpdGVhYmxlIHVzaW5nIGBTY3JvbGxNYWdpYy5zY3JvbGxUbyhuZXdGdW5jdGlvbilgDQoJCSogQHByaXZhdGUNCgkJKi8NCgkJdmFyIHNldFNjcm9sbFBvcyA9IGZ1bmN0aW9uIChwb3MpIHsNCgkJCWlmIChfb3B0aW9ucy52ZXJ0aWNhbCkgew0KCQkJCV9vcHRpb25zLmNvbnRhaW5lci5zY3JvbGxUb3AocG9zKTsNCgkJCX0gZWxzZSB7DQoJCQkJX29wdGlvbnMuY29udGFpbmVyLnNjcm9sbExlZnQocG9zKTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJKiBIYW5kbGUgdXBkYXRlcyBpbiBjeWNsZXMgaW5zdGVhZCBvZiBvbiBzY3JvbGwgKHBlcmZvcm1hbmNlKQ0KCQkqIEBwcml2YXRlDQoJCSovDQoJCXZhciB1cGRhdGVTY2VuZXMgPSBmdW5jdGlvbiAoKSB7DQoJCQlfdXBkYXRlQ3ljbGUgPSBhbmltYXRpb25GcmFtZUNhbGxiYWNrKHVwZGF0ZVNjZW5lcyk7DQoJCQlpZiAoX2VuYWJsZWQgJiYgX3VwZGF0ZVNjZW5lc09uTmV4dEN5Y2xlKSB7DQoJCQkJdmFyDQoJCQkJCXNjZW5lc1RvVXBkYXRlID0gJC5pc0FycmF5KF91cGRhdGVTY2VuZXNPbk5leHRDeWNsZSkgPyBfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUgOiBfc2NlbmVPYmplY3RzLnNsaWNlKDApLA0KCQkJCQlvbGRTY3JvbGxQb3MgPSBfc2Nyb2xsUG9zOw0KCQkJCS8vIHVwZGF0ZSBzY3JvbGwgcG9zICYgZGlyZWN0aW9uDQoJCQkJX3Njcm9sbFBvcyA9IFNjcm9sbE1hZ2ljLnNjcm9sbFBvcygpOw0KCQkJCXZhciBkZWx0YVNjcm9sbCA9IF9zY3JvbGxQb3MgLSBvbGRTY3JvbGxQb3M7DQoJCQkJX3Njcm9sbERpcmVjdGlvbiA9IChkZWx0YVNjcm9sbCA9PT0gMCkgPyAiUEFVU0VEIiA6IChkZWx0YVNjcm9sbCA+IDApID8gIkZPUldBUkQiIDogIlJFVkVSU0UiOw0KCQkJCWlmIChkZWx0YVNjcm9sbCA8IDApIHsgLy8gcmV2ZXJzZSBvcmRlciBpZiBzY3JvbGxpbmcgcmV2ZXJzZQ0KCQkJCQlzY2VuZXNUb1VwZGF0ZS5yZXZlcnNlKCk7DQoJCQkJfQ0KCQkJCS8vIHVwZGF0ZSBzY2VuZXMNCgkJCQkkLmVhY2goc2NlbmVzVG9VcGRhdGUsIGZ1bmN0aW9uIChpbmRleCwgc2NlbmUpIHsNCgkJCQkJbG9nKDMsICJ1cGRhdGluZyBTY2VuZSAiICsgKGluZGV4ICsgMSkgKyAiLyIgKyBzY2VuZXNUb1VwZGF0ZS5sZW5ndGggKyAiICgiICsgX3NjZW5lT2JqZWN0cy5sZW5ndGggKyAiIHRvdGFsKSIpOw0KCQkJCQlzY2VuZS51cGRhdGUodHJ1ZSk7DQoJCQkJfSk7DQoJCQkJaWYgKHNjZW5lc1RvVXBkYXRlLmxlbmd0aCA9PT0gMCAmJiBfb3B0aW9ucy5sb2dsZXZlbCA+PSAzKSB7DQoJCQkJCWxvZygzLCAidXBkYXRpbmcgMCBTY2VuZXMgKG5vdGhpbmcgYWRkZWQgdG8gY29udHJvbGxlcikiKTsNCgkJCQl9DQoJCQkJX3VwZGF0ZVNjZW5lc09uTmV4dEN5Y2xlID0gZmFsc2U7DQoJCQl9DQoJCX07DQoJCQ0KCQkvKioNCgkJKiBIYW5kbGVzIENvbnRhaW5lciBjaGFuZ2VzDQoJCSogQHByaXZhdGUNCgkJKi8NCgkJdmFyIG9uQ2hhbmdlID0gZnVuY3Rpb24gKGUpIHsNCgkJCWlmIChlLnR5cGUgPT0gInJlc2l6ZSIpIHsNCgkJCQlfdmlld1BvcnRTaXplID0gX29wdGlvbnMudmVydGljYWwgPyBfb3B0aW9ucy5jb250YWluZXIuaGVpZ2h0KCkgOiBfb3B0aW9ucy5jb250YWluZXIud2lkdGgoKTsNCgkJCX0NCgkJCV91cGRhdGVTY2VuZXNPbk5leHRDeWNsZSA9IHRydWU7DQoJCX07DQoNCgkJdmFyIHJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7DQoJCQlpZiAoIV9pc0RvY3VtZW50KSB7DQoJCQkJLy8gc2ltdWxhdGUgcmVzaXplIGV2ZW50LiBPbmx5IHdvcmtzIGZvciB2aWV3cG9ydCByZWxldmFudCBwYXJhbQ0KCQkJCWlmIChfdmlld1BvcnRTaXplICE9IChfb3B0aW9ucy52ZXJ0aWNhbCA/IF9vcHRpb25zLmNvbnRhaW5lci5oZWlnaHQoKSA6IF9vcHRpb25zLmNvbnRhaW5lci53aWR0aCgpKSkgew0KCQkJCQlfb3B0aW9ucy5jb250YWluZXIudHJpZ2dlcigicmVzaXplIik7DQoJCQkJfQ0KCQkJfQ0KCQkJJC5lYWNoKF9zY2VuZU9iamVjdHMsIGZ1bmN0aW9uIChpbmRleCwgc2NlbmUpIHsvLyByZWZyZXNoIGFsbCBzY2VuZXMNCgkJCQlzY2VuZS5yZWZyZXNoKCk7DQoJCQl9KTsNCgkJfTsNCg0KCQkvKioNCgkJICogU2VuZCBhIGRlYnVnIG1lc3NhZ2UgdG8gdGhlIGNvbnNvbGUuDQoJCSAqIEBwcml2YXRlDQoJCSAqDQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBsb2dsZXZlbCAtIFRoZSBsb2dsZXZlbCByZXF1aXJlZCB0byBpbml0aWF0ZSBvdXRwdXQgZm9yIHRoZSBtZXNzYWdlLg0KCQkgKiBAcGFyYW0gey4uLm1peGVkfSBvdXRwdXQgLSBPbmUgb3IgbW9yZSB2YXJpYWJsZXMgdGhhdCBzaG91bGQgYmUgcGFzc2VkIHRvIHRoZSBjb25zb2xlLg0KCQkgKi8NCgkJdmFyIGxvZyA9IGZ1bmN0aW9uIChsb2dsZXZlbCwgb3V0cHV0KSB7DQoJCQlpZiAoX29wdGlvbnMubG9nbGV2ZWwgPj0gbG9nbGV2ZWwpIHsNCgkJCQl2YXINCgkJCQkJcHJlZml4ID0gIigiICsgTkFNRVNQQUNFICsgIikgLT4iLA0KCQkJCQlhcmdzID0gQXJyYXkucHJvdG90eXBlLnNwbGljZS5jYWxsKGFyZ3VtZW50cywgMSk7DQoJCQkJYXJncy51bnNoaWZ0KGxvZ2xldmVsLCBwcmVmaXgpOw0KCQkJCWRlYnVnLmFwcGx5KHdpbmRvdywgYXJncyk7DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSAqIFNvcnQgc2NlbmVzIGluIGFzY2VuZGluZyBvcmRlciBvZiB0aGVpciBzdGFydCBvZmZzZXQuDQoJCSAqIEBwcml2YXRlDQoJCSAqDQoJCSAqIEBwYXJhbSB7YXJyYXl9IFNjcm9sbFNjZW5lc0FycmF5IC0gYW4gYXJyYXkgb2YgU2Nyb2xsU2NlbmVzIHRoYXQgc2hvdWxkIGJlIHNvcnRlZA0KCQkgKiBAcmV0dXJuIHthcnJheX0gVGhlIHNvcnRlZCBhcnJheSBvZiBTY3JvbGxTY2VuZXMuDQoJCSAqLw0KCQl2YXIgc29ydFNjZW5lcyA9IGZ1bmN0aW9uIChTY3JvbGxTY2VuZXNBcnJheSkgew0KCQkJaWYgKFNjcm9sbFNjZW5lc0FycmF5Lmxlbmd0aCA8PSAxKSB7DQoJCQkJcmV0dXJuIFNjcm9sbFNjZW5lc0FycmF5Ow0KCQkJfSBlbHNlIHsNCgkJCQl2YXIgc2NlbmVzID0gU2Nyb2xsU2NlbmVzQXJyYXkuc2xpY2UoMCk7DQoJCQkJc2NlbmVzLnNvcnQoZnVuY3Rpb24oYSwgYikgew0KCQkJCQlyZXR1cm4gYS5zY3JvbGxPZmZzZXQoKSA+IGIuc2Nyb2xsT2Zmc2V0KCkgPyAxIDogLTE7DQoJCQkJfSk7DQoJCQkJcmV0dXJuIHNjZW5lczsNCgkJCX0NCgkJfTsNCg0KCQkvKg0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqIHB1YmxpYyBmdW5jdGlvbnMNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKi8NCg0KCQkvKioNCgkJICogQWRkIG9uZSBvcmUgbW9yZSBzY2VuZShzKSB0byB0aGUgY29udHJvbGxlci4gIA0KCQkgKiBUaGlzIGlzIHRoZSBlcXVpdmFsZW50IHRvIGBTY3JvbGxTY2VuZS5hZGRUbyhjb250cm9sbGVyKWAuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gd2l0aCBhIHByZXZpb3VzbHkgZGVmaW5lZCBzY2VuZQ0KCQkgKiBjb250cm9sbGVyLmFkZFNjZW5lKHNjZW5lKTsNCgkJICoNCgkgCSAqIC8vIHdpdGggYSBuZXdseSBjcmVhdGVkIHNjZW5lLg0KCQkgKiBjb250cm9sbGVyLmFkZFNjZW5lKG5ldyBTY3JvbGxTY2VuZSh7ZHVyYXRpb24gOiAwfSkpOw0KCQkgKg0KCSAJICogLy8gYWRkaW5nIG11bHRpcGxlIHNjZW5lcw0KCQkgKiBjb250cm9sbGVyLmFkZFNjZW5lKFtzY2VuZSwgc2NlbmUyLCBuZXcgU2Nyb2xsU2NlbmUoe2R1cmF0aW9uIDogMH0pXSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7KFNjcm9sbFNjZW5lfGFycmF5KX0gU2Nyb2xsU2NlbmUgLSBTY3JvbGxTY2VuZSBvciBBcnJheSBvZiBTY3JvbGxTY2VuZXMgdG8gYmUgYWRkZWQgdG8gdGhlIGNvbnRyb2xsZXIuDQoJCSAqIEByZXR1cm4ge1Njcm9sbE1hZ2ljfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMuYWRkU2NlbmUgPSBmdW5jdGlvbiAobmV3U2NlbmUpIHsNCgkJCWlmICgkLmlzQXJyYXkobmV3U2NlbmUpKSB7DQoJCQkJJC5lYWNoKG5ld1NjZW5lLCBmdW5jdGlvbiAoaW5kZXgsIHNjZW5lKSB7DQoJCQkJCVNjcm9sbE1hZ2ljLmFkZFNjZW5lKHNjZW5lKTsNCgkJCQl9KTsNCgkJCX0gZWxzZSBpZiAobmV3U2NlbmUgaW5zdGFuY2VvZiBTY3JvbGxTY2VuZSkgew0KCQkJCWlmIChuZXdTY2VuZS5wYXJlbnQoKSAhPSBTY3JvbGxNYWdpYykgew0KCQkJCQluZXdTY2VuZS5hZGRUbyhTY3JvbGxNYWdpYyk7DQoJCQkJfSBlbHNlIGlmICgkLmluQXJyYXkobmV3U2NlbmUsIF9zY2VuZU9iamVjdHMpIDwgMCl7DQoJCQkJCS8vIG5ldyBzY2VuZQ0KCQkJCQlfc2NlbmVPYmplY3RzLnB1c2gobmV3U2NlbmUpOyAvLyBhZGQgdG8gYXJyYXkNCgkJCQkJX3NjZW5lT2JqZWN0cyA9IHNvcnRTY2VuZXMoX3NjZW5lT2JqZWN0cyk7IC8vIHNvcnQNCgkJCQkJbmV3U2NlbmUub24oInNoaWZ0LiIgKyBOQU1FU1BBQ0UgKyAiX3NvcnQiLCBmdW5jdGlvbigpIHsgLy8gcmVzb3J0IHdoZW5ldmVyIHNjZW5lIG1vdmVzDQoJCQkJCQlfc2NlbmVPYmplY3RzID0gc29ydFNjZW5lcyhfc2NlbmVPYmplY3RzKTsNCgkJCQkJfSk7DQoJCQkJCS8vIGluc2VydCBHbG9iYWwgZGVmYXVsdHMuDQoJCQkJCSQuZWFjaChfb3B0aW9ucy5nbG9iYWxTY2VuZU9wdGlvbnMsIGZ1bmN0aW9uIChrZXksIHZhbHVlKSB7DQoJCQkJCQlpZiAobmV3U2NlbmVba2V5XSkgew0KCQkJCQkJCW5ld1NjZW5lW2tleV0uY2FsbChuZXdTY2VuZSwgdmFsdWUpOw0KCQkJCQkJfQ0KCQkJCQl9KTsNCgkJCQkJbG9nKDMsICJhZGRlZCBTY2VuZSAoIiArIF9zY2VuZU9iamVjdHMubGVuZ3RoICsgIiB0b3RhbCkiKTsNCgkJCQl9DQoJCQl9IGVsc2Ugew0KCQkJCWxvZygxLCAiRVJST1I6IGludmFsaWQgYXJndW1lbnQgc3VwcGxpZWQgZm9yICcuYWRkU2NlbmUoKSciKTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxNYWdpYzsNCgkJfTsNCg0KCQkvKioNCgkJICogUmVtb3ZlIG9uZSBvcmUgbW9yZSBzY2VuZShzKSBmcm9tIHRoZSBjb250cm9sbGVyLiAgDQoJCSAqIFRoaXMgaXMgdGhlIGVxdWl2YWxlbnQgdG8gYFNjcm9sbFNjZW5lLnJlbW92ZSgpYC4NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyByZW1vdmUgYSBzY2VuZSBmcm9tIHRoZSBjb250cm9sbGVyDQoJCSAqIGNvbnRyb2xsZXIucmVtb3ZlU2NlbmUoc2NlbmUpOw0KCQkgKg0KCQkgKiAvLyByZW1vdmUgbXVsdGlwbGUgc2NlbmVzIGZyb20gdGhlIGNvbnRyb2xsZXINCgkJICogY29udHJvbGxlci5yZW1vdmVTY2VuZShbc2NlbmUsIHNjZW5lMiwgc2NlbmUzXSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7KFNjcm9sbFNjZW5lfGFycmF5KX0gU2Nyb2xsU2NlbmUgLSBTY3JvbGxTY2VuZSBvciBBcnJheSBvZiBTY3JvbGxTY2VuZXMgdG8gYmUgcmVtb3ZlZCBmcm9tIHRoZSBjb250cm9sbGVyLg0KCQkgKiBAcmV0dXJucyB7U2Nyb2xsTWFnaWN9IFBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJdGhpcy5yZW1vdmVTY2VuZSA9IGZ1bmN0aW9uIChTY3JvbGxTY2VuZSkgew0KCQkJaWYgKCQuaXNBcnJheShTY3JvbGxTY2VuZSkpIHsNCgkJCQkkLmVhY2goU2Nyb2xsU2NlbmUsIGZ1bmN0aW9uIChpbmRleCwgc2NlbmUpIHsNCgkJCQkJU2Nyb2xsTWFnaWMucmVtb3ZlU2NlbmUoc2NlbmUpOw0KCQkJCX0pOw0KCQkJfSBlbHNlIHsNCgkJCQl2YXIgaW5kZXggPSAkLmluQXJyYXkoU2Nyb2xsU2NlbmUsIF9zY2VuZU9iamVjdHMpOw0KCQkJCWlmIChpbmRleCA+IC0xKSB7DQoJCQkJCVNjcm9sbFNjZW5lLm9mZigic2hpZnQuIiArIE5BTUVTUEFDRSArICJfc29ydCIpOw0KCQkJCQlfc2NlbmVPYmplY3RzLnNwbGljZShpbmRleCwgMSk7DQoJCQkJCVNjcm9sbFNjZW5lLnJlbW92ZSgpOw0KCQkJCQlsb2coMywgInJlbW92ZWQgU2NlbmUgKCIgKyBfc2NlbmVPYmplY3RzLmxlbmd0aCArICIgdG90YWwpIik7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbE1hZ2ljOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBVcGRhdGUgb25lIG9yZSBtb3JlIHNjZW5lKHMpIGFjY29yZGluZyB0byB0aGUgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSBjb250YWluZXIuICANCgkJICogVGhpcyBpcyB0aGUgZXF1aXZhbGVudCB0byBgU2Nyb2xsU2NlbmUudXBkYXRlKClgLiAgDQoJCSAqIFRoZSB1cGRhdGUgbWV0aG9kIGNhbGN1bGF0ZXMgdGhlIHNjZW5lJ3Mgc3RhcnQgYW5kIGVuZCBwb3NpdGlvbiAoYmFzZWQgb24gdGhlIHRyaWdnZXIgZWxlbWVudCwgdHJpZ2dlciBob29rLCBkdXJhdGlvbiBhbmQgb2Zmc2V0KSBhbmQgY2hlY2tzIGl0IGFnYWluc3QgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSBjb250YWluZXIuICANCgkJICogSXQgdGhlbiB1cGRhdGVzIHRoZSBjdXJyZW50IHNjZW5lIHN0YXRlIGFjY29yZGluZ2x5IChvciBkb2VzIG5vdGhpbmcsIGlmIHRoZSBzdGF0ZSBpcyBhbHJlYWR5IGNvcnJlY3QpIOKAkyBQaW5zIHdpbGwgYmUgc2V0IHRvIHRoZWlyIGNvcnJlY3QgcG9zaXRpb24gYW5kIHR3ZWVucyB3aWxsIGJlIHVwZGF0ZWQgdG8gdGhlaXIgY29ycmVjdCBwcm9ncmVzcy4gIA0KCQkgKiBfKipOb3RlOioqIFRoaXMgbWV0aG9kIGdldHMgY2FsbGVkIGNvbnN0YW50bHkgd2hlbmV2ZXIgU2Nyb2xsTWFnaWMgZGV0ZWN0cyBhIGNoYW5nZS4gVGhlIG9ubHkgYXBwbGljYXRpb24gZm9yIHlvdSBpcyBpZiB5b3UgY2hhbmdlIHNvbWV0aGluZyBvdXRzaWRlIG9mIHRoZSByZWFsbSBvZiBTY3JvbGxNYWdpYywgbGlrZSBtb3ZpbmcgdGhlIHRyaWdnZXIgb3IgY2hhbmdpbmcgdHdlZW4gcGFyYW1ldGVycy5fDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gdXBkYXRlIGEgc3BlY2lmaWMgc2NlbmUgb24gbmV4dCBjeWNsZQ0KCSAJICogY29udHJvbGxlci51cGRhdGVTY2VuZShzY2VuZSk7DQoJIAkgKg0KCQkgKiAvLyB1cGRhdGUgYSBzcGVjaWZpYyBzY2VuZSBpbW1lZGlhdGVseQ0KCQkgKiBjb250cm9sbGVyLnVwZGF0ZVNjZW5lKHNjZW5lLCB0cnVlKTsNCgkgCSAqDQoJCSAqIC8vIHVwZGF0ZSBtdWx0aXBsZSBzY2VuZXMgc2NlbmUgb24gbmV4dCBjeWNsZQ0KCQkgKiBjb250cm9sbGVyLnVwZGF0ZVNjZW5lKFtzY2VuZTEsIHNjZW5lMiwgc2NlbmUzXSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7U2Nyb2xsU2NlbmV9IFNjcm9sbFNjZW5lIC0gU2Nyb2xsU2NlbmUgb3IgQXJyYXkgb2YgU2Nyb2xsU2NlbmVzIHRoYXQgaXMvYXJlIHN1cHBvc2VkIHRvIGJlIHVwZGF0ZWQuDQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW2ltbWVkaWF0ZWx5PWZhbHNlXSAtIElmIGB0cnVlYCB0aGUgdXBkYXRlIHdpbGwgYmUgaW5zdGFudCwgaWYgYGZhbHNlYCBpdCB3aWxsIHdhaXQgdW50aWwgbmV4dCB1cGRhdGUgY3ljbGUuICANCgkJIAkJCQkJCQkJCQkgIFRoaXMgaXMgdXNlZnVsIHdoZW4gY2hhbmdpbmcgbXVsdGlwbGUgcHJvcGVydGllcyBvZiB0aGUgc2NlbmUgLSB0aGlzIHdheSBpdCB3aWxsIG9ubHkgYmUgdXBkYXRlZCBvbmNlIGFsbCBuZXcgcHJvcGVydGllcyBhcmUgc2V0ICh1cGRhdGVTY2VuZXMpLg0KCQkgKiBAcmV0dXJuIHtTY3JvbGxNYWdpY30gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnVwZGF0ZVNjZW5lID0gZnVuY3Rpb24gKFNjcm9sbFNjZW5lLCBpbW1lZGlhdGVseSkgew0KCQkJaWYgKCQuaXNBcnJheShTY3JvbGxTY2VuZSkpIHsNCgkJCQkkLmVhY2goU2Nyb2xsU2NlbmUsIGZ1bmN0aW9uIChpbmRleCwgc2NlbmUpIHsNCgkJCQkJU2Nyb2xsTWFnaWMudXBkYXRlU2NlbmUoc2NlbmUsIGltbWVkaWF0ZWx5KTsNCgkJCQl9KTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYgKGltbWVkaWF0ZWx5KSB7DQoJCQkJCVNjcm9sbFNjZW5lLnVwZGF0ZSh0cnVlKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQkvLyBwcmVwIGFycmF5IGZvciBuZXh0IHVwZGF0ZSBjeWNsZQ0KCQkJCQlpZiAoISQuaXNBcnJheShfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUpKSB7DQoJCQkJCQlfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUgPSBbXTsNCgkJCQkJfQ0KCQkJCQlpZiAoJC5pbkFycmF5KFNjcm9sbFNjZW5lLCBfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUpID09IC0xKSB7DQoJCQkJCQlfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUucHVzaChTY3JvbGxTY2VuZSk7CQ0KCQkJCQl9DQoJCQkJCV91cGRhdGVTY2VuZXNPbk5leHRDeWNsZSA9IHNvcnRTY2VuZXMoX3VwZGF0ZVNjZW5lc09uTmV4dEN5Y2xlKTsgLy8gc29ydA0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBTY3JvbGxNYWdpYzsNCgkJfTsNCg0KCQkvKioNCgkJICogVXBkYXRlcyB0aGUgY29udHJvbGxlciBwYXJhbXMgYW5kIGNhbGxzIHVwZGF0ZVNjZW5lIG9uIGV2ZXJ5IHNjZW5lLCB0aGF0IGlzIGF0dGFjaGVkIHRvIHRoZSBjb250cm9sbGVyLiAgDQoJCSAqIFNlZSBgU2Nyb2xsTWFnaWMudXBkYXRlU2NlbmUoKWAgZm9yIG1vcmUgaW5mb3JtYXRpb24gYWJvdXQgd2hhdCB0aGlzIG1lYW5zLiAgDQoJCSAqIEluIG1vc3QgY2FzZXMgeW91IHdpbGwgbm90IG5lZWQgdGhpcyBmdW5jdGlvbiwgYXMgaXQgaXMgY2FsbGVkIGNvbnN0YW50bHksIHdoZW5ldmVyIFNjcm9sbE1hZ2ljIGRldGVjdHMgYSBzdGF0ZSBjaGFuZ2UgZXZlbnQsIGxpa2UgcmVzaXplIG9yIHNjcm9sbC4gIA0KCQkgKiBUaGUgb25seSBhcHBsaWNhdGlvbiBmb3IgdGhpcyBtZXRob2QgaXMgd2hlbiBTY3JvbGxNYWdpYyBmYWlscyB0byBkZXRlY3QgdGhlc2UgZXZlbnRzLiAgDQoJCSAqIE9uZSBhcHBsaWNhdGlvbiBpcyB3aXRoIHNvbWUgZXh0ZXJuYWwgc2Nyb2xsIGxpYnJhcmllcyAobGlrZSBpU2Nyb2xsKSB0aGF0IG1vdmUgYW4gaW50ZXJuYWwgY29udGFpbmVyIHRvIGEgbmVnYXRpdmUgb2Zmc2V0IGluc3RlYWQgb2YgYWN0dWFsbHkgc2Nyb2xsaW5nLiBJbiB0aGlzIGNhc2UgdGhlIHVwZGF0ZSBvbiB0aGUgY29udHJvbGxlciBuZWVkcyB0byBiZSBjYWxsZWQgd2hlbmV2ZXIgdGhlIGNoaWxkIGNvbnRhaW5lcidzIHBvc2l0aW9uIGNoYW5nZXMuDQoJCSAqIEZvciB0aGlzIGNhc2UgdGhlcmUgd2lsbCBhbHNvIGJlIHRoZSBuZWVkIHRvIHByb3ZpZGUgYSBjdXN0b20gZnVuY3Rpb24gdG8gY2FsY3VsYXRlIHRoZSBjb3JyZWN0IHNjcm9sbCBwb3NpdGlvbi4gU2VlIGBTY3JvbGxNYWdpYy5zY3JvbGxQb3MoKWAgZm9yIGRldGFpbHMuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gdXBkYXRlIHRoZSBjb250cm9sbGVyIG9uIG5leHQgY3ljbGUgKHNhdmVzIHBlcmZvcm1hbmNlIGR1ZSB0byBlbGltaW5hdGlvbiBvZiByZWR1bmRhbnQgdXBkYXRlcykNCgkJICogY29udHJvbGxlci51cGRhdGUoKTsNCgkJICoNCgkgCSAqIC8vIHVwZGF0ZSB0aGUgY29udHJvbGxlciBpbW1lZGlhdGVseQ0KCQkgKiBjb250cm9sbGVyLnVwZGF0ZSh0cnVlKTsNCgkJICoNCgkJICogQHBhcmFtIHtib29sZWFufSBbaW1tZWRpYXRlbHk9ZmFsc2VdIC0gSWYgYHRydWVgIHRoZSB1cGRhdGUgd2lsbCBiZSBpbnN0YW50LCBpZiBgZmFsc2VgIGl0IHdpbGwgd2FpdCB1bnRpbCBuZXh0IHVwZGF0ZSBjeWNsZSAoYmV0dGVyIHBlcmZvcm1hbmNlKQ0KCQkgKiBAcmV0dXJuIHtTY3JvbGxNYWdpY30gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnVwZGF0ZSA9IGZ1bmN0aW9uIChpbW1lZGlhdGVseSkgew0KCQkJb25DaGFuZ2Uoe3R5cGU6ICJyZXNpemUifSk7IC8vIHdpbGwgdXBkYXRlIHNpemUgYW5kIHNldCBfdXBkYXRlU2NlbmVzT25OZXh0Q3ljbGUgdG8gdHJ1ZQ0KCQkJaWYgKGltbWVkaWF0ZWx5KSB7DQoJCQkJdXBkYXRlU2NlbmVzKCk7DQoJCQl9DQoJCQlyZXR1cm4gU2Nyb2xsTWFnaWM7DQoJCX07DQoNCgkJLyoqDQoJCSAqIFNjcm9sbCB0byBhIG51bWVyaWMgc2Nyb2xsIG9mZnNldCwgYSBET00gZWxlbWVudCwgdGhlIHN0YXJ0IG9mIGEgc2NlbmUgb3IgcHJvdmlkZSBhbiBhbHRlcm5hdGUgbWV0aG9kIGZvciBzY3JvbGxpbmcuICANCgkJICogRm9yIHZlcnRpY2FsIGNvbnRyb2xsZXJzIGl0IHdpbGwgY2hhbmdlIHRoZSB0b3Agc2Nyb2xsIG9mZnNldCBhbmQgZm9yIGhvcml6b250YWwgYXBwbGljYXRpb25zIGl0IHdpbGwgY2hhbmdlIHRoZSBsZWZ0IG9mZnNldC4NCgkJICogQHB1YmxpYw0KCQkgKg0KCQkgKiBAc2luY2UgMS4xLjANCgkJICogQGV4YW1wbGUNCgkJICogLy8gc2Nyb2xsIHRvIGFuIG9mZnNldCBvZiAxMDANCgkJICogY29udHJvbGxlci5zY3JvbGxUbygxMDApOw0KCQkgKg0KCQkgKiAvLyBzY3JvbGwgdG8gYSBET00gZWxlbWVudA0KCQkgKiBjb250cm9sbGVyLnNjcm9sbFRvKCIjYW5jaG9yIik7DQoJCSAqDQoJCSAqIC8vIHNjcm9sbCB0byB0aGUgYmVnaW5uaW5nIG9mIGEgc2NlbmUNCgkJICogdmFyIHNjZW5lID0gbmV3IFNjcm9sbFNjZW5lKHtvZmZzZXQ6IDIwMH0pOw0KCQkgKiBjb250cm9sbGVyLnNjcm9sbFRvKHNjZW5lKTsNCgkJICoNCgkgCSAqIC8vIGRlZmluZSBhIG5ldyBzY3JvbGwgcG9zaXRpb24gbW9kaWZpY2F0aW9uIGZ1bmN0aW9uIChhbmltYXRlIGluc3RlYWQgb2YganVtcCkNCgkJICogY29udHJvbGxlci5zY3JvbGxUbyhmdW5jdGlvbiAobmV3U2Nyb2xsUG9zKSB7DQoJCSAqCSQoImJvZHkiKS5hbmltYXRlKHtzY3JvbGxUb3A6IG5ld1Njcm9sbFBvc30pOw0KCQkgKiB9KTsNCgkJICoNCgkJICogQHBhcmFtIHttaXhlZH0gW3Njcm9sbFRhcmdldF0gLSBUaGUgc3VwcGxpZWQgYXJndW1lbnQgY2FuIGJlIG9uZSBvZiB0aGVzZSB0eXBlczoNCgkJICogMS4gYG51bWJlcmAgLT4gVGhlIGNvbnRhaW5lciB3aWxsIHNjcm9sbCB0byB0aGlzIG5ldyBzY3JvbGwgb2Zmc2V0Lg0KCQkgKiAyLiBgc3RyaW5nYCBvciBgb2JqZWN0YCAtPiBDYW4gYmUgYSBzZWxlY3RvciwgYSBET00gb2JqZWN0IG9yIGEgalF1ZXJ5IGVsZW1lbnQuICANCgkJICogIFRoZSBjb250YWluZXIgd2lsbCBzY3JvbGwgdG8gdGhlIHBvc2l0aW9uIG9mIHRoaXMgZWxlbWVudC4NCgkJICogMy4gYFNjcm9sbFNjZW5lYCAtPiBUaGUgY29udGFpbmVyIHdpbGwgc2Nyb2xsIHRvIHRoZSBzdGFydCBvZiB0aGlzIHNjZW5lLg0KCQkgKiA0LiBgZnVuY3Rpb25gIC0+IFRoaXMgZnVuY3Rpb24gd2lsbCBiZSB1c2VkIGFzIGEgY2FsbGJhY2sgZm9yIGZ1dHVyZSBzY3JvbGwgcG9zaXRpb24gbW9kaWZpY2F0aW9ucy4gIA0KCQkgKiAgVGhpcyBwcm92aWRlcyBhIHdheSBmb3IgeW91IHRvIGNoYW5nZSB0aGUgYmVoYXZpb3VyIG9mIHNjcm9sbGluZyBhbmQgYWRkaW5nIG5ldyBiZWhhdmlvdXIgbGlrZSBhbmltYXRpb24uIFRoZSBjYWxsYmFjayByZWNlaXZlcyB0aGUgbmV3IHNjcm9sbCBwb3NpdGlvbiBhcyBhIHBhcmFtZXRlciBhbmQgYSByZWZlcmVuY2UgdG8gdGhlIGNvbnRhaW5lciBlbGVtZW50IHVzaW5nIGB0aGlzYC4gIA0KCQkgKiAgXyoqTk9URToqKiBBbGwgb3RoZXIgb3B0aW9ucyB3aWxsIHN0aWxsIHdvcmsgYXMgZXhwZWN0ZWQsIHVzaW5nIHRoZSBuZXcgZnVuY3Rpb24gdG8gc2Nyb2xsLl8NCgkJICogQHJldHVybnMge1Njcm9sbE1hZ2ljfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMuc2Nyb2xsVG8gPSBmdW5jdGlvbiAoc2Nyb2xsVGFyZ2V0KSB7DQoJCQlpZiAoc2Nyb2xsVGFyZ2V0IGluc3RhbmNlb2YgU2Nyb2xsU2NlbmUpIHsNCgkJCQlpZiAoc2Nyb2xsVGFyZ2V0LnBhcmVudCgpID09PSBTY3JvbGxNYWdpYykgeyAvLyBjaGVjayBpZiB0aGlzIGNvbnRyb2xsZXIgaXMgdGhlIHBhcmVudA0KCQkJCQlTY3JvbGxNYWdpYy5zY3JvbGxUbyhzY3JvbGxUYXJnZXQuc2Nyb2xsT2Zmc2V0KCkpOw0KCQkJCX0gZWxzZSB7DQoJCQkJCWxvZyAoMiwgInNjcm9sbFRvKCk6IFRoZSBzdXBwbGllZCBzY2VuZSBkb2VzIG5vdCBiZWxvbmcgdG8gdGhpcyBjb250cm9sbGVyLiBTY3JvbGwgY2FuY2VsbGVkLiIsIHNjcm9sbFRhcmdldCk7DQoJCQkJfQ0KCQkJfSBlbHNlIGlmICgkLnR5cGUoc2Nyb2xsVGFyZ2V0KSA9PT0gInN0cmluZyIgfHwgaXNEb21FbGVtZW50KHNjcm9sbFRhcmdldCkgfHwgc2Nyb2xsVGFyZ2V0IGluc3RhbmNlb2YgJCkgew0KCQkJCXZhciAkZWxtID0gJChzY3JvbGxUYXJnZXQpLmZpcnN0KCk7DQoJCQkJaWYgKCRlbG1bMF0pIHsNCgkJCQkJdmFyDQoJCQkJCQlwYXJhbSA9IF9vcHRpb25zLnZlcnRpY2FsID8gInRvcCIgOiAibGVmdCIsIC8vIHdoaWNoIHBhcmFtIGlzIG9mIGludGVyZXN0ID8NCgkJCQkJCWNvbnRhaW5lck9mZnNldCA9IGdldE9mZnNldChfb3B0aW9ucy5jb250YWluZXIpLCAvLyBjb250YWluZXIgcG9zaXRpb24gaXMgbmVlZGVkIGJlY2F1c2UgZWxlbWVudCBvZmZzZXQgaXMgcmV0dXJuZWQgaW4gcmVsYXRpb24gdG8gZG9jdW1lbnQsIG5vdCBpbiByZWxhdGlvbiB0byBjb250YWluZXIuDQoJCQkJCQllbGVtZW50T2Zmc2V0ID0gZ2V0T2Zmc2V0KCRlbG0pOw0KDQoJCQkJCWlmICghX2lzRG9jdW1lbnQpIHsgLy8gY29udGFpbmVyIGlzIG5vdCB0aGUgZG9jdW1lbnQgcm9vdCwgc28gc3Vic3RyYWN0IHNjcm9sbCBQb3NpdGlvbiB0byBnZXQgY29ycmVjdCB0cmlnZ2VyIGVsZW1lbnQgcG9zaXRpb24gcmVsYXRpdmUgdG8gc2Nyb2xsY29udGVudA0KCQkJCQkJY29udGFpbmVyT2Zmc2V0W3BhcmFtXSAtPSBTY3JvbGxNYWdpYy5zY3JvbGxQb3MoKTsNCgkJCQkJfQ0KDQoJCQkJCVNjcm9sbE1hZ2ljLnNjcm9sbFRvKGVsZW1lbnRPZmZzZXRbcGFyYW1dIC0gY29udGFpbmVyT2Zmc2V0W3BhcmFtXSk7DQoJCQkJfSBlbHNlIHsNCgkJCQkJbG9nICgyLCAic2Nyb2xsVG8oKTogVGhlIHN1cHBsaWVkIGVsZW1lbnQgY291bGQgbm90IGJlIGZvdW5kLiBTY3JvbGwgY2FuY2VsbGVkLiIsIHNjcm9sbFRhcmdldCk7DQoJCQkJfQ0KCQkJfSBlbHNlIGlmICgkLmlzRnVuY3Rpb24oc2Nyb2xsVGFyZ2V0KSkgew0KCQkJCXNldFNjcm9sbFBvcyA9IHNjcm9sbFRhcmdldDsNCgkJCX0gZWxzZSB7DQoJCQkJc2V0U2Nyb2xsUG9zLmNhbGwoX29wdGlvbnMuY29udGFpbmVyWzBdLCBzY3JvbGxUYXJnZXQpOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbE1hZ2ljOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIHRoZSBjdXJyZW50IHNjcm9sbFBvc2l0aW9uIG9yICoqU2V0KiogYSBuZXcgbWV0aG9kIHRvIGNhbGN1bGF0ZSBpdC4gIA0KCQkgKiAtPiAqKkdFVCoqOg0KCQkgKiBXaGVuIHVzZWQgYXMgYSBnZXR0ZXIgdGhpcyBmdW5jdGlvbiB3aWxsIHJldHVybiB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24uICANCgkJICogVG8gZ2V0IGEgY2FjaGVkIHZhbHVlIHVzZSBTY3JvbGxNYWdpYy5pbmZvKCJzY3JvbGxQb3MiKSwgd2hpY2ggd2lsbCBiZSB1cGRhdGVkIGluIHRoZSB1cGRhdGUgY3ljbGUuICANCgkJICogRm9yIHZlcnRpY2FsIGNvbnRyb2xsZXJzIGl0IHdpbGwgcmV0dXJuIHRoZSB0b3Agc2Nyb2xsIG9mZnNldCBhbmQgZm9yIGhvcml6b250YWwgYXBwbGljYXRpb25zIGl0IHdpbGwgcmV0dXJuIHRoZSBsZWZ0IG9mZnNldC4NCgkJICoNCgkJICogLT4gKipTRVQqKjoNCgkJICogV2hlbiB1c2VkIGFzIGEgc2V0dGVyIHRoaXMgbWV0aG9kIHByb2RlcyBhIHdheSB0byBwZXJtYW5lbnRseSBvdmVyd3JpdGUgdGhlIGNvbnRyb2xsZXIncyBzY3JvbGwgcG9zaXRpb24gY2FsY3VsYXRpb24uICANCgkJICogQSB0eXBpY2FsIHVzZWNhc2UgaXMgd2hlbiB0aGUgc2Nyb2xsIHBvc2l0aW9uIGlzIG5vdCByZWZsZWN0ZWQgYnkgdGhlIGNvbnRhaW5lcnMgc2Nyb2xsVG9wIG9yIHNjcm9sbExlZnQgdmFsdWVzLCBidXQgZm9yIGV4YW1wbGUgYnkgdGhlIGlubmVyIG9mZnNldCBvZiBhIGNoaWxkIGNvbnRhaW5lci4gIA0KCQkgKiBNb3ZpbmcgYSBjaGlsZCBjb250YWluZXIgaW5zaWRlIGEgcGFyZW50IGlzIGEgY29tbW9ubHkgdXNlZCBtZXRob2QgZm9yIHNldmVyYWwgc2Nyb2xsaW5nIGZyYW1ld29ya3MsIGluY2x1ZGluZyBpU2Nyb2xsLiAgDQoJCSAqIEJ5IHByb3ZpZGluZyBhbiBhbHRlcm5hdGUgY2FsY3VsYXRpb24gZnVuY3Rpb24geW91IGNhbiBtYWtlIHN1cmUgU2Nyb2xsTWFnaWMgcmVjZWl2ZXMgdGhlIGNvcnJlY3Qgc2Nyb2xsIHBvc2l0aW9uLiAgDQoJCSAqIFBsZWFzZSBhbHNvIGJlYXIgaW4gbWluZCB0aGF0IHlvdXIgZnVuY3Rpb24gc2hvdWxkIHJldHVybiB5IHZhbHVlcyBmb3IgdmVydGljYWwgc2Nyb2xscyBhbiB4IGZvciBob3Jpem9udGFscy4NCgkJICoNCgkJICogVG8gY2hhbmdlIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiBwbGVhc2UgdXNlIGBTY3JvbGxNYWdpYy5zY3JvbGxUbygpYC4NCgkJICogQHB1YmxpYw0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyBnZXQgdGhlIGN1cnJlbnQgc2Nyb2xsIFBvc2l0aW9uDQoJCSAqIHZhciBzY3JvbGxQb3MgPSBjb250cm9sbGVyLnNjcm9sbFBvcygpOw0KCQkgKg0KCSAJICogLy8gc2V0IGEgbmV3IHNjcm9sbCBwb3NpdGlvbiBjYWxjdWxhdGlvbiBtZXRob2QNCgkJICogY29udHJvbGxlci5zY3JvbGxQb3MoZnVuY3Rpb24gKCkgew0KCQkgKglyZXR1cm4gdGhpcy5pbmZvKCJ2ZXJ0aWNhbCIpID8gLSRteWNoaWxkY29udGFpbmVyLnkgOiAtJG15Y2hpbGRjb250YWluZXIueA0KCQkgKiB9KTsNCgkJICoNCgkJICogQHBhcmFtIHtmdW5jdGlvbn0gW3Njcm9sbFBvc01ldGhvZF0gLSBUaGUgZnVuY3Rpb24gdG8gYmUgdXNlZCBmb3IgdGhlIHNjcm9sbCBwb3NpdGlvbiBjYWxjdWxhdGlvbiBvZiB0aGUgY29udGFpbmVyLg0KCQkgKiBAcmV0dXJucyB7KG51bWJlcnxTY3JvbGxNYWdpYyl9IEN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIG9yIHBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJdGhpcy5zY3JvbGxQb3MgPSBmdW5jdGlvbiAoc2Nyb2xsUG9zTWV0aG9kKSB7DQoJCQlpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsgLy8gZ2V0DQoJCQkJcmV0dXJuIGdldFNjcm9sbFBvcy5jYWxsKFNjcm9sbE1hZ2ljKTsNCgkJCX0gZWxzZSB7IC8vIHNldA0KCQkJCWlmICgkLmlzRnVuY3Rpb24oc2Nyb2xsUG9zTWV0aG9kKSkgew0KCQkJCQlnZXRTY3JvbGxQb3MgPSBzY3JvbGxQb3NNZXRob2Q7DQoJCQkJfSBlbHNlIHsNCgkJCQkJbG9nKDIsICJQcm92aWRlZCB2YWx1ZSBmb3IgbWV0aG9kICdzY3JvbGxQb3MnIGlzIG5vdCBhIGZ1bmN0aW9uLiBUbyBjaGFuZ2UgdGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIHVzZSAnc2Nyb2xsVG8oKScuIik7DQoJCQkJfQ0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbE1hZ2ljOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIGFsbCBpbmZvcyBvciBvbmUgaW4gcGFydGljdWxhciBhYm91dCB0aGUgY29udHJvbGxlci4NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyByZXR1cm5zIHRoZSBjdXJyZW50IHNjcm9sbCBwb3NpdGlvbiAobnVtYmVyKQ0KCQkgKiB2YXIgc2Nyb2xsUG9zID0gY29udHJvbGxlci5pbmZvKCJzY3JvbGxQb3MiKTsNCgkJICoNCgkJICogLy8gcmV0dXJucyBhbGwgaW5mb3MgYXMgYW4gb2JqZWN0DQoJCSAqIHZhciBpbmZvcyA9IGNvbnRyb2xsZXIuaW5mbygpOw0KCQkgKg0KCQkgKiBAcGFyYW0ge3N0cmluZ30gW2Fib3V0XSAtIElmIHBhc3NlZCBvbmx5IHRoaXMgaW5mbyB3aWxsIGJlIHJldHVybmVkIGluc3RlYWQgb2YgYW4gb2JqZWN0IGNvbnRhaW5pbmcgYWxsLiAgDQoJCSAJCQkJCQkJIFZhbGlkIG9wdGlvbnMgYXJlOg0KCQkgCQkJCQkJCSAqKiBgInNpemUiYCA9PiB0aGUgY3VycmVudCB2aWV3cG9ydCBzaXplIG9mIHRoZSBjb250YWluZXINCgkJIAkJCQkJCQkgKiogYCJ2ZXJ0aWNhbCJgID0+IHRydWUgaWYgdmVydGljYWwgc2Nyb2xsaW5nLCBvdGhlcndpc2UgZmFsc2UNCgkJIAkJCQkJCQkgKiogYCJzY3JvbGxQb3MiYCA9PiB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24NCgkJIAkJCQkJCQkgKiogYCJzY3JvbGxEaXJlY3Rpb24iYCA9PiB0aGUgbGFzdCBrbm93biBkaXJlY3Rpb24gb2YgdGhlIHNjcm9sbA0KCQkgCQkJCQkJCSAqKiBgImNvbnRhaW5lciJgID0+IHRoZSBjb250YWluZXIgZWxlbWVudA0KCQkgCQkJCQkJCSAqKiBgImlzRG9jdW1lbnQiYCA9PiB0cnVlIGlmIGNvbnRhaW5lciBlbGVtZW50IGlzIHRoZSBkb2N1bWVudC4NCgkJICogQHJldHVybnMgeyhtaXhlZHxvYmplY3QpfSBUaGUgcmVxdWVzdGVkIGluZm8ocykuDQoJCSAqLw0KCQl0aGlzLmluZm8gPSBmdW5jdGlvbiAoYWJvdXQpIHsNCgkJCXZhciB2YWx1ZXMgPSB7DQoJCQkJc2l6ZTogX3ZpZXdQb3J0U2l6ZSwgLy8gY29udGFpbnMgaGVpZ2h0IG9yIHdpZHRoIChpbiByZWdhcmQgdG8gb3JpZW50YXRpb24pOw0KCQkJCXZlcnRpY2FsOiBfb3B0aW9ucy52ZXJ0aWNhbCwNCgkJCQlzY3JvbGxQb3M6IF9zY3JvbGxQb3MsDQoJCQkJc2Nyb2xsRGlyZWN0aW9uOiBfc2Nyb2xsRGlyZWN0aW9uLA0KCQkJCWNvbnRhaW5lcjogX29wdGlvbnMuY29udGFpbmVyLA0KCQkJCWlzRG9jdW1lbnQ6IF9pc0RvY3VtZW50DQoJCQl9Ow0KCQkJaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7IC8vIGdldCBhbGwgYXMgYW4gb2JqZWN0DQoJCQkJcmV0dXJuIHZhbHVlczsNCgkJCX0gZWxzZSBpZiAodmFsdWVzW2Fib3V0XSAhPT0gdW5kZWZpbmVkKSB7DQoJCQkJcmV0dXJuIHZhbHVlc1thYm91dF07DQoJCQl9IGVsc2Ugew0KCQkJCWxvZygxLCAiRVJST1I6IG9wdGlvbiBcIiIgKyBhYm91dCArICJcIiBpcyBub3QgYXZhaWxhYmxlIik7DQoJCQkJcmV0dXJuOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIGN1cnJlbnQgbG9nbGV2ZWwgb3B0aW9uIHZhbHVlLg0KCQkgKiBAcHVibGljDQoJCSAqDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCB2YWx1ZQ0KCQkgKiB2YXIgbG9nbGV2ZWwgPSBjb250cm9sbGVyLmxvZ2xldmVsKCk7DQoJCSAqDQoJIAkgKiAvLyBzZXQgYSBuZXcgdmFsdWUNCgkJICogY29udHJvbGxlci5sb2dsZXZlbCgzKTsNCgkJICoNCgkJICogQHBhcmFtIHtudW1iZXJ9IFtuZXdMb2dsZXZlbF0gLSBUaGUgbmV3IGxvZ2xldmVsIHNldHRpbmcgb2YgdGhlIFNjcm9sbE1hZ2ljIGNvbnRyb2xsZXIuIGBbMC0zXWANCgkJICogQHJldHVybnMgeyhudW1iZXJ8U2Nyb2xsTWFnaWMpfSBDdXJyZW50IGxvZ2xldmVsIG9yIHBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJdGhpcy5sb2dsZXZlbCA9IGZ1bmN0aW9uIChuZXdMb2dsZXZlbCkgew0KCQkJaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7IC8vIGdldA0KCQkJCXJldHVybiBfb3B0aW9ucy5sb2dsZXZlbDsNCgkJCX0gZWxzZSBpZiAoX29wdGlvbnMubG9nbGV2ZWwgIT0gbmV3TG9nbGV2ZWwpIHsgLy8gc2V0DQoJCQkJX29wdGlvbnMubG9nbGV2ZWwgPSBuZXdMb2dsZXZlbDsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxNYWdpYzsNCgkJfTsNCg0KCQkvKioNCgkJICogKipHZXQqKiBvciAqKlNldCoqIHRoZSBjdXJyZW50IGVuYWJsZWQgc3RhdGUgb2YgdGhlIGNvbnRyb2xsZXIuICANCgkJICogVGhpcyBjYW4gYmUgdXNlZCB0byBkaXNhYmxlIGFsbCBTY2VuZXMgY29ubmVjdGVkIHRvIHRoZSBjb250cm9sbGVyIHdpdGhvdXQgZGVzdHJveWluZyBvciByZW1vdmluZyB0aGVtLg0KCQkgKiBAcHVibGljDQoJCSAqDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCB2YWx1ZQ0KCQkgKiB2YXIgZW5hYmxlZCA9IGNvbnRyb2xsZXIuZW5hYmxlZCgpOw0KCQkgKg0KCSAJICogLy8gZGlzYWJsZSB0aGUgY29udHJvbGxlcg0KCQkgKiBjb250cm9sbGVyLmVuYWJsZWQoZmFsc2UpOw0KCQkgKg0KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtuZXdTdGF0ZV0gLSBUaGUgbmV3IGVuYWJsZWQgc3RhdGUgb2YgdGhlIGNvbnRyb2xsZXIgYHRydWVgIG9yIGBmYWxzZWAuDQoJCSAqIEByZXR1cm5zIHsoYm9vbGVhbnxTY3JvbGxNYWdpYyl9IEN1cnJlbnQgZW5hYmxlZCBzdGF0ZSBvciBwYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMuZW5hYmxlZCA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkgew0KCQkJaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7IC8vIGdldA0KCQkJCXJldHVybiBfZW5hYmxlZDsNCgkJCX0gZWxzZSBpZiAoX2VuYWJsZWQgIT0gbmV3U3RhdGUpIHsgLy8gc2V0DQoJCQkJX2VuYWJsZWQgPSAhIW5ld1N0YXRlOw0KCQkJCVNjcm9sbE1hZ2ljLnVwZGF0ZVNjZW5lKF9zY2VuZU9iamVjdHMsIHRydWUpOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbE1hZ2ljOw0KCQl9Ow0KCQkNCgkJLyoqDQoJCSAqIERlc3Ryb3kgdGhlIENvbnRyb2xsZXIsIGFsbCBTY2VuZXMgYW5kIGV2ZXJ5dGhpbmcuDQoJCSAqIEBwdWJsaWMNCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogLy8gd2l0aG91dCByZXNldHRpbmcgdGhlIHNjZW5lcw0KCQkgKiBjb250cm9sbGVyID0gY29udHJvbGxlci5kZXN0cm95KCk7DQoJCSAqDQoJIAkgKiAvLyB3aXRoIHNjZW5lIHJlc2V0DQoJCSAqIGNvbnRyb2xsZXIgPSBjb250cm9sbGVyLmRlc3Ryb3kodHJ1ZSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Jlc2V0U2NlbmVzPWZhbHNlXSAtIElmIGB0cnVlYCB0aGUgcGlucyBhbmQgdHdlZW5zIChpZiBleGlzdGVudCkgb2YgYWxsIHNjZW5lcyB3aWxsIGJlIHJlc2V0Lg0KCQkgKiBAcmV0dXJucyB7bnVsbH0gTnVsbCB0byB1bnNldCBoYW5kbGVyIHZhcmlhYmxlcy4NCgkJICovDQoJCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uIChyZXNldFNjZW5lcykgew0KCQkJd2luZG93LmNsZWFyVGltZW91dChfcmVmcmVzaEludGVydmFsKTsNCgkJCXZhciBpID0gX3NjZW5lT2JqZWN0cy5sZW5ndGg7DQoJCQl3aGlsZSAoaS0tKSB7DQoJCQkJX3NjZW5lT2JqZWN0c1tpXS5kZXN0cm95KHJlc2V0U2NlbmVzKTsNCgkJCX0NCgkJCV9vcHRpb25zLmNvbnRhaW5lci5vZmYoInNjcm9sbCByZXNpemUiLCBvbkNoYW5nZSk7DQoJCQlhbmltYXRpb25GcmFtZUNhbmNlbENhbGxiYWNrKF91cGRhdGVDeWNsZSk7DQoJCQlsb2coMywgImRlc3Ryb3llZCAiICsgTkFNRVNQQUNFICsgIiAocmVzZXQ6ICIgKyAocmVzZXRTY2VuZXMgPyAidHJ1ZSIgOiAiZmFsc2UiKSArICIpIik7DQoJCQlyZXR1cm4gbnVsbDsNCgkJfTsNCg0KCQkvLyBJTklUDQoJCWNvbnN0cnVjdCgpOw0KCQlyZXR1cm4gU2Nyb2xsTWFnaWM7DQoJfTsNCglTY3JvbGxNYWdpYy52ZXJzaW9uID0gIjEuMy4wIjsgLy8gdmVyc2lvbiBudW1iZXIgZm9yIGJyb3dzZXIgZ2xvYmFsDQoNCgkvKioNCgkgKiBBIFNjcm9sbFNjZW5lIGRlZmluZXMgd2hlcmUgdGhlIGNvbnRyb2xsZXIgc2hvdWxkIHJlYWN0IGFuZCBob3cuDQoJICoNCgkgKiBAY2xhc3MNCgkgKiBAZ2xvYmFsDQoJICoNCgkgKiBAZXhhbXBsZQ0KCSAqIC8vIGNyZWF0ZSBhIHN0YW5kYXJkIHNjZW5lIGFuZCBhZGQgaXQgdG8gYSBjb250cm9sbGVyDQoJICogbmV3IFNjcm9sbFNjZW5lKCkNCgkgKgkJLmFkZFRvKGNvbnRyb2xsZXIpOw0KCSAqDQoJICogLy8gY3JlYXRlIGEgc2NlbmUgd2l0aCBjdXN0b20gb3B0aW9ucyBhbmQgYXNzaWduIGEgaGFuZGxlciB0byBpdC4NCgkgKiB2YXIgc2NlbmUgPSBuZXcgU2Nyb2xsU2NlbmUoew0KCSAqIAkJZHVyYXRpb246IDEwMCwNCgkgKgkJb2Zmc2V0OiAyMDAsDQoJICoJCXRyaWdnZXJIb29rOiAib25FbnRlciIsDQoJICoJCXJldmVyc2U6IGZhbHNlDQoJICogfSk7DQoJICoNCgkgKiBAcGFyYW0ge29iamVjdH0gW29wdGlvbnNdIC0gT3B0aW9ucyBmb3IgdGhlIFNjZW5lLiBUaGUgb3B0aW9ucyBjYW4gYmUgdXBkYXRlZCBhdCBhbnkgdGltZS4gIA0KCSAJCQkJCQkJICAgSW5zdGVhZCBvZiBzZXR0aW5nIHRoZSBvcHRpb25zIGZvciBlYWNoIHNjZW5lIGluZGl2aWR1YWxseSB5b3UgY2FuIGFsc28gc2V0IHRoZW0gZ2xvYmFsbHkgaW4gdGhlIGNvbnRyb2xsZXIgYXMgdGhlIGNvbnRyb2xsZXJzIGBnbG9iYWxTY2VuZU9wdGlvbnNgIG9wdGlvbi4gVGhlIG9iamVjdCBhY2NlcHRzIHRoZSBzYW1lIHByb3BlcnRpZXMgYXMgdGhlIG9uZXMgYmVsb3cuICANCgkgCQkJCQkJCSAgIFdoZW4gYSBzY2VuZSBpcyBhZGRlZCB0byB0aGUgY29udHJvbGxlciB0aGUgb3B0aW9ucyBkZWZpbmVkIHVzaW5nIHRoZSBTY3JvbGxTY2VuZSBjb25zdHJ1Y3RvciB3aWxsIGJlIG92ZXJ3cml0dGVuIGJ5IHRob3NlIHNldCBpbiBgZ2xvYmFsU2NlbmVPcHRpb25zYC4NCgkgKiBAcGFyYW0geyhudW1iZXJ8ZnVuY3Rpb24pfSBbb3B0aW9ucy5kdXJhdGlvbj0wXSAtIFRoZSBkdXJhdGlvbiBvZiB0aGUgc2NlbmUuIA0KCSAJCQkJCQkJCQkJICBJZiBgMGAgdHdlZW5zIHdpbGwgYXV0by1wbGF5IHdoZW4gcmVhY2hpbmcgdGhlIHNjZW5lIHN0YXJ0IHBvaW50LCBwaW5zIHdpbGwgYmUgcGlubmVkIGluZGVmaW5ldGx5IHN0YXJ0aW5nIGF0IHRoZSBzdGFydCBwb3NpdGlvbi4gIA0KCSAJCQkJCQkJCQkJICBBIGZ1bmN0aW9uIHJldHVuaW5nIHRoZSBkdXJhdGlvbiB2YWx1ZSBpcyBhbHNvIHN1cHBvcnRlZC4gUGxlYXNlIHNlZSBgU2Nyb2xsU2NlbmUuZHVyYXRpb24oKWAgZm9yIGRldGFpbHMuDQoJICogQHBhcmFtIHtudW1iZXJ9IFtvcHRpb25zLm9mZnNldD0wXSAtIE9mZnNldCBWYWx1ZSBmb3IgdGhlIFRyaWdnZXIgUG9zaXRpb24uIElmIG5vIHRyaWdnZXJFbGVtZW50IGlzIGRlZmluZWQgdGhpcyB3aWxsIGJlIHRoZSBzY3JvbGwgZGlzdGFuY2UgZnJvbSB0aGUgc3RhcnQgb2YgdGhlIHBhZ2UsIGFmdGVyIHdoaWNoIHRoZSBzY2VuZSB3aWxsIHN0YXJ0Lg0KCSAqIEBwYXJhbSB7KHN0cmluZ3xvYmplY3QpfSBbb3B0aW9ucy50cmlnZ2VyRWxlbWVudD1udWxsXSAtIFNlbGVjdG9yLCBET00gb2JqZWN0IG9yIGpRdWVyeSBPYmplY3QgdGhhdCBkZWZpbmVzIHRoZSBzdGFydCBvZiB0aGUgc2NlbmUuIElmIHVuZGVmaW5lZCB0aGUgc2NlbmUgd2lsbCBzdGFydCByaWdodCBhdCB0aGUgc3RhcnQgb2YgdGhlIHBhZ2UgKHVubGVzcyBhbiBvZmZzZXQgaXMgc2V0KS4NCgkgKiBAcGFyYW0geyhudW1iZXJ8c3RyaW5nKX0gW29wdGlvbnMudHJpZ2dlckhvb2s9Im9uQ2VudGVyIl0gLSBDYW4gYmUgYSBudW1iZXIgYmV0d2VlbiAwIGFuZCAxIGRlZmluaW5nIHRoZSBwb3NpdGlvbiBvZiB0aGUgdHJpZ2dlciBIb29rIGluIHJlbGF0aW9uIHRvIHRoZSB2aWV3cG9ydC4gIA0KCSAJCQkJCQkJCQkJCQkJCQkgIENhbiBhbHNvIGJlIGRlZmluZWQgdXNpbmcgYSBzdHJpbmc6DQoJIAkJCQkJCQkJCQkJCQkJCSAgKiogYCJvbkVudGVyImAgPT4gYDFgDQoJIAkJCQkJCQkJCQkJCQkJCSAgKiogYCJvbkNlbnRlciJgID0+IGAwLjVgDQoJIAkJCQkJCQkJCQkJCQkJCSAgKiogYCJvbkxlYXZlImAgPT4gYDBgDQoJICogQHBhcmFtIHtib29sZWFufSBbb3B0aW9ucy5yZXZlcnNlPXRydWVdIC0gU2hvdWxkIHRoZSBzY2VuZSByZXZlcnNlLCB3aGVuIHNjcm9sbGluZyB1cD8NCgkgKiBAcGFyYW0ge2Jvb2xlYW59IFtvcHRpb25zLnR3ZWVuQ2hhbmdlcz1mYWxzZV0gLSBUd2VlbnMgQW5pbWF0aW9uIHRvIHRoZSBwcm9ncmVzcyB0YXJnZXQgaW5zdGVhZCBvZiBzZXR0aW5nIGl0LiAgDQoJIAkJCQkJCQkJCQkJCSAgIERvZXMgbm90IGFmZmVjdCBhbmltYXRpb25zIHdoZXJlIGR1cmF0aW9uIGlzIGAwYC4NCgkgKiBAcGFyYW0ge251bWJlcn0gW29wdGlvbnMubG9nbGV2ZWw9Ml0gLSBMb2dsZXZlbCBmb3IgZGVidWdnaW5nLiBOb3RlIHRoYXQgbG9nZ2luZyBpcyBkaXNhYmxlZCBpbiB0aGUgbWluaWZpZWQgdmVyc2lvbiBvZiBTY3JvbGxNYWdpYy4NCgkgCQkJCQkJCQkJCSAgKiogYDBgID0+IHNpbGVudA0KCSAJCQkJCQkJCQkJICAqKiBgMWAgPT4gZXJyb3JzDQoJIAkJCQkJCQkJCQkgICoqIGAyYCA9PiBlcnJvcnMsIHdhcm5pbmdzDQoJIAkJCQkJCQkJCQkgICoqIGAzYCA9PiBlcnJvcnMsIHdhcm5pbmdzLCBkZWJ1Z2luZm8NCgkgKiANCgkgKi8NCgl2YXIgU2Nyb2xsU2NlbmUgPSBmdW5jdGlvbiAob3B0aW9ucykgew0KDQoJCS8qDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICogc2V0dGluZ3MNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKi8NCg0KCQl2YXINCgkJCVRSSUdHRVJfSE9PS19WQUxVRVMgPSB7Im9uQ2VudGVyIiA6IDAuNSwgIm9uRW50ZXIiIDogMSwgIm9uTGVhdmUiIDogMH0sDQoJCQlOQU1FU1BBQ0UgPSAiU2Nyb2xsU2NlbmUiLA0KCQkJREVGQVVMVF9PUFRJT05TID0gew0KCQkJCWR1cmF0aW9uOiAwLA0KCQkJCW9mZnNldDogMCwNCgkJCQl0cmlnZ2VyRWxlbWVudDogbnVsbCwNCgkJCQl0cmlnZ2VySG9vazogIm9uQ2VudGVyIiwNCgkJCQlyZXZlcnNlOiB0cnVlLA0KCQkJCXR3ZWVuQ2hhbmdlczogZmFsc2UsDQoJCQkJbG9nbGV2ZWw6IDINCgkJCX07DQoNCgkJLyoNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKiBwcml2YXRlIHZhcnMNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKi8NCg0KCQl2YXINCgkJCVNjcm9sbFNjZW5lID0gdGhpcywNCgkJCV9vcHRpb25zID0gJC5leHRlbmQoe30sIERFRkFVTFRfT1BUSU9OUywgb3B0aW9ucyksDQoJCQlfc3RhdGUgPSAnQkVGT1JFJywNCgkJCV9wcm9ncmVzcyA9IDAsDQoJCQlfc2Nyb2xsT2Zmc2V0ID0ge3N0YXJ0OiAwLCBlbmQ6IDB9LCAvLyByZWZsZWN0cyB0aGUgcGFyZW50J3Mgc2Nyb2xsIHBvc2l0aW9uIGZvciB0aGUgc3RhcnQgYW5kIGVuZCBvZiB0aGUgc2NlbmUgcmVzcGVjdGl2ZWx5DQoJCQlfdHJpZ2dlclBvcyA9IDAsDQoJCQlfZW5hYmxlZCA9IHRydWUsDQoJCQlfZHVyYXRpb25VcGRhdGVNZXRob2QsDQoJCQlfcGFyZW50LA0KCQkJX3R3ZWVuLA0KCQkJX3BpbiwNCgkJCV9waW5PcHRpb25zLA0KCQkJX2Nzc0NsYXNzZXMsDQoJCQlfY3NzQ2xhc3NFbG07DQoNCgkJLy8gb2JqZWN0IGNvbnRhaW5pbmcgdmFsaWRhdG9yIGZ1bmN0aW9ucyBmb3IgdmFyaW91cyBvcHRpb25zDQoJCXZhciBfdmFsaWRhdGUgPSB7DQoJCQkidW5rbm93bk9wdGlvblN1cHBsaWVkIiA6IGZ1bmN0aW9uICgpIHsNCgkJCQkJJC5lYWNoKF9vcHRpb25zLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgew0KCQkJCQlpZiAoIURFRkFVTFRfT1BUSU9OUy5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7DQoJCQkJCQlsb2coMiwgIldBUk5JTkc6IFVua25vd24gb3B0aW9uIFwiIiArIGtleSArICJcIiIpOw0KCQkJCQkJZGVsZXRlIF9vcHRpb25zW2tleV07DQoJCQkJCX0NCgkJCQl9KTsNCgkJCX0sDQoJCQkiZHVyYXRpb24iIDogZnVuY3Rpb24gKCkgew0KCQkJCWlmICgkLmlzRnVuY3Rpb24oX29wdGlvbnMuZHVyYXRpb24pKSB7DQoJCQkJCV9kdXJhdGlvblVwZGF0ZU1ldGhvZCA9IF9vcHRpb25zLmR1cmF0aW9uOw0KCQkJCQl0cnkgew0KCQkJCQkJX29wdGlvbnMuZHVyYXRpb24gPSBwYXJzZUZsb2F0KF9kdXJhdGlvblVwZGF0ZU1ldGhvZCgpKTsNCgkJCQkJfSBjYXRjaCAoZSkgew0KCQkJCQkJbG9nKDEsICJFUlJPUjogSW52YWxpZCByZXR1cm4gdmFsdWUgb2Ygc3VwcGxpZWQgZnVuY3Rpb24gZm9yIG9wdGlvbiBcImR1cmF0aW9uXCI6IiwgX29wdGlvbnMuZHVyYXRpb24pOw0KCQkJCQkJX2R1cmF0aW9uVXBkYXRlTWV0aG9kID0gdW5kZWZpbmVkOw0KCQkJCQkJX29wdGlvbnMuZHVyYXRpb24gPSBERUZBVUxUX09QVElPTlMuZHVyYXRpb247DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQlfb3B0aW9ucy5kdXJhdGlvbiA9IHBhcnNlRmxvYXQoX29wdGlvbnMuZHVyYXRpb24pOw0KCQkJCQlpZiAoISQuaXNOdW1lcmljKF9vcHRpb25zLmR1cmF0aW9uKSB8fCBfb3B0aW9ucy5kdXJhdGlvbiA8IDApIHsNCgkJCQkJCWxvZygxLCAiRVJST1I6IEludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcImR1cmF0aW9uXCI6IiwgX29wdGlvbnMuZHVyYXRpb24pOw0KCQkJCQkJX29wdGlvbnMuZHVyYXRpb24gPSBERUZBVUxUX09QVElPTlMuZHVyYXRpb247DQoJCQkJCX0NCgkJCQl9DQoJCQl9LA0KCQkJIm9mZnNldCIgOiBmdW5jdGlvbiAoKSB7DQoJCQkJX29wdGlvbnMub2Zmc2V0ID0gcGFyc2VGbG9hdChfb3B0aW9ucy5vZmZzZXQpOw0KCQkJCWlmICghJC5pc051bWVyaWMoX29wdGlvbnMub2Zmc2V0KSkgew0KCQkJCQlsb2coMSwgIkVSUk9SOiBJbnZhbGlkIHZhbHVlIGZvciBvcHRpb24gXCJvZmZzZXRcIjoiLCBfb3B0aW9ucy5vZmZzZXQpOw0KCQkJCQlfb3B0aW9ucy5vZmZzZXQgPSBERUZBVUxUX09QVElPTlMub2Zmc2V0Ow0KCQkJCX0NCgkJCX0sDQoJCQkidHJpZ2dlckVsZW1lbnQiIDogZnVuY3Rpb24gKCkgew0KCQkJCWlmIChfb3B0aW9ucy50cmlnZ2VyRWxlbWVudCAhPT0gbnVsbCAmJiAkKF9vcHRpb25zLnRyaWdnZXJFbGVtZW50KS5sZW5ndGggPT09IDApIHsNCgkJCQkJbG9nKDEsICJFUlJPUjogRWxlbWVudCBkZWZpbmVkIGluIG9wdGlvbiBcInRyaWdnZXJFbGVtZW50XCIgd2FzIG5vdCBmb3VuZDoiLCBfb3B0aW9ucy50cmlnZ2VyRWxlbWVudCk7DQoJCQkJCV9vcHRpb25zLnRyaWdnZXJFbGVtZW50ID0gREVGQVVMVF9PUFRJT05TLnRyaWdnZXJFbGVtZW50Ow0KCQkJCX0NCgkJCX0sDQoJCQkidHJpZ2dlckhvb2siIDogZnVuY3Rpb24gKCkgew0KCQkJCWlmICghKF9vcHRpb25zLnRyaWdnZXJIb29rIGluIFRSSUdHRVJfSE9PS19WQUxVRVMpKSB7DQoJCQkJCWlmICgkLmlzTnVtZXJpYyhfb3B0aW9ucy50cmlnZ2VySG9vaykpIHsNCgkJCQkJCV9vcHRpb25zLnRyaWdnZXJIb29rID0gTWF0aC5tYXgoMCwgTWF0aC5taW4ocGFyc2VGbG9hdChfb3B0aW9ucy50cmlnZ2VySG9vayksIDEpKTsgLy8gIG1ha2Ugc3VyZSBpdHMgYmV0d2VlZW4gMCBhbmQgMQ0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJbG9nKDEsICJFUlJPUjogSW52YWxpZCB2YWx1ZSBmb3Igb3B0aW9uIFwidHJpZ2dlckhvb2tcIjogIiwgX29wdGlvbnMudHJpZ2dlckhvb2spOw0KCQkJCQkJX29wdGlvbnMudHJpZ2dlckhvb2sgPSBERUZBVUxUX09QVElPTlMudHJpZ2dlckhvb2s7DQoJCQkJCX0NCgkJCQl9DQoJCQl9LA0KCQkJInJldmVyc2UiIDogZnVuY3Rpb24gKCkgew0KCQkJCV9vcHRpb25zLnJldmVyc2UgPSAhIV9vcHRpb25zLnJldmVyc2U7IC8vIGZvcmNlIGJvb2xlYW4NCgkJCX0sDQoJCQkidHdlZW5DaGFuZ2VzIiA6IGZ1bmN0aW9uICgpIHsNCgkJCQlfb3B0aW9ucy50d2VlbkNoYW5nZXMgPSAhIV9vcHRpb25zLnR3ZWVuQ2hhbmdlczsgLy8gZm9yY2UgYm9vbGVhbg0KCQkJfSwNCgkJCSJsb2dsZXZlbCIgOiBmdW5jdGlvbiAoKSB7DQoJCQkJX29wdGlvbnMubG9nbGV2ZWwgPSBwYXJzZUludChfb3B0aW9ucy5sb2dsZXZlbCk7DQoJCQkJaWYgKCEkLmlzTnVtZXJpYyhfb3B0aW9ucy5sb2dsZXZlbCkgfHwgX29wdGlvbnMubG9nbGV2ZWwgPCAwIHx8IF9vcHRpb25zLmxvZ2xldmVsID4gMykgew0KCQkJCQl2YXIgd3Jvbmd2YWwgPSBfb3B0aW9ucy5sb2dsZXZlbDsNCgkJCQkJX29wdGlvbnMubG9nbGV2ZWwgPSBERUZBVUxUX09QVElPTlMubG9nbGV2ZWw7DQoJCQkJCWxvZygxLCAiRVJST1I6IEludmFsaWQgdmFsdWUgZm9yIG9wdGlvbiBcImxvZ2xldmVsXCI6Iiwgd3Jvbmd2YWwpOw0KCQkJCX0NCgkJCX0sDQoJCX07DQoNCgkJLyoNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKiBwcml2YXRlIGZ1bmN0aW9ucw0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqLw0KDQoJCS8qKg0KCQkgKiBJbnRlcm5hbCBjb25zdHJ1Y3RvciBmdW5jdGlvbiBvZiBTY3JvbGxNYWdpYw0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIGNvbnN0cnVjdCA9IGZ1bmN0aW9uICgpIHsNCgkJCXZhbGlkYXRlT3B0aW9uKCk7DQoNCgkJCS8vIGV2ZW50IGxpc3RlbmVycw0KCQkJU2Nyb2xsU2NlbmUNCgkJCQkub24oImNoYW5nZS5pbnRlcm5hbCIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCWlmIChlLndoYXQgIT09ICJsb2dsZXZlbCIgJiYgZS53aGF0ICE9PSAidHdlZW5DaGFuZ2VzIikgeyAvLyBubyBuZWVkIGZvciBhIHNjZW5lIHVwZGF0ZSBzY2VuZSB3aXRoIHRoZXNlIG9wdGlvbnMuLi4NCgkJCQkJCWlmIChlLndoYXQgPT09ICJ0cmlnZ2VyRWxlbWVudCIpIHsNCgkJCQkJCQl1cGRhdGVUcmlnZ2VyRWxlbWVudFBvc2l0aW9uKCk7DQoJCQkJCQl9IGVsc2UgaWYgKGUud2hhdCA9PT0gInJldmVyc2UiKSB7IC8vIHRoZSBvbmx5IHByb3BlcnR5IGxlZnQgdGhhdCBtYXkgaGF2ZSBhbiBpbXBhY3Qgb24gdGhlIGN1cnJlbnQgc2NlbmUgc3RhdGUuIEV2ZXJ5dGhpbmcgZWxzZSBpcyBoYW5kbGVkIGJ5IHRoZSBzaGlmdCBldmVudC4NCgkJCQkJCQlTY3JvbGxTY2VuZS51cGRhdGUoKTsNCgkJCQkJCX0NCgkJCQkJfQ0KCQkJCX0pDQoJCQkJLm9uKCJzaGlmdC5pbnRlcm5hbCIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCXVwZGF0ZVNjcm9sbE9mZnNldCgpOw0KCQkJCQlTY3JvbGxTY2VuZS51cGRhdGUoKTsgLy8gdXBkYXRlIHNjZW5lIHRvIHJlZmxlY3QgbmV3IHBvc2l0aW9uDQoJCQkJCWlmICgoX3N0YXRlID09PSAiQUZURVIiICYmIGUucmVhc29uID09PSAiZHVyYXRpb24iKSB8fCAoX3N0YXRlID09PSAnRFVSSU5HJyAmJiBfb3B0aW9ucy5kdXJhdGlvbiA9PT0gMCkpIHsNCgkJCQkJCS8vIGlmIFtkdXJhdGlvbiBjaGFuZ2VkIGFmdGVyIGEgc2NlbmUgKGluc2lkZSBzY2VuZSBwcm9ncmVzcyB1cGRhdGVzIHBpbiBwb3NpdGlvbildIG9yIFtkdXJhdGlvbiBpcyAwLCB3ZSBhcmUgaW4gcGluIHBoYXNlIGFuZCBzb21lIG90aGVyIHZhbHVlIGNoYW5nZWRdLg0KCQkJCQkJdXBkYXRlUGluU3RhdGUoKTsNCgkJCQkJfQ0KCQkJCX0pDQoJCQkJLm9uKCJwcm9ncmVzcy5pbnRlcm5hbCIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCXVwZGF0ZVR3ZWVuUHJvZ3Jlc3MoKTsNCgkJCQkJdXBkYXRlUGluU3RhdGUoKTsNCgkJCQl9KQ0KCQkJCS5vbigiZGVzdHJveSIsIGZ1bmN0aW9uIChlKSB7DQoJCQkJCWUucHJldmVudERlZmF1bHQoKTsgLy8gb3RoZXJ3aXNlIGpRdWVyeSB3b3VsZCBjYWxsIHRhcmdldC5kZXN0cm95KCkgYnkgZGVmYXVsdC4NCgkJCQl9KTsNCgkJfTsNCgkJDQoJCS8qKg0KCQkgKiBTZW5kIGEgZGVidWcgbWVzc2FnZSB0byB0aGUgY29uc29sZS4NCgkJICogQHByaXZhdGUNCgkJICoNCgkJICogQHBhcmFtIHtudW1iZXJ9IGxvZ2xldmVsIC0gVGhlIGxvZ2xldmVsIHJlcXVpcmVkIHRvIGluaXRpYXRlIG91dHB1dCBmb3IgdGhlIG1lc3NhZ2UuDQoJCSAqIEBwYXJhbSB7Li4ubWl4ZWR9IG91dHB1dCAtIE9uZSBvciBtb3JlIHZhcmlhYmxlcyB0aGF0IHNob3VsZCBiZSBwYXNzZWQgdG8gdGhlIGNvbnNvbGUuDQoJCSAqLw0KCQl2YXIgbG9nID0gZnVuY3Rpb24gKGxvZ2xldmVsLCBvdXRwdXQpIHsNCgkJCWlmIChfb3B0aW9ucy5sb2dsZXZlbCA+PSBsb2dsZXZlbCkgew0KCQkJCXZhcg0KCQkJCQlwcmVmaXggPSAiKCIgKyBOQU1FU1BBQ0UgKyAiKSAtPiIsDQoJCQkJCWFyZ3MgPSBBcnJheS5wcm90b3R5cGUuc3BsaWNlLmNhbGwoYXJndW1lbnRzLCAxKTsNCgkJCQlhcmdzLnVuc2hpZnQobG9nbGV2ZWwsIHByZWZpeCk7DQoJCQkJZGVidWcuYXBwbHkod2luZG93LCBhcmdzKTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJICogQ2hlY2tzIHRoZSB2YWxpZGl0eSBvZiBhIHNwZWNpZmljIG9yIGFsbCBvcHRpb25zIGFuZCByZXNldCB0byBkZWZhdWx0IGlmIG5lY2Nlc3NhcnkuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl2YXIgdmFsaWRhdGVPcHRpb24gPSBmdW5jdGlvbiAoY2hlY2spIHsNCgkJCWlmICghYXJndW1lbnRzLmxlbmd0aCkgew0KCQkJCWNoZWNrID0gW107DQoJCQkJZm9yICh2YXIga2V5IGluIF92YWxpZGF0ZSl7DQoJCQkJCWNoZWNrLnB1c2goa2V5KTsNCgkJCQl9DQoJCQl9IGVsc2UgaWYgKCEkLmlzQXJyYXkoY2hlY2spKSB7DQoJCQkJY2hlY2sgPSBbY2hlY2tdOw0KCQkJfQ0KCQkJJC5lYWNoKGNoZWNrLCBmdW5jdGlvbiAoa2V5LCB2YWx1ZSkgew0KCQkJCWlmIChfdmFsaWRhdGVbdmFsdWVdKSB7DQoJCQkJCV92YWxpZGF0ZVt2YWx1ZV0oKTsNCgkJCQl9DQoJCQl9KTsNCgkJfTsNCg0KCQkvKioNCgkJICogSGVscGVyIHVzZWQgYnkgdGhlIHNldHRlci9nZXR0ZXJzIGZvciBzY2VuZSBvcHRpb25zDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl2YXIgY2hhbmdlT3B0aW9uID0gZnVuY3Rpb24odmFybmFtZSwgbmV3dmFsKSB7DQoJCQl2YXINCgkJCQljaGFuZ2VkID0gZmFsc2UsDQoJCQkJb2xkdmFsID0gX29wdGlvbnNbdmFybmFtZV07DQoJCQlpZiAoX29wdGlvbnNbdmFybmFtZV0gIT0gbmV3dmFsKSB7DQoJCQkJX29wdGlvbnNbdmFybmFtZV0gPSBuZXd2YWw7DQoJCQkJdmFsaWRhdGVPcHRpb24odmFybmFtZSk7IC8vIHJlc2V0cyB0byBkZWZhdWx0IGlmIG5lY2Vzc2FyeQ0KCQkJCWNoYW5nZWQgPSBvbGR2YWwgIT0gX29wdGlvbnNbdmFybmFtZV07DQoJCQl9DQoJCQlyZXR1cm4gY2hhbmdlZDsNCgkJfTsNCg0KCQkvKioNCgkJICogVXBkYXRlIHRoZSBzdGFydCBhbmQgZW5kIHNjcm9sbE9mZnNldCBvZiB0aGUgY29udGFpbmVyLg0KCQkgKiBUaGUgcG9zaXRpb25zIHJlZmxlY3Qgd2hhdCB0aGUgcGFyZW50J3Mgc2Nyb2xsIHBvc2l0aW9uIHdpbGwgYmUgYXQgdGhlIHN0YXJ0IGFuZCBlbmQgcmVzcGVjdGl2ZWx5Lg0KCQkgKiBJcyBjYWxsZWQsIHdoZW46DQoJCSAqICAgLSBTY3JvbGxTY2VuZSBldmVudCAiY2hhbmdlIiBpcyBjYWxsZWQgd2l0aDogb2Zmc2V0LCB0cmlnZ2VySG9vaywgZHVyYXRpb24gDQoJCSAqICAgLSBzY3JvbGwgY29udGFpbmVyIGV2ZW50ICJyZXNpemUiIGlzIGNhbGxlZA0KCQkgKiAgIC0gdGhlIHBvc2l0aW9uIG9mIHRoZSB0cmlnZ2VyRWxlbWVudCBjaGFuZ2VzDQoJCSAqICAgLSB0aGUgcGFyZW50IGNoYW5nZXMgLT4gYWRkVG8oKQ0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIHVwZGF0ZVNjcm9sbE9mZnNldCA9IGZ1bmN0aW9uICgpIHsNCgkJCV9zY3JvbGxPZmZzZXQgPSB7c3RhcnQ6IF90cmlnZ2VyUG9zICsgX29wdGlvbnMub2Zmc2V0fTsNCgkJCWlmIChfcGFyZW50ICYmIF9vcHRpb25zLnRyaWdnZXJFbGVtZW50KSB7DQoJCQkJLy8gdGFrZSBhd2F5IHRyaWdnZXJIb29rIHBvcnRpb24gdG8gZ2V0IHJlbGF0aXZlIHRvIHRvcA0KCQkJCV9zY3JvbGxPZmZzZXQuc3RhcnQgLT0gX3BhcmVudC5pbmZvKCJzaXplIikgKiBTY3JvbGxTY2VuZS50cmlnZ2VySG9vaygpOw0KCQkJfQ0KCQkJX3Njcm9sbE9mZnNldC5lbmQgPSBfc2Nyb2xsT2Zmc2V0LnN0YXJ0ICsgX29wdGlvbnMuZHVyYXRpb247DQoJCX07DQoNCgkJLyoqDQoJCSAqIFVwZGF0ZXMgdGhlIGR1cmF0aW9uIGlmIHNldCB0byBhIGR5bmFtaWMgZnVuY3Rpb24uDQoJCSAqIFRoaXMgbWV0aG9kIGlzIGNhbGxlZCB3aGVuIHRoZSBzY2VuZSBpcyBhZGRlZCB0byBhIGNvbnRyb2xsZXIgYW5kIGluIHJlZ3VsYXIgaW50ZXJ2YWxzIGZyb20gdGhlIGNvbnRyb2xsZXIgdGhyb3VnaCBzY2VuZS5yZWZyZXNoKCkuDQoJCSAqIA0KCQkgKiBAZmlyZXMge0BsaW5rIFNjcm9sbFNjZW5lLmNoYW5nZX0sIGlmIHRoZSBkdXJhdGlvbiBjaGFuZ2VkDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUuc2hpZnR9LCBpZiB0aGUgZHVyYXRpb24gY2hhbmdlZA0KCQkgKg0KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtzdXBwcmVzc0V2ZW50cz1mYWxzZV0gLSBJZiB0cnVlIHRoZSBzaGlmdCBldmVudCB3aWxsIGJlIHN1cHByZXNzZWQuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl2YXIgdXBkYXRlRHVyYXRpb24gPSBmdW5jdGlvbiAoc3VwcHJlc3NFdmVudHMpIHsNCgkJCS8vIHVwZGF0ZSBkdXJhdGlvbg0KCQkJaWYgKF9kdXJhdGlvblVwZGF0ZU1ldGhvZCkgew0KCQkJCXZhciB2YXJuYW1lID0gImR1cmF0aW9uIjsNCgkJCQlpZiAoY2hhbmdlT3B0aW9uKHZhcm5hbWUsIF9kdXJhdGlvblVwZGF0ZU1ldGhvZC5jYWxsKFNjcm9sbFNjZW5lKSkgJiYgIXN1cHByZXNzRXZlbnRzKSB7IC8vIHNldA0KCQkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJjaGFuZ2UiLCB7d2hhdDogdmFybmFtZSwgbmV3dmFsOiBfb3B0aW9uc1t2YXJuYW1lXX0pOw0KCQkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJzaGlmdCIsIHtyZWFzb246IHZhcm5hbWV9KTsNCgkJCQl9DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSAqIFVwZGF0ZXMgdGhlIHBvc2l0aW9uIG9mIHRoZSB0cmlnZ2VyRWxlbWVudCwgaWYgcHJlc2VudC4NCgkJICogVGhpcyBtZXRob2QgaXMgY2FsbGVkIC4uLg0KCQkgKiAgLSAuLi4gd2hlbiB0aGUgdHJpZ2dlckVsZW1lbnQgaXMgY2hhbmdlZA0KCQkgKiAgLSAuLi4gd2hlbiB0aGUgc2NlbmUgaXMgYWRkZWQgdG8gYSAobmV3KSBjb250cm9sbGVyDQoJCSAqICAtIC4uLiBpbiByZWd1bGFyIGludGVydmFscyBmcm9tIHRoZSBjb250cm9sbGVyIHRocm91Z2ggc2NlbmUucmVmcmVzaCgpLg0KCQkgKiANCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5zaGlmdH0sIGlmIHRoZSBwb3NpdGlvbiBjaGFuZ2VkDQoJCSAqDQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3N1cHByZXNzRXZlbnRzPWZhbHNlXSAtIElmIHRydWUgdGhlIHNoaWZ0IGV2ZW50IHdpbGwgYmUgc3VwcHJlc3NlZC4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCXZhciB1cGRhdGVUcmlnZ2VyRWxlbWVudFBvc2l0aW9uID0gZnVuY3Rpb24gKHN1cHByZXNzRXZlbnRzKSB7DQoJCQl2YXIgZWxlbWVudFBvcyA9IDA7DQoJCQlpZiAoX3BhcmVudCAmJiBfb3B0aW9ucy50cmlnZ2VyRWxlbWVudCkgew0KCQkJCXZhcg0KCQkJCQllbGVtZW50ID0gJChfb3B0aW9ucy50cmlnZ2VyRWxlbWVudCkuZmlyc3QoKSwNCgkJCQkJY29udHJvbGxlckluZm8gPSBfcGFyZW50LmluZm8oKSwNCgkJCQkJY29udGFpbmVyT2Zmc2V0ID0gZ2V0T2Zmc2V0KGNvbnRyb2xsZXJJbmZvLmNvbnRhaW5lciksIC8vIGNvbnRhaW5lciBwb3NpdGlvbiBpcyBuZWVkZWQgYmVjYXVzZSBlbGVtZW50IG9mZnNldCBpcyByZXR1cm5lZCBpbiByZWxhdGlvbiB0byBkb2N1bWVudCwgbm90IGluIHJlbGF0aW9uIHRvIGNvbnRhaW5lci4NCgkJCQkJcGFyYW0gPSBjb250cm9sbGVySW5mby52ZXJ0aWNhbCA/ICJ0b3AiIDogImxlZnQiOyAvLyB3aGljaCBwYXJhbSBpcyBvZiBpbnRlcmVzdCA/DQoJCQkJCQ0KCQkJCS8vIGlmIHBhcmVudCBpcyBzcGFjZXIsIHVzZSBzcGFjZXIgcG9zaXRpb24gaW5zdGVhZCBzbyBjb3JyZWN0IHN0YXJ0IHBvc2l0aW9uIGlzIHJldHVybmVkIGZvciBwaW5uZWQgZWxlbWVudHMuDQoJCQkJd2hpbGUgKGVsZW1lbnQucGFyZW50KCkuZGF0YSgiU2Nyb2xsTWFnaWNQaW5TcGFjZXIiKSkgew0KCQkJCQllbGVtZW50ID0gZWxlbWVudC5wYXJlbnQoKTsNCgkJCQl9DQoNCgkJCQl2YXIgZWxlbWVudE9mZnNldCA9IGdldE9mZnNldChlbGVtZW50KTsNCg0KCQkJCWlmICghY29udHJvbGxlckluZm8uaXNEb2N1bWVudCkgeyAvLyBjb250YWluZXIgaXMgbm90IHRoZSBkb2N1bWVudCByb290LCBzbyBzdWJzdHJhY3Qgc2Nyb2xsIFBvc2l0aW9uIHRvIGdldCBjb3JyZWN0IHRyaWdnZXIgZWxlbWVudCBwb3NpdGlvbiByZWxhdGl2ZSB0byBzY3JvbGxjb250ZW50DQoJCQkJCWNvbnRhaW5lck9mZnNldFtwYXJhbV0gLT0gX3BhcmVudC5zY3JvbGxQb3MoKTsNCgkJCQl9DQoNCgkJCQllbGVtZW50UG9zID0gZWxlbWVudE9mZnNldFtwYXJhbV0gLSBjb250YWluZXJPZmZzZXRbcGFyYW1dOw0KCQkJfQ0KCQkJdmFyIGNoYW5nZWQgPSBlbGVtZW50UG9zICE9IF90cmlnZ2VyUG9zOw0KCQkJX3RyaWdnZXJQb3MgPSBlbGVtZW50UG9zOw0KCQkJaWYgKGNoYW5nZWQgJiYgIXN1cHByZXNzRXZlbnRzKSB7DQoJCQkJU2Nyb2xsU2NlbmUudHJpZ2dlcigic2hpZnQiLCB7cmVhc29uOiAidHJpZ2dlckVsZW1lbnRQb3NpdGlvbiJ9KTsNCgkJCX0NCgkJfTsNCg0KCQkvKioNCgkJICogVXBkYXRlIHRoZSB0d2VlbiBwcm9ncmVzcy4NCgkJICogQHByaXZhdGUNCgkJICoNCgkJICogQHBhcmFtIHtudW1iZXJ9IFt0b10gLSBJZiBub3Qgc2V0IHRoZSBzY2VuZSBQcm9ncmVzcyB3aWxsIGJlIHVzZWQuIChtb3N0IGNhc2VzKQ0KCQkgKiBAcmV0dXJuIHtib29sZWFufSB0cnVlIGlmIHRoZSBUd2VlbiB3YXMgdXBkYXRlZC4gDQoJCSAqLw0KCQl2YXIgdXBkYXRlVHdlZW5Qcm9ncmVzcyA9IGZ1bmN0aW9uICh0bykgew0KCQkJaWYgKF90d2Vlbikgew0KCQkJCXZhciBwcm9ncmVzcyA9ICh0byA+PSAwICYmIHRvIDw9IDEpID8gdG8gOiBfcHJvZ3Jlc3M7DQoJCQkJaWYgKF90d2Vlbi5yZXBlYXQoKSA9PT0gLTEpIHsNCgkJCQkJLy8gaW5maW5pdGUgbG9vcCwgc28gbm90IGluIHJlbGF0aW9uIHRvIHByb2dyZXNzDQoJCQkJCWlmIChfc3RhdGUgPT09ICJEVVJJTkciICYmIF90d2Vlbi5wYXVzZWQoKSkgew0KCQkJCQkJX3R3ZWVuLnBsYXkoKTsNCgkJCQkJfSBlbHNlIGlmIChfc3RhdGUgIT09ICJEVVJJTkciICYmICFfdHdlZW4ucGF1c2VkKCkpIHsNCgkJCQkJCV90d2Vlbi5wYXVzZSgpOw0KCQkJCQl9IGVsc2Ugew0KCQkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCQl9DQoJCQkJfSBlbHNlIGlmIChwcm9ncmVzcyAhPSBfdHdlZW4ucHJvZ3Jlc3MoKSkgeyAvLyBkbyB3ZSBldmVuIG5lZWQgdG8gdXBkYXRlIHRoZSBwcm9ncmVzcz8NCgkJCQkJLy8gbm8gaW5maW5pdGUgbG9vcCAtIHNvIHNob3VsZCB3ZSBqdXN0IHBsYXkgb3IgZ28gdG8gYSBzcGVjaWZpYyBwb2ludCBpbiB0aW1lPw0KCQkJCQlpZiAoX29wdGlvbnMuZHVyYXRpb24gPT09IDApIHsNCgkJCQkJCS8vIHBsYXkgdGhlIGFuaW1hdGlvbg0KCQkJCQkJaWYgKF9zdGF0ZSA9PT0gIkRVUklORyIpIHsgLy8gcGxheSBmcm9tIDAgdG8gMQ0KCQkJCQkJCV90d2Vlbi5wbGF5KCk7DQoJCQkJCQl9IGVsc2UgeyAvLyBwbGF5IGZyb20gMSB0byAwDQoJCQkJCQkJX3R3ZWVuLnJldmVyc2UoKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCS8vIGdvIHRvIGEgc3BlY2lmaWMgcG9pbnQgaW4gdGltZQ0KCQkJCQkJaWYgKF9vcHRpb25zLnR3ZWVuQ2hhbmdlcykgew0KCQkJCQkJCS8vIGdvIHNtb290aA0KCQkJCQkJCV90d2Vlbi50d2VlblRvKHByb2dyZXNzICogX3R3ZWVuLmR1cmF0aW9uKCkpOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBqdXN0IGhhcmQgc2V0IGl0DQoJCQkJCQkJX3R3ZWVuLnByb2dyZXNzKHByb2dyZXNzKS5wYXVzZSgpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJcmV0dXJuIGZhbHNlOw0KCQkJCX0NCgkJCQlyZXR1cm4gdHJ1ZTsNCgkJCX0gZWxzZSB7DQoJCQkJcmV0dXJuIGZhbHNlOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBVcGRhdGUgdGhlIHBpbiBzdGF0ZS4NCgkJICogQHByaXZhdGUNCgkJICovDQoJCXZhciB1cGRhdGVQaW5TdGF0ZSA9IGZ1bmN0aW9uIChmb3JjZVVucGluKSB7DQoJCQlpZiAoX3BpbiAmJiBfcGFyZW50KSB7DQoJCQkJdmFyIA0KCQkJCQljb250YWluZXJJbmZvID0gX3BhcmVudC5pbmZvKCk7DQoNCgkJCQlpZiAoIWZvcmNlVW5waW4gJiYgX3N0YXRlID09PSAiRFVSSU5HIikgeyAvLyBkdXJpbmcgc2NlbmUgb3IgaWYgZHVyYXRpb24gaXMgMCBhbmQgd2UgYXJlIHBhc3QgdGhlIHRyaWdnZXINCgkJCQkJLy8gcGlubmVkIHN0YXRlDQoJCQkJCWlmIChfcGluLmNzcygicG9zaXRpb24iKSAhPSAiZml4ZWQiKSB7DQoJCQkJCQkvLyBjaGFuZ2Ugc3RhdGUgYmVmb3JlIHVwZGF0aW5nIHBpbiBzcGFjZXIgKHBvc2l0aW9uIGNoYW5nZXMgZHVlIHRvIGZpeGVkIGNvbGxhcHNpbmcgbWlnaHQgb2NjdXIuKQ0KCQkJCQkJX3Bpbi5jc3MoInBvc2l0aW9uIiwgImZpeGVkIik7DQoJCQkJCQkvLyB1cGRhdGUgcGluIHNwYWNlcg0KCQkJCQkJdXBkYXRlUGluU3BhY2VyU2l6ZSgpOw0KCQkJCQkJLy8gYWRkIHBpbm5lZCBjbGFzcw0KCQkJCQkJX3Bpbi5hZGRDbGFzcyhfcGluT3B0aW9ucy5waW5uZWRDbGFzcyk7DQoJCQkJCX0NCg0KCQkJCQl2YXINCgkJCQkJCWZpeGVkUG9zID0gZ2V0T2Zmc2V0KF9waW5PcHRpb25zLnNwYWNlciwgdHJ1ZSksIC8vIGdldCB2aWV3cG9ydCBwb3NpdGlvbiBvZiBzcGFjZXINCiAJCQkJCQlzY3JvbGxEaXN0YW5jZSA9IF9vcHRpb25zLnJldmVyc2UgfHwgX29wdGlvbnMuZHVyYXRpb24gPT09IDAgPw0KIAkJCQkJCQkJCQkgCSBjb250YWluZXJJbmZvLnNjcm9sbFBvcyAtIF9zY3JvbGxPZmZzZXQuc3RhcnQgLy8gcXVpY2tlcg0KIAkJCQkJCQkJCQkgOiBNYXRoLnJvdW5kKF9wcm9ncmVzcyAqIF9vcHRpb25zLmR1cmF0aW9uICogMTApLzEwOyAvLyBpZiBubyByZXZlcnNlIGFuZCBkdXJpbmcgcGluIHRoZSBwb3NpdGlvbiBuZWVkcyB0byBiZSByZWNhbGN1bGF0ZWQgdXNpbmcgdGhlIHByb2dyZXNzDQogCQkJCQkNCiAJCQkJCS8vIHJlbW92ZSBzcGFjZXIgbWFyZ2luIHRvIGdldCByZWFsIHBvc2l0aW9uIChpbiBjYXNlIG1hcmdpbkNvbGxhcHNlIG1vZGUpDQogCQkJCQlmaXhlZFBvcy50b3AgLT0gcGFyc2VGbG9hdChfcGluT3B0aW9ucy5zcGFjZXIuY3NzKCJtYXJnaW4tdG9wIikpOw0KDQogCQkJCQkvLyBhZGQgc2Nyb2xsRGlzdGFuY2UNCiAJCQkJCWZpeGVkUG9zW2NvbnRhaW5lckluZm8udmVydGljYWwgPyAidG9wIiA6ICJsZWZ0Il0gKz0gc2Nyb2xsRGlzdGFuY2U7DQoNCgkJCQkJLy8gc2V0IG5ldyB2YWx1ZXMNCgkJCQkJX3Bpbi5jc3Moew0KCQkJCQkJdG9wOiBmaXhlZFBvcy50b3AsDQoJCQkJCQlsZWZ0OiBmaXhlZFBvcy5sZWZ0DQoJCQkJCX0pOw0KCQkJCX0gZWxzZSB7DQoJCQkJCS8vIHVucGlubmVkIHN0YXRlDQoJCQkJCXZhcg0KCQkJCQkJbmV3Q1NTID0gew0KCQkJCQkJCXBvc2l0aW9uOiBfcGluT3B0aW9ucy5pbkZsb3cgPyAicmVsYXRpdmUiIDogImFic29sdXRlIiwNCgkJCQkJCQl0b3A6ICAwLA0KCQkJCQkJCWxlZnQ6IDANCgkJCQkJCX0sDQoJCQkJCQljaGFuZ2UgPSBfcGluLmNzcygicG9zaXRpb24iKSAhPSBuZXdDU1MucG9zaXRpb247DQoJCQkJCQ0KCQkJCQlpZiAoIV9waW5PcHRpb25zLnB1c2hGb2xsb3dlcnMpIHsNCgkJCQkJCW5ld0NTU1tjb250YWluZXJJbmZvLnZlcnRpY2FsID8gInRvcCIgOiAibGVmdCJdID0gX29wdGlvbnMuZHVyYXRpb24gKiBfcHJvZ3Jlc3M7DQoJCQkJCX0gZWxzZSBpZiAoX29wdGlvbnMuZHVyYXRpb24gPiAwKSB7IC8vIG9ubHkgY29uY2VybnMgc2NlbmVzIHdpdGggZHVyYXRpb24NCgkJCQkJCWlmIChfc3RhdGUgPT09ICJBRlRFUiIgJiYgcGFyc2VGbG9hdChfcGluT3B0aW9ucy5zcGFjZXIuY3NzKCJwYWRkaW5nLXRvcCIpKSA9PT0gMCkgew0KCQkJCQkJCWNoYW5nZSA9IHRydWU7IC8vIGlmIGluIGFmdGVyIHN0YXRlIGJ1dCBoYXZlbnQgdXBkYXRlZCBzcGFjZXIgeWV0IChqdW1wZWQgcGFzdCBwaW4pDQoJCQkJCQl9IGVsc2UgaWYgKF9zdGF0ZSA9PT0gIkJFRk9SRSIgJiYgcGFyc2VGbG9hdChfcGluT3B0aW9ucy5zcGFjZXIuY3NzKCJwYWRkaW5nLWJvdHRvbSIpKSA9PT0gMCkgeyAvLyBiZWZvcmUNCgkJCQkJCQljaGFuZ2UgPSB0cnVlOyAvLyBqdW1wZWQgcGFzdCBmaXhlZCBzdGF0ZSB1cHdhcmQgZGlyZWN0aW9uDQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJLy8gc2V0IG5ldyB2YWx1ZXMNCgkJCQkJX3Bpbi5jc3MobmV3Q1NTKTsNCgkJCQkJaWYgKGNoYW5nZSkgew0KCQkJCQkJLy8gcmVtb3ZlIHBpbm5lZCBjbGFzcw0KCQkJCQkJX3Bpbi5yZW1vdmVDbGFzcyhfcGluT3B0aW9ucy5waW5uZWRDbGFzcyk7DQoJCQkJCQkvLyB1cGRhdGUgcGluIHNwYWNlciBpZiBzdGF0ZSBjaGFuZ2VkDQoJCQkJCQl1cGRhdGVQaW5TcGFjZXJTaXplKCk7DQoJCQkJCX0NCgkJCQl9DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSAqIFVwZGF0ZSB0aGUgcGluIHNwYWNlciBzaXplLg0KCQkgKiBUaGUgc2l6ZSBvZiB0aGUgc3BhY2VyIG5lZWRzIHRvIGJlIHVwZGF0ZWQgd2hlbmV2ZXIgdGhlIGR1cmF0aW9uIG9mIHRoZSBzY2VuZSBjaGFuZ2VzLCBpZiBpdCBpcyB0byBwdXNoIGRvd24gZm9sbG93aW5nIGVsZW1lbnRzLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIHVwZGF0ZVBpblNwYWNlclNpemUgPSBmdW5jdGlvbiAoKSB7DQoJCQlpZiAoX3BpbiAmJiBfcGFyZW50ICYmIF9waW5PcHRpb25zLmluRmxvdykgeyAvLyBubyBzcGFjZXJyZXNpemUsIGlmIG9yaWdpbmFsIHBvc2l0aW9uIGlzIGFic29sdXRlDQoJCQkJdmFyDQoJCQkJCWFmdGVyID0gKF9zdGF0ZSA9PT0gIkFGVEVSIiksDQoJCQkJCWJlZm9yZSA9IChfc3RhdGUgPT09ICJCRUZPUkUiKSwNCgkJCQkJZHVyaW5nID0gKF9zdGF0ZSA9PT0gIkRVUklORyIpLA0KCQkJCQlwaW5uZWQgPSAoX3Bpbi5jc3MoInBvc2l0aW9uIikgPT0gImZpeGVkIiksDQoJCQkJCXZlcnRpY2FsID0gX3BhcmVudC5pbmZvKCJ2ZXJ0aWNhbCIpLA0KCQkJCQkkc3BhY2VyY29udGVudCA9IF9waW5PcHRpb25zLnNwYWNlci5jaGlsZHJlbigpLmZpcnN0KCksIC8vIHVzdWFsbHkgdGhlIHBpbmVkIGVsZW1lbnQgYnV0IGNhbiBhbHNvIGJlIGFub3RoZXIgc3BhY2VyIChjYXNjYWRlZCBwaW5zKQ0KCQkJCQltYXJnaW5Db2xsYXBzZSA9IGlzTWFyZ2luQ29sbGFwc2VUeXBlKF9waW5PcHRpb25zLnNwYWNlci5jc3MoImRpc3BsYXkiKSksDQoJCQkJCWNzcyA9IHt9Ow0KDQoJCQkJaWYgKG1hcmdpbkNvbGxhcHNlKSB7DQoJCQkJCWNzc1sibWFyZ2luLXRvcCJdID0gYmVmb3JlIHx8IChkdXJpbmcgJiYgcGlubmVkKSA/IF9waW4uY3NzKCJtYXJnaW4tdG9wIikgOiAiYXV0byI7DQoJCQkJCWNzc1sibWFyZ2luLWJvdHRvbSJdID0gYWZ0ZXIgfHwgKGR1cmluZyAmJiBwaW5uZWQpID8gX3Bpbi5jc3MoIm1hcmdpbi1ib3R0b20iKSA6ICJhdXRvIjsNCgkJCQl9IGVsc2Ugew0KCQkJCQljc3NbIm1hcmdpbi10b3AiXSA9IGNzc1sibWFyZ2luLWJvdHRvbSJdID0gImF1dG8iOw0KCQkJCX0NCg0KCQkJCS8vIHNldCBuZXcgc2l6ZQ0KCQkJCS8vIGlmIHJlbHNpemU6IHNwYWNlciAtPiBwaW4gfCBlbHNlOiBwaW4gLT4gc3BhY2VyDQoJCQkJaWYgKF9waW5PcHRpb25zLnJlbFNpemUud2lkdGggfHwgX3Bpbk9wdGlvbnMucmVsU2l6ZS5hdXRvRnVsbFdpZHRoKSB7DQoJCQkJCWlmIChwaW5uZWQpIHsNCgkJCQkJCWlmICgkKHdpbmRvdykud2lkdGgoKSA9PSBfcGluT3B0aW9ucy5zcGFjZXIucGFyZW50KCkud2lkdGgoKSkgew0KCQkJCQkJCS8vIHJlbGF0aXZlIHRvIGJvZHkNCgkJCQkJCQlfcGluLmNzcygid2lkdGgiLCBfcGluT3B0aW9ucy5yZWxTaXplLmF1dG9GdWxsV2lkdGggPyAiMTAwJSIgOiAiaW5oZXJpdCIpOw0KCQkJCQkJfSBlbHNlIHsNCgkJCQkJCQkvLyBub3QgcmVsYXRpdmUgdG8gYm9keSAtPiBuZWVkIHRvIGNhbGN1bGF0ZQ0KCQkJCQkJCV9waW4uY3NzKCJ3aWR0aCIsIF9waW5PcHRpb25zLnNwYWNlci53aWR0aCgpKTsNCgkJCQkJCX0NCgkJCQkJfSBlbHNlIHsNCgkJCQkJCV9waW4uY3NzKCJ3aWR0aCIsICIxMDAlIik7DQoJCQkJCX0NCgkJCQl9IGVsc2Ugew0KCQkJCQkvLyBtaW53aWR0aCBpcyBuZWVkZWQgZm9yIGNhc2NhZGluZyBwaW5zLg0KCQkJCQkvLyBtYXJnaW4gaXMgb25seSBpbmNsdWRlZCBpZiBpdCdzIGEgY2FzY2FkZWQgcGluIHRvIHJlc29sdmUgYW4gSUU5IGJ1Zw0KCQkJCQljc3NbIm1pbi13aWR0aCJdID0gJHNwYWNlcmNvbnRlbnQub3V0ZXJXaWR0aCghJHNwYWNlcmNvbnRlbnQuaXMoX3BpbikpOw0KCQkJCQljc3Mud2lkdGggPSBwaW5uZWQgPyBjc3NbIm1pbi13aWR0aCJdIDogImF1dG8iOw0KCQkJCX0NCgkJCQlpZiAoX3Bpbk9wdGlvbnMucmVsU2l6ZS5oZWlnaHQpIHsNCgkJCQkJaWYgKHBpbm5lZCkgew0KCQkJCQkJaWYgKCQod2luZG93KS5oZWlnaHQoKSA9PSBfcGluT3B0aW9ucy5zcGFjZXIucGFyZW50KCkuaGVpZ2h0KCkpIHsNCgkJCQkJCQkvLyByZWxhdGl2ZSB0byBib2R5DQoJCQkJCQkJX3Bpbi5jc3MoImhlaWdodCIsICJpbmhlcml0Iik7DQoJCQkJCQl9IGVsc2Ugew0KCQkJCQkJCS8vIG5vdCByZWxhdGl2ZSB0byBib2R5IC0+IG5lZWQgdG8gY2FsY3VsYXRlDQoJCQkJCQkJX3Bpbi5jc3MoImhlaWdodCIsIF9waW5PcHRpb25zLnNwYWNlci5oZWlnaHQoKSk7DQoJCQkJCQl9DQoJCQkJCX0gZWxzZSB7DQoJCQkJCQlfcGluLmNzcygiaGVpZ2h0IiwgIjEwMCUiKTsNCgkJCQkJfQ0KCQkJCX0gZWxzZSB7DQoJCQkJCWNzc1sibWluLWhlaWdodCJdID0gJHNwYWNlcmNvbnRlbnQub3V0ZXJIZWlnaHQoIW1hcmdpbkNvbGxhcHNlKTsgLy8gbmVlZGVkIGZvciBjYXNjYWRpbmcgcGlucw0KCQkJCQljc3MuaGVpZ2h0ID0gcGlubmVkID8gY3NzWyJtaW4taGVpZ2h0Il0gOiAiYXV0byI7DQoJCQkJfQ0KDQoJCQkJLy8gYWRkIHNwYWNlIGZvciBkdXJhdGlvbiBpZiBwdXNoRm9sbG93ZXJzIGlzIHRydWUNCgkJCQlpZiAoX3Bpbk9wdGlvbnMucHVzaEZvbGxvd2Vycykgew0KCQkJCQljc3NbInBhZGRpbmciICsgKHZlcnRpY2FsID8gIlRvcCIgOiAiTGVmdCIpXSA9IF9vcHRpb25zLmR1cmF0aW9uICogX3Byb2dyZXNzOw0KCQkJCQljc3NbInBhZGRpbmciICsgKHZlcnRpY2FsID8gIkJvdHRvbSIgOiAiUmlnaHQiKV0gPSBfb3B0aW9ucy5kdXJhdGlvbiAqICgxIC0gX3Byb2dyZXNzKTsNCgkJCQl9DQoJCQkJX3Bpbk9wdGlvbnMuc3BhY2VyLmNzcyhjc3MpOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBVcGRhdGVzIHRoZSBQaW4gc3RhdGUgKGluIGNlcnRhaW4gc2NlbmFyaW9zKQ0KCQkgKiBJZiB0aGUgY29udHJvbGxlciBjb250YWluZXIgaXMgbm90IHRoZSBkb2N1bWVudCBhbmQgd2UgYXJlIG1pZC1waW4tcGhhc2Ugc2Nyb2xsaW5nIG9yIHJlc2l6aW5nIHRoZSBtYWluIGRvY3VtZW50IGNhbiByZXN1bHQgdG8gd3JvbmcgcGluIHBvc2l0aW9ucy4NCgkJICogU28gdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gcmVzaXplIGFuZCBzY3JvbGwgb2YgdGhlIGRvY3VtZW50Lg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIHVwZGF0ZVBpbkluQ29udGFpbmVyID0gZnVuY3Rpb24gKCkgew0KCQkJaWYgKF9wYXJlbnQgJiYgX3BpbiAmJiBfc3RhdGUgPT09ICJEVVJJTkciICYmICFfcGFyZW50LmluZm8oImlzRG9jdW1lbnQiKSkgew0KCQkJCXVwZGF0ZVBpblN0YXRlKCk7DQoJCQl9DQoJCX07DQoNCgkJLyoqDQoJCSAqIFVwZGF0ZXMgdGhlIFBpbiBzcGFjZXIgc2l6ZSBzdGF0ZSAoaW4gY2VydGFpbiBzY2VuYXJpb3MpDQoJCSAqIElmIGNvbnRhaW5lciBpcyByZXNpemVkIGR1cmluZyBwaW4gYW5kIHJlbGF0aXZlbHkgc2l6ZWQgdGhlIHNpemUgb2YgdGhlIHBpbiBtaWdodCBuZWVkIHRvIGJlIHVwZGF0ZWQuLi4NCgkJICogU28gdGhpcyBmdW5jdGlvbiBpcyBjYWxsZWQgb24gcmVzaXplIG9mIHRoZSBjb250YWluZXIuDQoJCSAqIEBwcml2YXRlDQoJCSAqLw0KCQl2YXIgdXBkYXRlUmVsYXRpdmVQaW5TcGFjZXIgPSBmdW5jdGlvbiAoKSB7DQoJCQlpZiAoIF9wYXJlbnQgJiYgX3BpbiAmJiAvLyB3ZWxsLCBkdWgNCgkJCQkJX3N0YXRlID09PSAiRFVSSU5HIiAmJiAvLyBlbGVtZW50IGluIHBpbm5lZCBzdGF0ZT8NCgkJCQkJKCAvLyBpcyB3aWR0aCBvciBoZWlnaHQgcmVsYXRpdmVseSBzaXplZCwgYnV0IG5vdCBpbiByZWxhdGlvbiB0byBib2R5PyB0aGVuIHdlIG5lZWQgdG8gcmVjYWxjLg0KCQkJCQkJKChfcGluT3B0aW9ucy5yZWxTaXplLndpZHRoIHx8IF9waW5PcHRpb25zLnJlbFNpemUuYXV0b0Z1bGxXaWR0aCkgJiYgJCh3aW5kb3cpLndpZHRoKCkgIT0gX3Bpbk9wdGlvbnMuc3BhY2VyLnBhcmVudCgpLndpZHRoKCkpIHx8DQoJCQkJCQkoX3Bpbk9wdGlvbnMucmVsU2l6ZS5oZWlnaHQgJiYgJCh3aW5kb3cpLmhlaWdodCgpICE9IF9waW5PcHRpb25zLnNwYWNlci5wYXJlbnQoKS5oZWlnaHQoKSkNCgkJCQkJKQ0KCQkJKSB7DQoJCQkJdXBkYXRlUGluU3BhY2VyU2l6ZSgpOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBJcyBjYWxsZWQsIHdoZW4gdGhlIG1vdXNld2hlbCBpcyB1c2VkIHdoaWxlIG92ZXIgYSBwaW5uZWQgZWxlbWVudCBpbnNpZGUgYSBkaXYgY29udGFpbmVyLg0KCQkgKiBJZiB0aGUgc2NlbmUgaXMgaW4gZml4ZWQgc3RhdGUgc2Nyb2xsIGV2ZW50cyB3b3VsZCBiZSBjb3VudGVkIHRvd2FyZHMgdGhlIGJvZHkuIFRoaXMgZm9yd2FyZHMgdGhlIGV2ZW50IHRvIHRoZSBzY3JvbGwgY29udGFpbmVyLg0KCQkgKiBAcHJpdmF0ZQ0KCQkgKi8NCgkJdmFyIG9uTW91c2V3aGVlbE92ZXJQaW4gPSBmdW5jdGlvbiAoZSkgew0KCQkJaWYgKF9wYXJlbnQgJiYgX3BpbiAmJiBfc3RhdGUgPT09ICJEVVJJTkciICYmICFfcGFyZW50LmluZm8oImlzRG9jdW1lbnQiKSkgeyAvLyBpbiBwaW4gc3RhdGUNCgkJCQllLnByZXZlbnREZWZhdWx0KCk7DQoJCQkJX3BhcmVudC5zY3JvbGxUbyhfcGFyZW50LmluZm8oInNjcm9sbFBvcyIpIC0gKGUub3JpZ2luYWxFdmVudC53aGVlbERlbHRhLzMgfHwgLWUub3JpZ2luYWxFdmVudC5kZXRhaWwqMzApKTsNCgkJCX0NCgkJfTsNCg0KDQoJCS8qDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICogcHVibGljIGZ1bmN0aW9ucyAoZ2V0dGVycy9zZXR0ZXJzKQ0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqLw0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIHRoZSBwYXJlbnQgY29udHJvbGxlci4NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyBnZXQgdGhlIHBhcmVudCBjb250cm9sbGVyIG9mIGEgc2NlbmUNCgkJICogdmFyIGNvbnRyb2xsZXIgPSBzY2VuZS5wYXJlbnQoKTsNCgkJICoNCgkJICogQHJldHVybnMge1Njcm9sbE1hZ2ljfSBQYXJlbnQgY29udHJvbGxlciBvciBgdW5kZWZpbmVkYA0KCQkgKi8NCgkJdGhpcy5wYXJlbnQgPSBmdW5jdGlvbiAoKSB7DQoJCQlyZXR1cm4gX3BhcmVudDsNCgkJfTsNCg0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIGR1cmF0aW9uIG9wdGlvbiB2YWx1ZS4NCgkJICogQXMgYSBzZXR0ZXIgaXQgYWxzbyBhY2NlcHRzIGEgZnVuY3Rpb24gcmV0dXJuaW5nIGEgbnVtZXJpYyB2YWx1ZS4gIA0KCQkgKiBUaGlzIGlzIHBhcnRpY3VsYXJseSB1c2VmdWwgZm9yIHJlc3BvbnNpdmUgc2V0dXBzLg0KCQkgKg0KCQkgKiBUaGUgZHVyYXRpb24gaXMgdXBkYXRlZCB1c2luZyB0aGUgc3VwcGxpZWQgZnVuY3Rpb24gZXZlcnkgdGltZSBgU2Nyb2xsU2NlbmUucmVmcmVzaCgpYCBpcyBjYWxsZWQsIHdoaWNoIGhhcHBlbnMgcGVyaW9kaWNhbGx5IGZyb20gdGhlIGNvbnRyb2xsZXIgKHNlZSBTY3JvbGxNYWdpYyBvcHRpb24gYHJlZnJlc2hJbnRlcnZhbGApLiAgDQoJCSAqIF8qKk5PVEU6KiogQmUgYXdhcmUgdGhhdCBpdCdzIGFuIGVhc3kgd2F5IHRvIGtpbGwgcGVyZm9ybWFuY2UsIGlmIHlvdSBzdXBwbHkgYSBmdW5jdGlvbiB0aGF0IGhhcyBoaWdoIENQVSBkZW1hbmQuICANCgkJICogRXZlbiBmb3Igc2l6ZSBhbmQgcG9zaXRpb24gY2FsY3VsYXRpb25zIGl0IGlzIHJlY29tbWVuZGVkIHRvIHVzZSBhIHZhcmlhYmxlIHRvIGNhY2hlIHRoZSB2YWx1ZS4gKHNlZSBleGFtcGxlKSAgDQoJCSAqIFRoaXMgY291bnRzIGRvdWJsZSBpZiB5b3UgdXNlIHRoZSBzYW1lIGZ1bmN0aW9uIGZvciBtdWx0aXBsZSBzY2VuZXMuXw0KCQkgKg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCBkdXJhdGlvbiB2YWx1ZQ0KCQkgKiB2YXIgZHVyYXRpb24gPSBzY2VuZS5kdXJhdGlvbigpOw0KCQkgKg0KCSAJICogLy8gc2V0IGEgbmV3IGR1cmF0aW9uDQoJCSAqIHNjZW5lLmR1cmF0aW9uKDMwMCk7DQoJCSAqDQoJCSAqIC8vIHVzZSBhIGZ1bmN0aW9uIHRvIGF1dG9tYXRpY2FsbHkgYWRqdXN0IHRoZSBkdXJhdGlvbiB0byB0aGUgd2luZG93IGhlaWdodC4NCgkJICogdmFyIGR1cmF0aW9uVmFsdWVDYWNoZTsNCgkJICogZnVuY3Rpb24gZ2V0RHVyYXRpb24gKCkgew0KCQkgKiAgIHJldHVybiBkdXJhdGlvblZhbHVlQ2FjaGU7DQoJCSAqIH0NCgkJICogZnVuY3Rpb24gdXBkYXRlRHVyYXRpb24gKGUpIHsNCgkJICogICBkdXJhdGlvblZhbHVlQ2FjaGUgPSAkKHdpbmRvdykuaW5uZXJIZWlnaHQoKTsNCgkJICogfQ0KCQkgKiAkKHdpbmRvdykub24oInJlc2l6ZSIsIHVwZGF0ZUR1cmF0aW9uKTsgLy8gdXBkYXRlIHRoZSBkdXJhdGlvbiB3aGVuIHRoZSB3aW5kb3cgc2l6ZSBjaGFuZ2VzDQoJCSAqICQod2luZG93KS50cmlnZ2VySGFuZGxlcigicmVzaXplIik7IC8vIHNldCB0byBpbml0aWFsIHZhbHVlDQoJCSAqIHNjZW5lLmR1cmF0aW9uKGdldER1cmF0aW9uKTsgLy8gc3VwcGx5IGR1cmF0aW9uIG1ldGhvZA0KCQkgKg0KCQkgKiBAZmlyZXMge0BsaW5rIFNjcm9sbFNjZW5lLmNoYW5nZX0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5zaGlmdH0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQHBhcmFtIHsobnVtYmVyfGZ1bmN0aW9uKX0gW25ld0R1cmF0aW9uXSAtIFRoZSBuZXcgZHVyYXRpb24gb2YgdGhlIHNjZW5lLg0KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBgZ2V0YCAtICBDdXJyZW50IHNjZW5lIGR1cmF0aW9uLg0KCQkgKiBAcmV0dXJucyB7U2Nyb2xsU2NlbmV9IGBzZXRgIC0gIFBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJdGhpcy5kdXJhdGlvbiA9IGZ1bmN0aW9uIChuZXdEdXJhdGlvbikgew0KCQkJdmFyIHZhcm5hbWUgPSAiZHVyYXRpb24iOw0KCQkJaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7IC8vIGdldA0KCQkJCXJldHVybiBfb3B0aW9uc1t2YXJuYW1lXTsNCgkJCX0gZWxzZSB7DQoJCQkJaWYgKCEkLmlzRnVuY3Rpb24obmV3RHVyYXRpb24pKSB7DQoJCQkJCV9kdXJhdGlvblVwZGF0ZU1ldGhvZCA9IHVuZGVmaW5lZDsNCgkJCQl9DQoJCQkJaWYgKGNoYW5nZU9wdGlvbih2YXJuYW1lLCBuZXdEdXJhdGlvbikpIHsgLy8gc2V0DQoJCQkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoImNoYW5nZSIsIHt3aGF0OiB2YXJuYW1lLCBuZXd2YWw6IF9vcHRpb25zW3Zhcm5hbWVdfSk7DQoJCQkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoInNoaWZ0Iiwge3JlYXNvbjogdmFybmFtZX0pOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCg0KCQkvKioNCgkJICogKipHZXQqKiBvciAqKlNldCoqIHRoZSBvZmZzZXQgb3B0aW9uIHZhbHVlLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCBvZmZzZXQNCgkJICogdmFyIG9mZnNldCA9IHNjZW5lLm9mZnNldCgpOw0KCQkgKg0KCSAJICogLy8gc2V0IGEgbmV3IG9mZnNldA0KCQkgKiBzY2VuZS5vZmZzZXQoMTAwKTsNCgkJICoNCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5jaGFuZ2V9LCB3aGVuIHVzZWQgYXMgc2V0dGVyDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUuc2hpZnR9LCB3aGVuIHVzZWQgYXMgc2V0dGVyDQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbbmV3T2Zmc2V0XSAtIFRoZSBuZXcgb2Zmc2V0IG9mIHRoZSBzY2VuZS4NCgkJICogQHJldHVybnMge251bWJlcn0gYGdldGAgLSAgQ3VycmVudCBzY2VuZSBvZmZzZXQuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gYHNldGAgLSAgUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLm9mZnNldCA9IGZ1bmN0aW9uIChuZXdPZmZzZXQpIHsNCgkJCXZhciB2YXJuYW1lID0gIm9mZnNldCI7DQoJCQlpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsgLy8gZ2V0DQoJCQkJcmV0dXJuIF9vcHRpb25zW3Zhcm5hbWVdOw0KCQkJfSBlbHNlIGlmIChjaGFuZ2VPcHRpb24odmFybmFtZSwgbmV3T2Zmc2V0KSkgeyAvLyBzZXQNCgkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJjaGFuZ2UiLCB7d2hhdDogdmFybmFtZSwgbmV3dmFsOiBfb3B0aW9uc1t2YXJuYW1lXX0pOw0KCQkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoInNoaWZ0Iiwge3JlYXNvbjogdmFybmFtZX0pOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIHRyaWdnZXJFbGVtZW50IG9wdGlvbiB2YWx1ZS4NCgkJICogRG9lcyAqKm5vdCoqIGZpcmUgYFNjcm9sbFNjZW5lLnNoaWZ0YCwgYmVjYXVzZSBjaGFuZ2luZyB0aGUgdHJpZ2dlciBFbGVtZW50IGRvZXNuJ3QgbmVjZXNzYXJpbHkgbWVhbiB0aGUgc3RhcnQgcG9zaXRpb24gY2hhbmdlcy4gVGhpcyB3aWxsIGJlIGRldGVybWluZWQgaW4gYFNjcm9sbFNjZW5lLnJlZnJlc2goKWAsIHdoaWNoIGlzIGF1dG9tYXRpY2FsbHkgdHJpZ2dlcmVkLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCB0cmlnZ2VyRWxlbWVudA0KCQkgKiB2YXIgdHJpZ2dlckVsZW1lbnQgPSBzY2VuZS50cmlnZ2VyRWxlbWVudCgpOw0KCQkgKg0KCSAJICogLy8gc2V0IGEgbmV3IHRyaWdnZXJFbGVtZW50IHVzaW5nIGEgc2VsZWN0b3INCgkJICogc2NlbmUudHJpZ2dlckVsZW1lbnQoIiN0cmlnZ2VyIik7DQoJIAkgKiAvLyBzZXQgYSBuZXcgdHJpZ2dlckVsZW1lbnQgdXNpbmcgYSBqUXVlcnkgT2JqZWN0DQoJCSAqIHNjZW5lLnRyaWdnZXJFbGVtZW50KCQoIiN0cmlnZ2VyIikpOw0KCSAJICogLy8gc2V0IGEgbmV3IHRyaWdnZXJFbGVtZW50IHVzaW5nIGEgRE9NIG9iamVjdA0KCQkgKiBzY2VuZS50cmlnZ2VyRWxlbWVudChkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgidHJpZ2dlciIpKTsNCgkJICoNCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5jaGFuZ2V9LCB3aGVuIHVzZWQgYXMgc2V0dGVyDQoJCSAqIEBwYXJhbSB7KHN0cmluZ3xvYmplY3QpfSBbbmV3VHJpZ2dlckVsZW1lbnRdIC0gVGhlIG5ldyB0cmlnZ2VyIGVsZW1lbnQgZm9yIHRoZSBzY2VuZS4NCgkJICogQHJldHVybnMgeyhzdHJpbmd8b2JqZWN0KX0gYGdldGAgLSAgQ3VycmVudCB0cmlnZ2VyRWxlbWVudC4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBgc2V0YCAtICBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMudHJpZ2dlckVsZW1lbnQgPSBmdW5jdGlvbiAobmV3VHJpZ2dlckVsZW1lbnQpIHsNCgkJCXZhciB2YXJuYW1lID0gInRyaWdnZXJFbGVtZW50IjsNCgkJCWlmICghYXJndW1lbnRzLmxlbmd0aCkgeyAvLyBnZXQNCgkJCQlyZXR1cm4gX29wdGlvbnNbdmFybmFtZV07DQoJCQl9IGVsc2UgaWYgKGNoYW5nZU9wdGlvbih2YXJuYW1lLCBuZXdUcmlnZ2VyRWxlbWVudCkpIHsgLy8gc2V0DQoJCQkJU2Nyb2xsU2NlbmUudHJpZ2dlcigiY2hhbmdlIiwge3doYXQ6IHZhcm5hbWUsIG5ld3ZhbDogX29wdGlvbnNbdmFybmFtZV19KTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCg0KCQkvKioNCgkJICogKipHZXQqKiBvciAqKlNldCoqIHRoZSB0cmlnZ2VySG9vayBvcHRpb24gdmFsdWUuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gZ2V0IHRoZSBjdXJyZW50IHRyaWdnZXJIb29rIHZhbHVlDQoJCSAqIHZhciB0cmlnZ2VySG9vayA9IHNjZW5lLnRyaWdnZXJIb29rKCk7DQoJCSAqDQoJIAkgKiAvLyBzZXQgYSBuZXcgdHJpZ2dlckhvb2sgdXNpbmcgYSBzdHJpbmcNCgkJICogc2NlbmUudHJpZ2dlckhvb2soIm9uTGVhdmUiKTsNCgkgCSAqIC8vIHNldCBhIG5ldyB0cmlnZ2VySG9vayB1c2luZyBhIG51bWJlcg0KCQkgKiBzY2VuZS50cmlnZ2VySG9vaygwLjcpOw0KCQkgKg0KCQkgKiBAZmlyZXMge0BsaW5rIFNjcm9sbFNjZW5lLmNoYW5nZX0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5zaGlmdH0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQHBhcmFtIHsobnVtYmVyfHN0cmluZyl9IFtuZXdUcmlnZ2VySG9va10gLSBUaGUgbmV3IHRyaWdnZXJIb29rIG9mIHRoZSBzY2VuZS4gU2VlIHtAbGluayBTY3JvbGxTY2VuZX0gcGFyYW1ldGVyIGRlc2NyaXB0aW9uIGZvciB2YWx1ZSBvcHRpb25zLg0KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBgZ2V0YCAtICBDdXJyZW50IHRyaWdnZXJIb29rIChBTFdBWVMgbnVtZXJpY2FsKS4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBgc2V0YCAtICBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMudHJpZ2dlckhvb2sgPSBmdW5jdGlvbiAobmV3VHJpZ2dlckhvb2spIHsNCgkJCXZhciB2YXJuYW1lID0gInRyaWdnZXJIb29rIjsNCgkJCWlmICghYXJndW1lbnRzLmxlbmd0aCkgeyAvLyBnZXQNCgkJCQlyZXR1cm4gJC5pc051bWVyaWMoX29wdGlvbnNbdmFybmFtZV0pID8gX29wdGlvbnNbdmFybmFtZV0gOiBUUklHR0VSX0hPT0tfVkFMVUVTW19vcHRpb25zW3Zhcm5hbWVdXTsNCgkJCX0gZWxzZSBpZiAoY2hhbmdlT3B0aW9uKHZhcm5hbWUsIG5ld1RyaWdnZXJIb29rKSkgeyAvLyBzZXQNCgkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJjaGFuZ2UiLCB7d2hhdDogdmFybmFtZSwgbmV3dmFsOiBfb3B0aW9uc1t2YXJuYW1lXX0pOw0KCQkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoInNoaWZ0Iiwge3JlYXNvbjogdmFybmFtZX0pOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIHJldmVyc2Ugb3B0aW9uIHZhbHVlLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCByZXZlcnNlIG9wdGlvbg0KCQkgKiB2YXIgcmV2ZXJzZSA9IHNjZW5lLnJldmVyc2UoKTsNCgkJICoNCgkgCSAqIC8vIHNldCBuZXcgcmV2ZXJzZSBvcHRpb24NCgkJICogc2NlbmUucmV2ZXJzZShmYWxzZSk7DQoJCSAqDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUuY2hhbmdlfSwgd2hlbiB1c2VkIGFzIHNldHRlcg0KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtuZXdSZXZlcnNlXSAtIFRoZSBuZXcgcmV2ZXJzZSBzZXR0aW5nIG9mIHRoZSBzY2VuZS4NCgkJICogQHJldHVybnMge2Jvb2xlYW59IGBnZXRgIC0gIEN1cnJlbnQgcmV2ZXJzZSBvcHRpb24gdmFsdWUuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gYHNldGAgLSAgUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnJldmVyc2UgPSBmdW5jdGlvbiAobmV3UmV2ZXJzZSkgew0KCQkJdmFyIHZhcm5hbWUgPSAicmV2ZXJzZSI7DQoJCQlpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsgLy8gZ2V0DQoJCQkJcmV0dXJuIF9vcHRpb25zW3Zhcm5hbWVdOw0KCQkJfSBlbHNlIGlmIChjaGFuZ2VPcHRpb24odmFybmFtZSwgbmV3UmV2ZXJzZSkpIHsgLy8gc2V0DQoJCQkJU2Nyb2xsU2NlbmUudHJpZ2dlcigiY2hhbmdlIiwge3doYXQ6IHZhcm5hbWUsIG5ld3ZhbDogX29wdGlvbnNbdmFybmFtZV19KTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCg0KCQkvKioNCgkJICogKipHZXQqKiBvciAqKlNldCoqIHRoZSB0d2VlbkNoYW5nZXMgb3B0aW9uIHZhbHVlLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCB0d2VlbkNoYW5nZXMgb3B0aW9uDQoJCSAqIHZhciB0d2VlbkNoYW5nZXMgPSBzY2VuZS50d2VlbkNoYW5nZXMoKTsNCgkJICoNCgkgCSAqIC8vIHNldCBuZXcgdHdlZW5DaGFuZ2VzIG9wdGlvbg0KCQkgKiBzY2VuZS50d2VlbkNoYW5nZXModHJ1ZSk7DQoJCSAqDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUuY2hhbmdlfSwgd2hlbiB1c2VkIGFzIHNldHRlcg0KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtuZXdUd2VlbkNoYW5nZXNdIC0gVGhlIG5ldyB0d2VlbkNoYW5nZXMgc2V0dGluZyBvZiB0aGUgc2NlbmUuDQoJCSAqIEByZXR1cm5zIHtib29sZWFufSBgZ2V0YCAtICBDdXJyZW50IHR3ZWVuQ2hhbmdlcyBvcHRpb24gdmFsdWUuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gYHNldGAgLSAgUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnR3ZWVuQ2hhbmdlcyA9IGZ1bmN0aW9uIChuZXdUd2VlbkNoYW5nZXMpIHsNCgkJCXZhciB2YXJuYW1lID0gInR3ZWVuQ2hhbmdlcyI7DQoJCQlpZiAoIWFyZ3VtZW50cy5sZW5ndGgpIHsgLy8gZ2V0DQoJCQkJcmV0dXJuIF9vcHRpb25zW3Zhcm5hbWVdOw0KCQkJfSBlbHNlIGlmIChjaGFuZ2VPcHRpb24odmFybmFtZSwgbmV3VHdlZW5DaGFuZ2VzKSkgeyAvLyBzZXQNCgkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJjaGFuZ2UiLCB7d2hhdDogdmFybmFtZSwgbmV3dmFsOiBfb3B0aW9uc1t2YXJuYW1lXX0pOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIGxvZ2xldmVsIG9wdGlvbiB2YWx1ZS4NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyBnZXQgdGhlIGN1cnJlbnQgbG9nbGV2ZWwNCgkJICogdmFyIGxvZ2xldmVsID0gc2NlbmUubG9nbGV2ZWwoKTsNCgkJICoNCgkgCSAqIC8vIHNldCBuZXcgbG9nbGV2ZWwNCgkJICogc2NlbmUubG9nbGV2ZWwoMyk7DQoJCSAqDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUuY2hhbmdlfSwgd2hlbiB1c2VkIGFzIHNldHRlcg0KCQkgKiBAcGFyYW0ge251bWJlcn0gW25ld0xvZ2xldmVsXSAtIFRoZSBuZXcgbG9nbGV2ZWwgc2V0dGluZyBvZiB0aGUgc2NlbmUuIGBbMC0zXWANCgkJICogQHJldHVybnMge251bWJlcn0gYGdldGAgLSAgQ3VycmVudCBsb2dsZXZlbC4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBgc2V0YCAtICBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMubG9nbGV2ZWwgPSBmdW5jdGlvbiAobmV3TG9nbGV2ZWwpIHsNCgkJCXZhciB2YXJuYW1lID0gImxvZ2xldmVsIjsNCgkJCWlmICghYXJndW1lbnRzLmxlbmd0aCkgeyAvLyBnZXQNCgkJCQlyZXR1cm4gX29wdGlvbnNbdmFybmFtZV07DQoJCQl9IGVsc2UgaWYgKGNoYW5nZU9wdGlvbih2YXJuYW1lLCBuZXdMb2dsZXZlbCkpIHsgLy8gc2V0DQoJCQkJU2Nyb2xsU2NlbmUudHJpZ2dlcigiY2hhbmdlIiwge3doYXQ6IHZhcm5hbWUsIG5ld3ZhbDogX29wdGlvbnNbdmFybmFtZV19KTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCgkJDQoJCS8qKg0KCQkgKiAqKkdldCoqIHRoZSBjdXJyZW50IHN0YXRlLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGdldCB0aGUgY3VycmVudCBzdGF0ZQ0KCQkgKiB2YXIgc3RhdGUgPSBzY2VuZS5zdGF0ZSgpOw0KCQkgKg0KCQkgKiBAcmV0dXJucyB7c3RyaW5nfSBgIkJFRk9SRSJgLCBgIkRVUklORyJgIG9yIGAiQUZURVIiYA0KCQkgKi8NCgkJdGhpcy5zdGF0ZSA9IGZ1bmN0aW9uICgpIHsNCgkJCXJldHVybiBfc3RhdGU7DQoJCX07DQoNCgkJLyoqDQoJCSAqICoqR2V0KiogdGhlIHRyaWdnZXIgcG9zaXRpb24gb2YgdGhlIHNjZW5lIChpbmNsdWRpbmcgdGhlIHZhbHVlIG9mIHRoZSBgb2Zmc2V0YCBvcHRpb24pLiAgDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gZ2V0IHRoZSBzY2VuZSdzIHRyaWdnZXIgcG9zaXRpb24NCgkJICogdmFyIHRyaWdnZXJQb3NpdGlvbiA9IHNjZW5lLnRyaWdnZXJQb3NpdGlvbigpOw0KCQkgKg0KCQkgKiBAcmV0dXJucyB7bnVtYmVyfSBTdGFydCBwb3NpdGlvbiBvZiB0aGUgc2NlbmUuIFRvcCBwb3NpdGlvbiB2YWx1ZSBmb3IgdmVydGljYWwgYW5kIGxlZnQgcG9zaXRpb24gdmFsdWUgZm9yIGhvcml6b250YWwgc2Nyb2xscy4NCgkJICovDQoJCXRoaXMudHJpZ2dlclBvc2l0aW9uID0gZnVuY3Rpb24gKCkgew0KCQkJdmFyIHBvcyA9IF9vcHRpb25zLm9mZnNldDsgLy8gdGhlIG9mZnNldCBpcyB0aGUgYmFzaXMNCgkJCWlmIChfcGFyZW50KSB7DQoJCQkJLy8gZ2V0IHRoZSB0cmlnZ2VyIHBvc2l0aW9uDQoJCQkJaWYgKF9vcHRpb25zLnRyaWdnZXJFbGVtZW50KSB7DQoJCQkJCS8vIEVsZW1lbnQgYXMgdHJpZ2dlcg0KCQkJCQlwb3MgKz0gX3RyaWdnZXJQb3M7DQoJCQkJfSBlbHNlIHsNCgkJCQkJLy8gcmV0dXJuIHRoZSBoZWlnaHQgb2YgdGhlIHRyaWdnZXJIb29rIHRvIHN0YXJ0IGF0IHRoZSBiZWdpbm5pbmcNCgkJCQkJcG9zICs9IF9wYXJlbnQuaW5mbygic2l6ZSIpICogU2Nyb2xsU2NlbmUudHJpZ2dlckhvb2soKTsNCgkJCQl9DQoJCQl9DQoJCQlyZXR1cm4gcG9zOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIHRoZSB0cmlnZ2VyIG9mZnNldCBvZiB0aGUgc2NlbmUgKGluY2x1ZGluZyB0aGUgdmFsdWUgb2YgdGhlIGBvZmZzZXRgIG9wdGlvbikuICANCgkJICogQHB1YmxpYw0KCQkgKiBAZGVwcmVjYXRlZCBNZXRob2QgaXMgZGVwcmVjYXRlZCBzaW5jZSAxLjEuMC4gWW91IHNob3VsZCBub3cgdXNlIHtAbGluayBTY3JvbGxTY2VuZS50cmlnZ2VyUG9zaXRpb259DQoJCSAqLw0KCQl0aGlzLnRyaWdnZXJPZmZzZXQgPSBmdW5jdGlvbiAoKSB7DQoJCQlyZXR1cm4gU2Nyb2xsU2NlbmUudHJpZ2dlclBvc2l0aW9uKCk7DQoJCX07DQoNCgkJLyoqDQoJCSAqICoqR2V0KiogdGhlIGN1cnJlbnQgc2Nyb2xsIG9mZnNldCBmb3IgdGhlIHN0YXJ0IG9mIHRoZSBzY2VuZS4gIA0KCQkgKiBNaW5kLCB0aGF0IHRoZSBzY3JvbGxPZmZzZXQgaXMgcmVsYXRlZCB0byB0aGUgc2l6ZSBvZiB0aGUgY29udGFpbmVyLCBpZiBgdHJpZ2dlckhvb2tgIGlzIGJpZ2dlciB0aGFuIGAwYCAob3IgYCJvbkxlYXZlImApLiAgDQoJCSAqIFRoaXMgbWVhbnMsIHRoYXQgcmVzaXppbmcgdGhlIGNvbnRhaW5lciBvciBjaGFuZ2luZyB0aGUgYHRyaWdnZXJIb29rYCB3aWxsIGluZmx1ZW5jZSB0aGUgc2NlbmUncyBzdGFydCBvZmZzZXQuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gZ2V0IHRoZSBjdXJyZW50IHNjcm9sbCBvZmZzZXQgZm9yIHRoZSBzdGFydCBhbmQgZW5kIG9mIHRoZSBzY2VuZS4NCgkJICogdmFyIHN0YXJ0ID0gc2NlbmUuc2Nyb2xsT2Zmc2V0KCk7DQoJCSAqIHZhciBlbmQgPSBzY2VuZS5zY3JvbGxPZmZzZXQoKSArIHNjZW5lLmR1cmF0aW9uKCk7DQoJCSAqIGNvbnNvbGUubG9nKCJ0aGUgc2NlbmUgc3RhcnRzIGF0Iiwgc3RhcnQsICJhbmQgZW5kcyBhdCIsIGVuZCk7DQoJCSAqDQoJCSAqIEByZXR1cm5zIHtudW1iZXJ9IFRoZSBzY3JvbGwgb2Zmc2V0IChvZiB0aGUgY29udGFpbmVyKSBhdCB3aGljaCB0aGUgc2NlbmUgd2lsbCB0cmlnZ2VyLiBZIHZhbHVlIGZvciB2ZXJ0aWNhbCBhbmQgWCB2YWx1ZSBmb3IgaG9yaXpvbnRhbCBzY3JvbGxzLg0KCQkgKi8NCgkJdGhpcy5zY3JvbGxPZmZzZXQgPSBmdW5jdGlvbiAoKSB7DQoJCQlyZXR1cm4gX3Njcm9sbE9mZnNldC5zdGFydDsNCgkJfTsNCg0KCQkvKg0KCQkgKiAtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoJCSAqIHB1YmxpYyBmdW5jdGlvbnMgKHNjZW5lIG1vZGlmaWNhdGlvbikNCgkJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCQkgKi8NCg0KCQkvKioNCgkJICogVXBkYXRlcyB0aGUgU2NlbmUgaW4gdGhlIHBhcmVudCBDb250cm9sbGVyIHRvIHJlZmxlY3QgdGhlIGN1cnJlbnQgc3RhdGUuICANCgkJICogVGhpcyBpcyB0aGUgZXF1aXZhbGVudCB0byBgU2Nyb2xsTWFnaWMudXBkYXRlU2NlbmUoc2NlbmUsIGltbWVkaWF0ZWx5KWAuICANCgkJICogVGhlIHVwZGF0ZSBtZXRob2QgY2FsY3VsYXRlcyB0aGUgc2NlbmUncyBzdGFydCBhbmQgZW5kIHBvc2l0aW9uIChiYXNlZCBvbiB0aGUgdHJpZ2dlciBlbGVtZW50LCB0cmlnZ2VyIGhvb2ssIGR1cmF0aW9uIGFuZCBvZmZzZXQpIGFuZCBjaGVja3MgaXQgYWdhaW5zdCB0aGUgY3VycmVudCBzY3JvbGwgcG9zaXRpb24gb2YgdGhlIGNvbnRhaW5lci4gIA0KCQkgKiBJdCB0aGVuIHVwZGF0ZXMgdGhlIGN1cnJlbnQgc2NlbmUgc3RhdGUgYWNjb3JkaW5nbHkgKG9yIGRvZXMgbm90aGluZywgaWYgdGhlIHN0YXRlIGlzIGFscmVhZHkgY29ycmVjdCkg4oCTIFBpbnMgd2lsbCBiZSBzZXQgdG8gdGhlaXIgY29ycmVjdCBwb3NpdGlvbiBhbmQgdHdlZW5zIHdpbGwgYmUgdXBkYXRlZCB0byB0aGVpciBjb3JyZWN0IHByb2dyZXNzLg0KCQkgKiBUaGlzIG1lYW5zIGFuIHVwZGF0ZSBkb2Vzbid0IG5lY2Vzc2FyaWx5IHJlc3VsdCBpbiBhIHByb2dyZXNzIGNoYW5nZS4gVGhlIGBwcm9ncmVzc2AgZXZlbnQgd2lsbCBiZSBmaXJlZCBpZiB0aGUgcHJvZ3Jlc3MgaGFzIGluZGVlZCBjaGFuZ2VkIGJldHdlZW4gdGhpcyB1cGRhdGUgYW5kIHRoZSBsYXN0LiAgDQoJCSAqIF8qKk5PVEU6KiogVGhpcyBtZXRob2QgZ2V0cyBjYWxsZWQgY29uc3RhbnRseSB3aGVuZXZlciBTY3JvbGxNYWdpYyBkZXRlY3RzIGEgY2hhbmdlLiBUaGUgb25seSBhcHBsaWNhdGlvbiBmb3IgeW91IGlzIGlmIHlvdSBjaGFuZ2Ugc29tZXRoaW5nIG91dHNpZGUgb2YgdGhlIHJlYWxtIG9mIFNjcm9sbE1hZ2ljLCBsaWtlIG1vdmluZyB0aGUgdHJpZ2dlciBvciBjaGFuZ2luZyB0d2VlbiBwYXJhbWV0ZXJzLl8NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyB1cGRhdGUgdGhlIHNjZW5lIG9uIG5leHQgdGljaw0KCQkgKiBzY2VuZS51cGRhdGUoKTsNCgkJICoNCgkJICogLy8gdXBkYXRlIHRoZSBzY2VuZSBpbW1lZGlhdGVseQ0KCQkgKiBzY2VuZS51cGRhdGUodHJ1ZSk7DQoJCSAqDQoJCSAqIEBmaXJlcyBTY3JvbGxTY2VuZS51cGRhdGUNCgkJICoNCgkJICogQHBhcmFtIHtib29sZWFufSBbaW1tZWRpYXRlbHk9ZmFsc2VdIC0gSWYgYHRydWVgIHRoZSB1cGRhdGUgd2lsbCBiZSBpbnN0YW50LCBpZiBgZmFsc2VgIGl0IHdpbGwgd2FpdCB1bnRpbCBuZXh0IHVwZGF0ZSBjeWNsZSAoYmV0dGVyIHBlcmZvcm1hbmNlKS4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMudXBkYXRlID0gZnVuY3Rpb24gKGltbWVkaWF0ZWx5KSB7DQoJCQlpZiAoX3BhcmVudCkgew0KCQkJCWlmIChpbW1lZGlhdGVseSkgew0KCQkJCQlpZiAoX3BhcmVudC5lbmFibGVkKCkgJiYgX2VuYWJsZWQpIHsNCgkJCQkJCXZhcg0KCQkJCQkJCXNjcm9sbFBvcyA9IF9wYXJlbnQuaW5mbygic2Nyb2xsUG9zIiksDQoJCQkJCQkJbmV3UHJvZ3Jlc3M7DQoNCgkJCQkJCWlmIChfb3B0aW9ucy5kdXJhdGlvbiA+IDApIHsNCgkJCQkJCQluZXdQcm9ncmVzcyA9IChzY3JvbGxQb3MgLSBfc2Nyb2xsT2Zmc2V0LnN0YXJ0KS8oX3Njcm9sbE9mZnNldC5lbmQgLSBfc2Nyb2xsT2Zmc2V0LnN0YXJ0KTsNCgkJCQkJCX0gZWxzZSB7DQoJCQkJCQkJbmV3UHJvZ3Jlc3MgPSBzY3JvbGxQb3MgPj0gX3Njcm9sbE9mZnNldC5zdGFydCA/IDEgOiAwOw0KCQkJCQkJfQ0KDQoJCQkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJ1cGRhdGUiLCB7c3RhcnRQb3M6IF9zY3JvbGxPZmZzZXQuc3RhcnQsIGVuZFBvczogX3Njcm9sbE9mZnNldC5lbmQsIHNjcm9sbFBvczogc2Nyb2xsUG9zfSk7DQoNCgkJCQkJCVNjcm9sbFNjZW5lLnByb2dyZXNzKG5ld1Byb2dyZXNzKTsNCgkJCQkJfSBlbHNlIGlmIChfcGluICYmIF9zdGF0ZSA9PT0gIkRVUklORyIpIHsNCgkJCQkJCXVwZGF0ZVBpblN0YXRlKHRydWUpOyAvLyB1bnBpbiBpbiBwb3NpdGlvbg0KCQkJCQl9DQoJCQkJfSBlbHNlIHsNCgkJCQkJX3BhcmVudC51cGRhdGVTY2VuZShTY3JvbGxTY2VuZSwgZmFsc2UpOw0KCQkJCX0NCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCg0KCQkvKioNCgkJICogVXBkYXRlcyBkeW5hbWljIHNjZW5lIHZhcmlhYmxlcyBsaWtlIHRoZSB0cmlnZ2VyIGVsZW1lbnQgcG9zaXRpb24gb3IgdGhlIGR1cmF0aW9uLg0KCQkgKiBUaGlzIG1ldGhvZCBpcyBhdXRvbWF0aWNhbGx5IGNhbGxlZCBpbiByZWd1bGFyIGludGVydmFscyBmcm9tIHRoZSBjb250cm9sbGVyLiBTZWUge0BsaW5rIFNjcm9sbE1hZ2ljfSBvcHRpb24gYHJlZnJlc2hJbnRlcnZhbGAuDQoJCSAqIA0KCQkgKiBZb3UgY2FuIGNhbGwgaXQgdG8gbWluaW1pemUgbGFnLCBmb3IgZXhhbXBsZSB3aGVuIHlvdSBpbnRlbnRpb25hbGx5IGNoYW5nZSB0aGUgcG9zaXRpb24gb2YgdGhlIHRyaWdnZXJFbGVtZW50Lg0KCQkgKiBJZiB5b3UgZG9uJ3QgaXQgd2lsbCBzaW1wbHkgYmUgdXBkYXRlZCBpbiB0aGUgbmV4dCByZWZyZXNoIGludGVydmFsIG9mIHRoZSBjb250YWluZXIsIHdoaWNoIGlzIHVzdWFsbHkgc3VmZmljaWVudC4NCgkJICoNCgkJICogQHB1YmxpYw0KCQkgKiBAc2luY2UgMS4xLjANCgkJICogQGV4YW1wbGUNCgkJICogc2NlbmUgPSBuZXcgU2Nyb2xsU2NlbmUoe3RyaWdnZXJFbGVtZW50OiAiI3RyaWdnZXIifSk7DQoJCSAqIA0KCQkgKiAvLyBjaGFuZ2UgdGhlIHBvc2l0aW9uIG9mIHRoZSB0cmlnZ2VyDQoJCSAqICQoIiN0cmlnZ2VyIikuY3NzKCJ0b3AiLCA1MDApOw0KCQkgKiAvLyBpbW1lZGlhdGVseSBsZXQgdGhlIHNjZW5lIGtub3cgb2YgdGhpcyBjaGFuZ2UNCgkJICogc2NlbmUucmVmcmVzaCgpOw0KCQkgKg0KCQkgKiBAZmlyZXMge0BsaW5rIFNjcm9sbFNjZW5lLnNoaWZ0fSwgaWYgdGhlIHRyaWdnZXIgZWxlbWVudCBwb3NpdGlvbiBvciB0aGUgZHVyYXRpb24gY2hhbmdlZA0KCQkgKiBAZmlyZXMge0BsaW5rIFNjcm9sbFNjZW5lLmNoYW5nZX0sIGlmIHRoZSBkdXJhdGlvbiBjaGFuZ2VkDQoJCSAqDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnJlZnJlc2ggPSBmdW5jdGlvbiAoKSB7DQoJCQl1cGRhdGVEdXJhdGlvbigpOw0KCQkJdXBkYXRlVHJpZ2dlckVsZW1lbnRQb3NpdGlvbigpOw0KCQkJLy8gdXBkYXRlIHRyaWdnZXIgZWxlbWVudCBwb3NpdGlvbg0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiAqKkdldCoqIG9yICoqU2V0KiogdGhlIHNjZW5lJ3MgcHJvZ3Jlc3MuICANCgkJICogVXN1YWxseSBpdCBzaG91bGRuJ3QgYmUgbmVjZXNzYXJ5IHRvIHVzZSB0aGlzIGFzIGEgc2V0dGVyLCBhcyBpdCBpcyBzZXQgYXV0b21hdGljYWxseSBieSBzY2VuZS51cGRhdGUoKS4gIA0KCQkgKiBUaGUgb3JkZXIgaW4gd2hpY2ggdGhlIGV2ZW50cyBhcmUgZmlyZWQgZGVwZW5kcyBvbiB0aGUgZHVyYXRpb24gb2YgdGhlIHNjZW5lOg0KCQkgKiAgMS4gU2NlbmVzIHdpdGggYGR1cmF0aW9uID09IDBgOiAgDQoJCSAqICBTY2VuZXMgdGhhdCBoYXZlIG5vIGR1cmF0aW9uIGJ5IGRlZmluaXRpb24gaGF2ZSBubyBlbmRpbmcuIFRodXMgdGhlIGBlbmRgIGV2ZW50IHdpbGwgbmV2ZXIgYmUgZmlyZWQuICANCgkJICogIFdoZW4gdGhlIHRyaWdnZXIgcG9zaXRpb24gb2YgdGhlIHNjZW5lIGlzIHBhc3NlZCB0aGUgZXZlbnRzIGFyZSBhbHdheXMgZmlyZWQgaW4gdGhpcyBvcmRlcjogIA0KCQkgKiAgYGVudGVyYCwgYHN0YXJ0YCwgYHByb2dyZXNzYCB3aGVuIHNjcm9sbGluZyBmb3J3YXJkICANCgkJICogIGFuZCAgDQoJCSAqICBgcHJvZ3Jlc3NgLCBgc3RhcnRgLCBgbGVhdmVgIHdoZW4gc2Nyb2xsaW5nIGluIHJldmVyc2UNCgkJICogIDIuIFNjZW5lcyB3aXRoIGBkdXJhdGlvbiA+IDBgOiAgDQoJCSAqICBTY2VuZXMgd2l0aCBhIHNldCBkdXJhdGlvbiBoYXZlIGEgZGVmaW5lZCBzdGFydCBhbmQgZW5kIHBvaW50LiAgDQoJCSAqICBXaGVuIHNjcm9sbGluZyBwYXN0IHRoZSBzdGFydCBwb3NpdGlvbiBvZiB0aGUgc2NlbmUgaXQgd2lsbCBmaXJlIHRoZXNlIGV2ZW50cyBpbiB0aGlzIG9yZGVyOiAgDQoJCSAqICBgZW50ZXJgLCBgc3RhcnRgLCBgcHJvZ3Jlc3NgICANCgkJICogIFdoZW4gY29udGludWluZyB0byBzY3JvbGwgYW5kIHBhc3NpbmcgdGhlIGVuZCBwb2ludCBpdCB3aWxsIGZpcmUgdGhlc2UgZXZlbnRzOiAgDQoJCSAqICBgcHJvZ3Jlc3NgLCBgZW5kYCwgYGxlYXZlYCAgDQoJCSAqICBXaGVuIHJldmVyc2luZyB0aHJvdWdoIHRoZSBlbmQgcG9pbnQgdGhlc2UgZXZlbnRzIGFyZSBmaXJlZDogIA0KCQkgKiAgYGVudGVyYCwgYGVuZGAsIGBwcm9ncmVzc2AgIA0KCQkgKiAgQW5kIHdoZW4gY29udGludWluZyB0byBzY3JvbGwgcGFzdCB0aGUgc3RhcnQgcG9zaXRpb24gaW4gcmV2ZXJzZSBpdCB3aWxsIGZpcmU6ICANCgkJICogIGBwcm9ncmVzc2AsIGBzdGFydGAsIGBsZWF2ZWAgIA0KCQkgKiAgSW4gYmV0d2VlbiBzdGFydCBhbmQgZW5kIHRoZSBgcHJvZ3Jlc3NgIGV2ZW50IHdpbGwgYmUgY2FsbGVkIGNvbnN0YW50bHksIHdoZW5ldmVyIHRoZSBwcm9ncmVzcyBjaGFuZ2VzLg0KCQkgKiANCgkJICogSW4gc2hvcnQ6ICANCgkJICogYGVudGVyYCBldmVudHMgd2lsbCBhbHdheXMgdHJpZ2dlciAqKmJlZm9yZSoqIHRoZSBwcm9ncmVzcyB1cGRhdGUgYW5kIGBsZWF2ZWAgZW52ZW50cyB3aWxsIHRyaWdnZXIgKiphZnRlcioqIHRoZSBwcm9ncmVzcyB1cGRhdGUuICANCgkJICogYHN0YXJ0YCBhbmQgYGVuZGAgd2lsbCBhbHdheXMgdHJpZ2dlciBhdCB0aGVpciByZXNwZWN0aXZlIHBvc2l0aW9uLg0KCQkgKiANCgkJICogUGxlYXNlIHJldmlldyB0aGUgZXZlbnQgZGVzY3JpcHRpb25zIGZvciBkZXRhaWxzIG9uIHRoZSBldmVudHMgYW5kIHRoZSBldmVudCBvYmplY3QgdGhhdCBpcyBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLg0KCQkgKiANCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyBnZXQgdGhlIGN1cnJlbnQgc2NlbmUgcHJvZ3Jlc3MNCgkJICogdmFyIHByb2dyZXNzID0gc2NlbmUucHJvZ3Jlc3MoKTsNCgkJICoNCgkgCSAqIC8vIHNldCBuZXcgc2NlbmUgcHJvZ3Jlc3MNCgkJICogc2NlbmUucHJvZ3Jlc3MoMC4zKTsNCgkJICoNCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5lbnRlcn0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5zdGFydH0sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5wcm9ncmVzc30sIHdoZW4gdXNlZCBhcyBzZXR0ZXINCgkJICogQGZpcmVzIHtAbGluayBTY3JvbGxTY2VuZS5lbmR9LCB3aGVuIHVzZWQgYXMgc2V0dGVyDQoJCSAqIEBmaXJlcyB7QGxpbmsgU2Nyb2xsU2NlbmUubGVhdmV9LCB3aGVuIHVzZWQgYXMgc2V0dGVyDQoJCSAqDQoJCSAqIEBwYXJhbSB7bnVtYmVyfSBbcHJvZ3Jlc3NdIC0gVGhlIG5ldyBwcm9ncmVzcyB2YWx1ZSBvZiB0aGUgc2NlbmUgYFswLTFdYC4NCgkJICogQHJldHVybnMge251bWJlcn0gYGdldGAgLSAgQ3VycmVudCBzY2VuZSBwcm9ncmVzcy4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBgc2V0YCAtICBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMucHJvZ3Jlc3MgPSBmdW5jdGlvbiAocHJvZ3Jlc3MpIHsNCgkJCWlmICghYXJndW1lbnRzLmxlbmd0aCkgeyAvLyBnZXQNCgkJCQlyZXR1cm4gX3Byb2dyZXNzOw0KCQkJfSBlbHNlIHsgLy8gc2V0DQoJCQkJdmFyDQoJCQkJCWRvVXBkYXRlID0gZmFsc2UsDQoJCQkJCW9sZFN0YXRlID0gX3N0YXRlLA0KCQkJCQlzY3JvbGxEaXJlY3Rpb24gPSBfcGFyZW50ID8gX3BhcmVudC5pbmZvKCJzY3JvbGxEaXJlY3Rpb24iKSA6ICdQQVVTRUQnLA0KCQkJCQlyZXZlcnNlT3JGb3J3YXJkID0gX29wdGlvbnMucmV2ZXJzZSB8fCBwcm9ncmVzcyA+PSBfcHJvZ3Jlc3M7DQoJCQkJaWYgKF9vcHRpb25zLmR1cmF0aW9uID09PSAwKSB7DQoJCQkJCS8vIHplcm8gZHVyYXRpb24gc2NlbmVzDQoJCQkJCWRvVXBkYXRlID0gX3Byb2dyZXNzICE9IHByb2dyZXNzOw0KCQkJCQlfcHJvZ3Jlc3MgPSBwcm9ncmVzcyA8IDEgJiYgcmV2ZXJzZU9yRm9yd2FyZCA/IDAgOiAxOw0KCQkJCQlfc3RhdGUgPSBfcHJvZ3Jlc3MgPT09IDAgPyAnQkVGT1JFJyA6ICdEVVJJTkcnOw0KCQkJCX0gZWxzZSB7DQoJCQkJCS8vIHNjZW5lcyB3aXRoIHN0YXJ0IGFuZCBlbmQNCgkJCQkJaWYgKHByb2dyZXNzIDw9IDAgJiYgX3N0YXRlICE9PSAnQkVGT1JFJyAmJiByZXZlcnNlT3JGb3J3YXJkKSB7DQoJCQkJCQkvLyBnbyBiYWNrIHRvIGluaXRpYWwgc3RhdGUNCgkJCQkJCV9wcm9ncmVzcyA9IDA7DQoJCQkJCQlfc3RhdGUgPSAnQkVGT1JFJzsNCgkJCQkJCWRvVXBkYXRlID0gdHJ1ZTsNCgkJCQkJfSBlbHNlIGlmIChwcm9ncmVzcyA+IDAgJiYgcHJvZ3Jlc3MgPCAxICYmIHJldmVyc2VPckZvcndhcmQpIHsNCgkJCQkJCV9wcm9ncmVzcyA9IHByb2dyZXNzOw0KCQkJCQkJX3N0YXRlID0gJ0RVUklORyc7DQoJCQkJCQlkb1VwZGF0ZSA9IHRydWU7DQoJCQkJCX0gZWxzZSBpZiAocHJvZ3Jlc3MgPj0gMSAmJiBfc3RhdGUgIT09ICdBRlRFUicpIHsNCgkJCQkJCV9wcm9ncmVzcyA9IDE7DQoJCQkJCQlfc3RhdGUgPSAnQUZURVInOw0KCQkJCQkJZG9VcGRhdGUgPSB0cnVlOw0KCQkJCQl9IGVsc2UgaWYgKF9zdGF0ZSA9PT0gJ0RVUklORycgJiYgIXJldmVyc2VPckZvcndhcmQpIHsNCgkJCQkJCXVwZGF0ZVBpblN0YXRlKCk7IC8vIGluIGNhc2Ugd2Ugc2Nyb2xsZWQgYmFja3dhcmRzIG1pZC1zY2VuZSBhbmQgcmV2ZXJzZSBpcyBkaXNhYmxlZCA9PiB1cGRhdGUgdGhlIHBpbiBwb3NpdGlvbiwgc28gaXQgZG9lc24ndCBtb3ZlIGJhY2sgYXMgd2VsbC4NCgkJCQkJfQ0KCQkJCX0NCgkJCQlpZiAoZG9VcGRhdGUpIHsNCgkJCQkJLy8gZmlyZSBldmVudHMNCgkJCQkJdmFyDQoJCQkJCQlldmVudFZhcnMgPSB7cHJvZ3Jlc3M6IF9wcm9ncmVzcywgc3RhdGU6IF9zdGF0ZSwgc2Nyb2xsRGlyZWN0aW9uOiBzY3JvbGxEaXJlY3Rpb259LA0KCQkJCQkJc3RhdGVDaGFuZ2VkID0gX3N0YXRlICE9IG9sZFN0YXRlOw0KDQoJCQkJCXZhciB0cmlnZ2VyID0gZnVuY3Rpb24gKGV2ZW50TmFtZSkgeyAvLyB0bXAgaGVscGVyIHRvIHNpbXBsaWZ5IGNvZGUNCgkJCQkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoZXZlbnROYW1lLCBldmVudFZhcnMpOw0KCQkJCQl9Ow0KDQoJCQkJCWlmIChzdGF0ZUNoYW5nZWQpIHsgLy8gZW50ZXIgZXZlbnRzDQoJCQkJCQlpZiAob2xkU3RhdGUgIT09ICdEVVJJTkcnKSB7DQoJCQkJCQkJdHJpZ2dlcigiZW50ZXIiKTsNCgkJCQkJCQl0cmlnZ2VyKG9sZFN0YXRlID09PSAnQkVGT1JFJyA/ICJzdGFydCIgOiAiZW5kIik7DQoJCQkJCQl9DQoJCQkJCX0NCgkJCQkJdHJpZ2dlcigicHJvZ3Jlc3MiKTsNCgkJCQkJaWYgKHN0YXRlQ2hhbmdlZCkgeyAvLyBsZWF2ZSBldmVudHMNCgkJCQkJCWlmIChfc3RhdGUgIT09ICdEVVJJTkcnKSB7DQoJCQkJCQkJdHJpZ2dlcihfc3RhdGUgPT09ICdCRUZPUkUnID8gInN0YXJ0IiA6ICJlbmQiKTsNCgkJCQkJCQl0cmlnZ2VyKCJsZWF2ZSIpOw0KCQkJCQkJfQ0KCQkJCQl9DQoJCQkJfQ0KDQoJCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQkJfQ0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBBZGQgYSB0d2VlbiB0byB0aGUgc2NlbmUuICANCgkJICogSWYgeW91IHdhbnQgdG8gYWRkIG11bHRpcGxlIHR3ZWVucywgd3JhcCB0aGVtIGludG8gb25lIFRpbWVsaW5lTWF4IG9iamVjdCBhbmQgYWRkIGl0LiAgDQoJCSAqIFRoZSBkdXJhdGlvbiBvZiB0aGUgdHdlZW4gaXMgc3RyZWNoZWQgdG8gdGhlIHNjcm9sbCBkdXJhdGlvbiBvZiB0aGUgc2NlbmUsIHVubGVzcyB0aGUgc2NlbmUgaGFzIGEgZHVyYXRpb24gb2YgYDBgLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGFkZCBhIHNpbmdsZSB0d2Vlbg0KCQkgKiBzY2VuZS5zZXRUd2VlbihUd2Vlbk1heC50bygib2JqIiksIDEsIHt4OiAxMDB9KTsNCgkJICoNCgkJICogLy8gYWRkIG11bHRpcGxlIHR3ZWVucywgd3JhcHBlZCBpbiBhIHRpbWVsaW5lLg0KCQkgKiB2YXIgdGltZWxpbmUgPSBuZXcgVGltZWxpbmVNYXgoKTsNCgkJICogdmFyIHR3ZWVuMSA9IFR3ZWVuTWF4LmZyb20oIm9iajEiLCAxLCB7eDogMTAwfSk7DQoJCSAqIHZhciB0d2VlbjIgPSBUd2Vlbk1heC50bygib2JqMiIsIDEsIHt5OiAxMDB9KTsNCgkJICogdGltZWxpbmUNCgkJICoJCS5hZGQodHdlZW4xKQ0KCQkgKgkJLmFkZCh0d2VlbjIpOw0KCQkgKiBzY2VuZS5hZGRUd2Vlbih0aW1lbGluZSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7b2JqZWN0fSBUd2Vlbk9iamVjdCAtIEEgVHdlZW5NYXgsIFR3ZWVuTGl0ZSwgVGltZWxpbmVNYXggb3IgVGltZWxpbmVMaXRlIG9iamVjdCB0aGF0IHNob3VsZCBiZSBhbmltYXRlZCBpbiB0aGUgc2NlbmUuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnNldFR3ZWVuID0gZnVuY3Rpb24gKFR3ZWVuT2JqZWN0KSB7DQoJCQlpZiAoIVRpbWVsaW5lTWF4KSB7DQoJCQkJbG9nKDEsICJFUlJPUjogVGltZWxpbmVNYXggd2Fzbid0IGZvdW5kLiBQbGVhc2UgbWFrZSBzdXJlIEdTQVAgaXMgbG9hZGVkIGJlZm9yZSBTY3JvbGxNYWdpYyBvciB1c2UgYXN5bmNocm9ub3VzIGxvYWRpbmcuIik7DQoJCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQkJfQ0KCQkJaWYgKF90d2VlbikgeyAvLyBraWxsIG9sZCB0d2Vlbj8NCgkJCQlTY3JvbGxTY2VuZS5yZW1vdmVUd2VlbigpOw0KCQkJfQ0KCQkJdHJ5IHsNCgkJCQkvLyB3cmFwIFR3ZWVuIGludG8gYSBUaW1lbGluZU1heCBPYmplY3QgdG8gaW5jbHVkZSBkZWxheSBhbmQgcmVwZWF0cyBpbiB0aGUgZHVyYXRpb24gYW5kIHN0YW5kYXJkaXplIG1ldGhvZHMuDQoJCQkJX3R3ZWVuID0gbmV3IFRpbWVsaW5lTWF4KHtzbW9vdGhDaGlsZFRpbWluZzogdHJ1ZX0pDQoJCQkJCS5hZGQoVHdlZW5PYmplY3QpDQoJCQkJCS5wYXVzZSgpOw0KCQkJfSBjYXRjaCAoZSkgew0KCQkJCWxvZygxLCAiRVJST1IgY2FsbGluZyBtZXRob2QgJ3NldFR3ZWVuKCknOiBTdXBwbGllZCBhcmd1bWVudCBpcyBub3QgYSB2YWxpZCBUd2Vlbk9iamVjdCIpOw0KCQkJfSBmaW5hbGx5IHsNCgkJCQkvLyBzb21lIHByb3BlcnRpZXMgbmVlZCB0byBiZSB0cmFuc2ZlcnJlZCBpdCB0byB0aGUgd3JhcHBlciwgb3RoZXJ3aXNlIHRoZXkgd291bGQgZ2V0IGxvc3QuDQoJCQkJaWYgKFR3ZWVuT2JqZWN0LnJlcGVhdCAmJiBUd2Vlbk9iamVjdC5yZXBlYXQoKSA9PT0gLTEpIHsvLyBUd2Vlbk1heCBvciBUaW1lbGluZU1heCBPYmplY3Q/DQoJCQkJCV90d2Vlbi5yZXBlYXQoLTEpOw0KCQkJCQlfdHdlZW4ueW95byhUd2Vlbk9iamVjdC55b3lvKCkpOw0KCQkJCX0NCgkJCX0NCgkJCS8vIFNvbWUgdHdlZW4gdmFsaWRhdGlvbnMgYW5kIGRlYnVnZ2luZyBoZWxwZXJzDQoNCgkJCS8vIGNoZWNrIGlmIHRoZXJlIGFyZSBwb3NpdGlvbiB0d2VlbnMgZGVmaW5lZCBmb3IgdGhlIHRyaWdnZXIgYW5kIHdhcm4gYWJvdXQgaXQgOikNCgkJCWlmIChfdHdlZW4gJiYgX3BhcmVudCAgJiYgX29wdGlvbnMudHJpZ2dlckVsZW1lbnQgJiYgX29wdGlvbnMubG9nbGV2ZWwgPj0gMikgey8vIHBhcmVudCBpcyBuZWVkZWQgdG8ga25vdyBzY3JvbGwgZGlyZWN0aW9uLg0KCQkJCXZhcg0KCQkJCQl0cmlnZ2VyVHdlZW5zID0gX3R3ZWVuLmdldFR3ZWVuc09mKCQoX29wdGlvbnMudHJpZ2dlckVsZW1lbnQpKSwNCgkJCQkJdmVydGljYWwgPSBfcGFyZW50LmluZm8oInZlcnRpY2FsIik7DQoJCQkJJC5lYWNoKHRyaWdnZXJUd2VlbnMsIGZ1bmN0aW9uIChpbmRleCwgdmFsdWUpIHsNCgkJCQkJdmFyDQoJCQkJCQl0d2VlbnZhcnMgPSB2YWx1ZS52YXJzLmNzcyB8fCB2YWx1ZS52YXJzLA0KCQkJCQkJY29uZGl0aW9uID0gdmVydGljYWwgPyAodHdlZW52YXJzLnRvcCAhPT0gdW5kZWZpbmVkIHx8IHR3ZWVudmFycy5ib3R0b20gIT09IHVuZGVmaW5lZCkgOiAodHdlZW52YXJzLmxlZnQgIT09IHVuZGVmaW5lZCB8fCB0d2VlbnZhcnMucmlnaHQgIT09IHVuZGVmaW5lZCk7DQoJCQkJCWlmIChjb25kaXRpb24pIHsNCgkJCQkJCWxvZygyLCAiV0FSTklORzogVHdlZW5pbmcgdGhlIHBvc2l0aW9uIG9mIHRoZSB0cmlnZ2VyIGVsZW1lbnQgYWZmZWN0cyB0aGUgc2NlbmUgdGltaW5nIGFuZCBzaG91bGQgYmUgYXZvaWRlZCEiKTsNCgkJCQkJCXJldHVybiBmYWxzZTsNCgkJCQkJfQ0KCQkJCX0pOw0KCQkJfQ0KDQoJCQkvLyB3YXJuIGFib3V0IHR3ZWVuIG92ZXJ3cml0ZXMsIHdoZW4gYW4gZWxlbWVudCBpcyB0d2VlbmVkIG11bHRpcGxlIHRpbWVzDQoJCQlpZiAocGFyc2VGbG9hdChUd2VlbkxpdGUudmVyc2lvbikgPj0gMS4xNCkgeyAvLyBvbk92ZXJ3cml0ZSBvbmx5IHByZXNlbnQgc2luY2UgR1NBUCB2MS4xNC4wDQoJCQkJdmFyDQoJCQkJCWxpc3QgPSBfdHdlZW4uZ2V0Q2hpbGRyZW4odHJ1ZSwgdHJ1ZSwgZmFsc2UpLCAvLyBnZXQgYWxsIG5lc3RlZCB0d2VlbiBvYmplY3RzDQoJCQkJCW5ld0NhbGxiYWNrID0gZnVuY3Rpb24gKCkgew0KCQkJCQkJbG9nKDIsICJXQVJOSU5HOiB0d2VlbiB3YXMgb3ZlcndyaXR0ZW4gYnkgYW5vdGhlci4gVG8gbGVhcm4gaG93IHRvIGF2b2lkIHRoaXMgaXNzdWUgc2VlIGhlcmU6IGh0dHBzOi8vZ2l0aHViLmNvbS9qYW5wYWVwa2UvU2Nyb2xsTWFnaWMvd2lraS9XQVJOSU5HOi10d2Vlbi13YXMtb3ZlcndyaXR0ZW4tYnktYW5vdGhlciIpOw0KCQkJCQl9Ow0KCQkJCWZvciAodmFyIGk9MCwgdGhpc1R3ZWVuLCBvbGRDYWxsYmFjazsgaTxsaXN0Lmxlbmd0aDsgaSsrKSB7DQoJCQkJCS8qanNoaW50IGxvb3BmdW5jOiB0cnVlICovDQoJCQkJCXRoaXNUd2VlbiA9IGxpc3RbaV07DQoJCQkJCWlmIChvbGRDYWxsYmFjayAhPT0gbmV3Q2FsbGJhY2spIHsgLy8gaWYgdHdlZW5zIGlzIGFkZGVkIG1vcmUgdGhhbiBvbmNlDQoJCQkJCQlvbGRDYWxsYmFjayA9IHRoaXNUd2Vlbi52YXJzLm9uT3ZlcndyaXRlOw0KCQkJCQkJdGhpc1R3ZWVuLnZhcnMub25PdmVyd3JpdGUgPSBmdW5jdGlvbiAoKSB7DQoJCQkJCQkJaWYgKG9sZENhbGxiYWNrKSB7DQoJCQkJCQkJCW9sZENhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQkJCQkJfQ0KCQkJCQkJCW5ld0NhbGxiYWNrLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7DQoJCQkJCQl9Ow0KCQkJCQl9DQoJCQkJfQ0KCQkJfQ0KCQkJbG9nKDMsICJhZGRlZCB0d2VlbiIpOw0KCQkJdXBkYXRlVHdlZW5Qcm9ncmVzcygpOw0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBSZW1vdmUgdGhlIHR3ZWVuIGZyb20gdGhlIHNjZW5lLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIHJlbW92ZSB0aGUgdHdlZW4gZnJvbSB0aGUgc2NlbmUgd2l0aG91dCByZXNldHRpbmcgaXQNCgkJICogc2NlbmUucmVtb3ZlVHdlZW4oKTsNCgkJICoNCgkJICogLy8gcmVtb3ZlIHRoZSB0d2VlbiBmcm9tIHRoZSBzY2VuZSBhbmQgcmVzZXQgaXQgdG8gaW5pdGlhbCBwb3NpdGlvbg0KCQkgKiBzY2VuZS5yZW1vdmVUd2Vlbih0cnVlKTsNCgkJICoNCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVzZXQ9ZmFsc2VdIC0gSWYgYHRydWVgIHRoZSB0d2VlbiB3aWxsIGJlIHJlc2V0IHRvIGl0cyBpbml0aWFsIHZhbHVlcy4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMucmVtb3ZlVHdlZW4gPSBmdW5jdGlvbiAocmVzZXQpIHsNCgkJCWlmIChfdHdlZW4pIHsNCgkJCQlpZiAocmVzZXQpIHsNCgkJCQkJdXBkYXRlVHdlZW5Qcm9ncmVzcygwKTsNCgkJCQl9DQoJCQkJX3R3ZWVuLmtpbGwoKTsNCgkJCQlfdHdlZW4gPSB1bmRlZmluZWQ7DQoJCQkJbG9nKDMsICJyZW1vdmVkIHR3ZWVuIChyZXNldDogIiArIChyZXNldCA/ICJ0cnVlIiA6ICJmYWxzZSIpICsgIikiKTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCg0KCQkvKioNCgkJICogUGluIGFuIGVsZW1lbnQgZm9yIHRoZSBkdXJhdGlvbiBvZiB0aGUgdHdlZW4uICANCgkJICogSWYgdGhlIHNjZW5lIGR1cmF0aW9uIGlzIDAgdGhlIGVsZW1lbnQgd2lsbCBvbmx5IGJlIHVucGlubmVkLCBpZiB0aGUgdXNlciBzY3JvbGxzIGJhY2sgcGFzdCB0aGUgc3RhcnQgcG9zaXRpb24uICANCgkJICogXyoqTk9URToqKiBUaGUgb3B0aW9uIGBwdXNoRm9sbG93ZXJzYCBoYXMgbm8gZWZmZWN0LCB3aGVuIHRoZSBzY2VuZSBkdXJhdGlvbiBpcyAwLl8NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyBwaW4gZWxlbWVudCBhbmQgcHVzaCBhbGwgZm9sbG93aW5nIGVsZW1lbnRzIGRvd24gYnkgdGhlIGFtb3VudCBvZiB0aGUgcGluIGR1cmF0aW9uLg0KCQkgKiBzY2VuZS5zZXRQaW4oIiNwaW4iKTsNCgkJICoNCgkJICogLy8gcGluIGVsZW1lbnQgYW5kIGtlZXBpbmcgYWxsIGZvbGxvd2luZyBlbGVtZW50cyBpbiB0aGVpciBwbGFjZS4gVGhlIHBpbm5lZCBlbGVtZW50IHdpbGwgbW92ZSBwYXN0IHRoZW0uDQoJCSAqIHNjZW5lLnNldFBpbigiI3BpbiIsIHtwdXNoRm9sbG93ZXJzOiBmYWxzZX0pOw0KCQkgKg0KCQkgKiBAcGFyYW0geyhzdHJpbmd8b2JqZWN0KX0gZWxlbWVudCAtIEEgU2VsZWN0b3IgdGFyZ2V0aW5nIGFuIGVsZW1lbnQsIGEgRE9NIG9iamVjdCBvciBhIGpRdWVyeSBvYmplY3QgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBwaW5uZWQuDQoJCSAqIEBwYXJhbSB7b2JqZWN0fSBbc2V0dGluZ3NdIC0gc2V0dGluZ3MgZm9yIHRoZSBwaW4NCgkJICogQHBhcmFtIHtib29sZWFufSBbc2V0dGluZ3MucHVzaEZvbGxvd2Vycz10cnVlXSAtIElmIGB0cnVlYCBmb2xsb3dpbmcgZWxlbWVudHMgd2lsbCBiZSAicHVzaGVkIiBkb3duIGZvciB0aGUgZHVyYXRpb24gb2YgdGhlIHBpbiwgaWYgYGZhbHNlYCB0aGUgcGlubmVkIGVsZW1lbnQgd2lsbCBqdXN0IHNjcm9sbCBwYXN0IHRoZW0uICANCgkJIAkJCQkJCQkJCQkJCSAgIElnbm9yZWQsIHdoZW4gZHVyYXRpb24gaXMgYDBgLg0KCQkgKiBAcGFyYW0ge3N0cmluZ30gW3NldHRpbmdzLnNwYWNlckNsYXNzPSJzY3JvbGxtYWdpYy1waW4tc3BhY2VyIl0gLSBDbGFzc25hbWUgb2YgdGhlIHBpbiBzcGFjZXIgZWxlbWVudCwgd2hpY2ggaXMgdXNlZCB0byByZXBsYWNlIHRoZSBlbGVtZW50LiAgDQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBbc2V0dGluZ3MucGlubmVkQ2xhc3M9IiJdIC0gQ2xhc3NuYW1lIHRoYXQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBwaW5uZWQgZWxlbWVudCBkdXJpbmcgcGluIHBoYXNlIChhbmQgcmVtb3ZlZCBhZnRlcikuDQoJCSAqDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnNldFBpbiA9IGZ1bmN0aW9uIChlbGVtZW50LCBzZXR0aW5ncykgew0KCQkJdmFyDQoJCQkJZGVmYXVsdFNldHRpbmdzID0gew0KCQkJCQlwdXNoRm9sbG93ZXJzOiB0cnVlLA0KCQkJCQlzcGFjZXJDbGFzczogInNjcm9sbG1hZ2ljLXBpbi1zcGFjZXIiLA0KCQkJCQlwaW5uZWRDbGFzczogIiINCgkJCQl9Ow0KCQkJc2V0dGluZ3MgPSAkLmV4dGVuZCh7fSwgZGVmYXVsdFNldHRpbmdzLCBzZXR0aW5ncyk7DQoNCgkJCS8vIHZhbGlkYXRlIEVsZW1lbnQNCgkJCWVsZW1lbnQgPSAkKGVsZW1lbnQpLmZpcnN0KCk7DQoJCQlpZiAoZWxlbWVudC5sZW5ndGggPT09IDApIHsNCgkJCQlsb2coMSwgIkVSUk9SIGNhbGxpbmcgbWV0aG9kICdzZXRQaW4oKSc6IEludmFsaWQgcGluIGVsZW1lbnQgc3VwcGxpZWQuIik7DQoJCQkJcmV0dXJuIFNjcm9sbFNjZW5lOyAvLyBjYW5jZWwNCgkJCX0gZWxzZSBpZiAoZWxlbWVudC5jc3MoInBvc2l0aW9uIikgPT0gImZpeGVkIikgew0KCQkJCWxvZygxLCAiRVJST1IgY2FsbGluZyBtZXRob2QgJ3NldFBpbigpJzogUGluIGRvZXMgbm90IHdvcmsgd2l0aCBlbGVtZW50cyB0aGF0IGFyZSBwb3NpdGlvbmVkICdmaXhlZCcuIik7DQoJCQkJcmV0dXJuIFNjcm9sbFNjZW5lOyAvLyBjYW5jZWwNCgkJCX0NCg0KCQkJaWYgKF9waW4pIHsgLy8gcHJlZXhpc3RpbmcgcGluPw0KCQkJCWlmIChfcGluID09PSBlbGVtZW50KSB7DQoJCQkJCS8vIHNhbWUgcGluIHdlIGFscmVhZHkgaGF2ZSAtPiBkbyBub3RoaW5nDQoJCQkJCXJldHVybiBTY3JvbGxTY2VuZTsgLy8gY2FuY2VsDQoJCQkJfSBlbHNlIHsNCgkJCQkJLy8ga2lsbCBvbGQgcGluDQoJCQkJCVNjcm9sbFNjZW5lLnJlbW92ZVBpbigpOw0KCQkJCX0NCgkJCQkNCgkJCX0NCgkJCV9waW4gPSBlbGVtZW50Ow0KCQkJDQoJCQlfcGluLnBhcmVudCgpLmhpZGUoKTsgLy8gaGFjayBzdGFydCB0byBmb3JjZSBqUXVlcnkgY3NzIHRvIHJldHVybiBzdHlsZXNoZWV0IHZhbHVlcyBpbnN0ZWFkIG9mIGNhbGN1bGF0ZWQgcHggdmFsdWVzLg0KCQkJdmFyDQoJCQkJaW5GbG93ID0gX3Bpbi5jc3MoInBvc2l0aW9uIikgIT0gImFic29sdXRlIiwNCgkJCQlwaW5DU1MgPSBfcGluLmNzcyhbImRpc3BsYXkiLCAidG9wIiwgImxlZnQiLCAiYm90dG9tIiwgInJpZ2h0Il0pLA0KCQkJCXNpemVDU1MgPSBfcGluLmNzcyhbIndpZHRoIiwgImhlaWdodCJdKTsNCgkJCV9waW4ucGFyZW50KCkuc2hvdygpOyAvLyBoYWNrIGVuZC4NCg0KCQkJaWYgKHNpemVDU1Mud2lkdGggPT09ICIwcHgiICYmICBpbkZsb3cgJiYgaXNNYXJnaW5Db2xsYXBzZVR5cGUocGluQ1NTLmRpc3BsYXkpKSB7DQoJCQkJLy8gbG9nICgyLCAiV0FSTklORzogWW91ciBwaW5uZWQgZWxlbWVudCBwcm9iYWJseSBuZWVkcyBhIGRlZmluZWQgd2lkdGggb3IgaXQgbWlnaHQgY29sbGFwc2UgZHVyaW5nIHBpbi4iKTsNCgkJCX0NCgkJCWlmICghaW5GbG93ICYmIHNldHRpbmdzLnB1c2hGb2xsb3dlcnMpIHsNCgkJCQlsb2coMiwgIldBUk5JTkc6IElmIHRoZSBwaW5uZWQgZWxlbWVudCBpcyBwb3NpdGlvbmVkIGFic29sdXRlbHkgcHVzaEZvbGxvd2VycyBpcyBkaXNhYmxlZC4iKTsNCgkJCQlzZXR0aW5ncy5wdXNoRm9sbG93ZXJzID0gZmFsc2U7DQoJCQl9DQoNCgkJCS8vIGNyZWF0ZSBzcGFjZXINCgkJCXZhciBzcGFjZXIgPSAkKCI8ZGl2PjwvZGl2PiIpDQoJCQkJCS5hZGRDbGFzcyhzZXR0aW5ncy5zcGFjZXJDbGFzcykNCgkJCQkJLmNzcyhwaW5DU1MpDQoJCQkJCS5kYXRhKCJTY3JvbGxNYWdpY1BpblNwYWNlciIsIHRydWUpDQoJCQkJCS5jc3Moew0KCQkJCQkJcG9zaXRpb246IGluRmxvdyA/ICJyZWxhdGl2ZSIgOiAiYWJzb2x1dGUiLA0KCQkJCQkJIm1hcmdpbi1sZWZ0IjogImF1dG8iLA0KCQkJCQkJIm1hcmdpbi1yaWdodCI6ICJhdXRvIiwNCgkJCQkJCSJib3gtc2l6aW5nIjogImNvbnRlbnQtYm94Ig0KCQkJCQl9KTsNCg0KCQkJLy8gc2V0IHRoZSBwaW4gT3B0aW9ucw0KCQkJdmFyIHBpbklubGluZUNTUyA9IF9waW5bMF0uc3R5bGU7DQoJCQlfcGluT3B0aW9ucyA9IHsNCgkJCQlzcGFjZXI6IHNwYWNlciwNCgkJCQlyZWxTaXplOiB7IC8vIHNhdmUgaWYgc2l6ZSBpcyBkZWZpbmVkIHVzaW5nICUgdmFsdWVzLiBpZiBzbywgaGFuZGxlIHNwYWNlciByZXNpemUgZGlmZmVyZW50bHkuLi4NCgkJCQkJd2lkdGg6IHNpemVDU1Mud2lkdGguc2xpY2UoLTEpID09PSAiJSIsDQoJCQkJCWhlaWdodDogc2l6ZUNTUy5oZWlnaHQuc2xpY2UoLTEpID09PSAiJSIsDQoJCQkJCWF1dG9GdWxsV2lkdGg6IHNpemVDU1Mud2lkdGggPT09ICIwcHgiICYmICBpbkZsb3cgJiYgaXNNYXJnaW5Db2xsYXBzZVR5cGUocGluQ1NTLmRpc3BsYXkpDQoJCQkJfSwNCgkJCQlwdXNoRm9sbG93ZXJzOiBzZXR0aW5ncy5wdXNoRm9sbG93ZXJzLA0KCQkJCWluRmxvdzogaW5GbG93LCAvLyBzdG9yZXMgaWYgdGhlIGVsZW1lbnQgdGFrZXMgdXAgc3BhY2UgaW4gdGhlIGRvY3VtZW50IGZsb3cNCgkJCQlvcmlnU3R5bGU6IHsNCgkJCQkJd2lkdGg6IHBpbklubGluZUNTUy53aWR0aCB8fCAiIiwNCgkJCQkJcG9zaXRpb246IHBpbklubGluZUNTUy5wb3NpdGlvbiB8fCAiIiwNCgkJCQkJdG9wOiBwaW5JbmxpbmVDU1MudG9wIHx8ICIiLA0KCQkJCQlsZWZ0OiBwaW5JbmxpbmVDU1MubGVmdCB8fCAiIiwNCgkJCQkJYm90dG9tOiBwaW5JbmxpbmVDU1MuYm90dG9tIHx8ICIiLA0KCQkJCQlyaWdodDogcGluSW5saW5lQ1NTLnJpZ2h0IHx8ICIiLA0KCQkJCQkiYm94LXNpemluZyI6IHBpbklubGluZUNTU1siYm94LXNpemluZyJdIHx8ICIiLA0KCQkJCQkiLW1vei1ib3gtc2l6aW5nIjogcGluSW5saW5lQ1NTWyItbW96LWJveC1zaXppbmciXSB8fCAiIiwNCgkJCQkJIi13ZWJraXQtYm94LXNpemluZyI6IHBpbklubGluZUNTU1siLXdlYmtpdC1ib3gtc2l6aW5nIl0gfHwgIiINCgkJCQl9LCAvLyBzYXZlIG9sZCBzdHlsZXMgKGZvciByZXNldCkNCgkJCQlwaW5uZWRDbGFzczogc2V0dGluZ3MucGlubmVkQ2xhc3MgLy8gdGhlIGNsYXNzIHRoYXQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBlbGVtZW50IHdoZW4gcGlubmVkDQoJCQl9Ow0KDQoJCQkvLyBpZiByZWxhdGl2ZSBzaXplLCB0cmFuc2ZlciBpdCB0byBzcGFjZXIgYW5kIG1ha2UgcGluIGNhbGN1bGF0ZSBpdC4uLg0KCQkJaWYgKF9waW5PcHRpb25zLnJlbFNpemUud2lkdGgpIHsNCgkJCQlzcGFjZXIuY3NzKCJ3aWR0aCIsIHNpemVDU1Mud2lkdGgpOw0KCQkJfQ0KCQkJaWYgKF9waW5PcHRpb25zLnJlbFNpemUuaGVpZ2h0KSB7DQoJCQkJc3BhY2VyLmNzcygiaGVpZ2h0Iiwgc2l6ZUNTUy5oZWlnaHQpOw0KCQkJfQ0KDQoJCQkvLyBub3cgcGxhY2UgdGhlIHBpbiBlbGVtZW50IGluc2lkZSB0aGUgc3BhY2VyCQ0KCQkJX3Bpbi5iZWZvcmUoc3BhY2VyKQ0KCQkJCQkuYXBwZW5kVG8oc3BhY2VyKQ0KCQkJCQkvLyBhbmQgc2V0IG5ldyBjc3MNCgkJCQkJLmNzcyh7DQoJCQkJCQlwb3NpdGlvbjogaW5GbG93ID8gInJlbGF0aXZlIiA6ICJhYnNvbHV0ZSIsDQoJCQkJCQl0b3A6ICJhdXRvIiwNCgkJCQkJCWxlZnQ6ICJhdXRvIiwNCgkJCQkJCWJvdHRvbTogImF1dG8iLA0KCQkJCQkJcmlnaHQ6ICJhdXRvIg0KCQkJCQl9KTsNCgkJCQ0KCQkJaWYgKF9waW5PcHRpb25zLnJlbFNpemUud2lkdGggfHwgX3Bpbk9wdGlvbnMucmVsU2l6ZS5hdXRvRnVsbFdpZHRoKSB7DQoJCQkJX3Bpbi5jc3MoImJveC1zaXppbmciLCAiYm9yZGVyLWJveCIpOw0KCQkJfQ0KDQoJCQkvLyBhZGQgbGlzdGVuZXIgdG8gZG9jdW1lbnQgdG8gdXBkYXRlIHBpbiBwb3NpdGlvbiBpbiBjYXNlIGNvbnRyb2xsZXIgaXMgbm90IHRoZSBkb2N1bWVudC4NCgkJCSQod2luZG93KS5vbigic2Nyb2xsLiIgKyBOQU1FU1BBQ0UgKyAiX3BpbiByZXNpemUuIiArIE5BTUVTUEFDRSArICJfcGluIiwgdXBkYXRlUGluSW5Db250YWluZXIpOw0KCQkJLy8gYWRkIG1vdXNld2hlZWwgbGlzdGVuZXIgdG8gY2F0Y2ggc2Nyb2xscyBvdmVyIGZpeGVkIGVsZW1lbnRzDQoJCQlfcGluLm9uKCJtb3VzZXdoZWVsIERPTU1vdXNlU2Nyb2xsIiwgb25Nb3VzZXdoZWVsT3ZlclBpbik7DQoNCgkJCWxvZygzLCAiYWRkZWQgcGluIik7DQoNCgkJCS8vIGZpbmFsbHkgdXBkYXRlIHRoZSBwaW4gdG8gaW5pdA0KCQkJdXBkYXRlUGluU3RhdGUoKTsNCg0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBSZW1vdmUgdGhlIHBpbiBmcm9tIHRoZSBzY2VuZS4NCgkJICogQHB1YmxpYw0KCQkgKiBAZXhhbXBsZQ0KCQkgKiAvLyByZW1vdmUgdGhlIHBpbiBmcm9tIHRoZSBzY2VuZSB3aXRob3V0IHJlc2V0dGluZyBpdCAodGhlIHNwYWNlciBpcyBub3QgcmVtb3ZlZCkNCgkJICogc2NlbmUucmVtb3ZlUGluKCk7DQoJCSAqDQoJCSAqIC8vIHJlbW92ZSB0aGUgcGluIGZyb20gdGhlIHNjZW5lIGFuZCByZXNldCB0aGUgcGluIGVsZW1lbnQgdG8gaXRzIGluaXRpYWwgcG9zaXRpb24gKHNwYWNlciBpcyByZW1vdmVkKQ0KCQkgKiBzY2VuZS5yZW1vdmVQaW4odHJ1ZSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW3Jlc2V0PWZhbHNlXSAtIElmIGBmYWxzZWAgdGhlIHNwYWNlciB3aWxsIG5vdCBiZSByZW1vdmVkIGFuZCB0aGUgZWxlbWVudCdzIHBvc2l0aW9uIHdpbGwgbm90IGJlIHJlc2V0Lg0KCQkgKiBAcmV0dXJucyB7U2Nyb2xsU2NlbmV9IFBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJdGhpcy5yZW1vdmVQaW4gPSBmdW5jdGlvbiAocmVzZXQpIHsNCgkJCWlmIChfcGluKSB7DQoJCQkJaWYgKHJlc2V0IHx8ICFfcGFyZW50KSB7IC8vIGlmIHRoZXJlJ3Mgbm8gcGFyZW50IG5vIHByb2dyZXNzIHdhcyBtYWRlIGFueXdheS4uLg0KCQkJCQlfcGluLmluc2VydEJlZm9yZShfcGluT3B0aW9ucy5zcGFjZXIpDQoJCQkJCQkuY3NzKF9waW5PcHRpb25zLm9yaWdTdHlsZSk7DQoJCQkJCV9waW5PcHRpb25zLnNwYWNlci5yZW1vdmUoKTsNCgkJCQl9IGVsc2Ugew0KCQkJCQlpZiAoX3N0YXRlID09PSAiRFVSSU5HIikgew0KCQkJCQkJdXBkYXRlUGluU3RhdGUodHJ1ZSk7IC8vIGZvcmNlIHVucGluIGF0IHBvc2l0aW9uDQoJCQkJCX0NCgkJCQl9DQoJCQkJJCh3aW5kb3cpLm9mZigic2Nyb2xsLiIgKyBOQU1FU1BBQ0UgKyAiX3BpbiByZXNpemUuIiArIE5BTUVTUEFDRSArICJfcGluIik7DQoJCQkJX3Bpbi5vZmYoIm1vdXNld2hlZWwgRE9NTW91c2VTY3JvbGwiLCBvbk1vdXNld2hlZWxPdmVyUGluKTsNCgkJCQlfcGluID0gdW5kZWZpbmVkOw0KCQkJCWxvZygzLCAicmVtb3ZlZCBwaW4gKHJlc2V0OiAiICsgKHJlc2V0ID8gInRydWUiIDogImZhbHNlIikgKyAiKSIpOw0KCQkJfQ0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBEZWZpbmUgYSBjc3MgY2xhc3MgbW9kaWZpY2F0aW9uIHdoaWxlIHRoZSBzY2VuZSBpcyBhY3RpdmUuICANCgkJICogV2hlbiB0aGUgc2NlbmUgdHJpZ2dlcnMgdGhlIGNsYXNzZXMgd2lsbCBiZSBhZGRlZCB0byB0aGUgc3VwcGxpZWQgZWxlbWVudCBhbmQgcmVtb3ZlZCwgd2hlbiB0aGUgc2NlbmUgaXMgb3Zlci4NCgkJICogSWYgdGhlIHNjZW5lIGR1cmF0aW9uIGlzIDAgdGhlIGNsYXNzZXMgd2lsbCBvbmx5IGJlIHJlbW92ZWQgaWYgdGhlIHVzZXIgc2Nyb2xscyBiYWNrIHBhc3QgdGhlIHN0YXJ0IHBvc2l0aW9uLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGFkZCB0aGUgY2xhc3MgJ215Y2xhc3MnIHRvIHRoZSBlbGVtZW50IHdpdGggdGhlIGlkICdteS1lbGVtJyBmb3IgdGhlIGR1cmF0aW9uIG9mIHRoZSBzY2VuZQ0KCQkgKiBzY2VuZS5zZXRDbGFzc1RvZ2dsZSgiI215LWVsZW0iLCAibXljbGFzcyIpOw0KCQkgKg0KCQkgKiAvLyBhZGQgbXVsdGlwbGUgY2xhc3NlcyB0byBtdWx0aXBsZSBlbGVtZW50cyBkZWZpbmVkIGJ5IHRoZSBzZWxlY3RvciAnLmNsYXNzQ2hhbmdlJw0KCQkgKiBzY2VuZS5zZXRDbGFzc1RvZ2dsZSgiLmNsYXNzQ2hhbmdlIiwgImNsYXNzMSBjbGFzczIgY2xhc3MzIik7DQoJCSAqDQoJCSAqIEBwYXJhbSB7KHN0cmluZ3xvYmplY3QpfSBlbGVtZW50IC0gQSBTZWxlY3RvciB0YXJnZXRpbmcgb25lIG9yIG1vcmUgZWxlbWVudHMsIGEgRE9NIG9iamVjdCBvciBhIGpRdWVyeSBvYmplY3QgdGhhdCBpcyBzdXBwb3NlZCB0byBiZSBtb2RpZmllZC4NCgkJICogQHBhcmFtIHtzdHJpbmd9IGNsYXNzZXMgLSBPbmUgb3IgbW9yZSBDbGFzc25hbWVzIChzZXBhcmF0ZWQgYnkgc3BhY2UpIHRoYXQgc2hvdWxkIGJlIGFkZGVkIHRvIHRoZSBlbGVtZW50IGR1cmluZyB0aGUgc2NlbmUuDQoJCSAqDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLnNldENsYXNzVG9nZ2xlID0gZnVuY3Rpb24gKGVsZW1lbnQsIGNsYXNzZXMpIHsNCgkJCXZhciAkZWxtID0gJChlbGVtZW50KTsNCgkJCWlmICgkZWxtLmxlbmd0aCA9PT0gMCB8fCAkLnR5cGUoY2xhc3NlcykgIT09ICJzdHJpbmciKSB7DQoJCQkJbG9nKDEsICJFUlJPUiBjYWxsaW5nIG1ldGhvZCAnc2V0Q2xhc3NUb2dnbGUoKSc6IEludmFsaWQgIiArICgkZWxtLmxlbmd0aCA9PT0gMCA/ICJlbGVtZW50IiA6ICJjbGFzc2VzIikgKyAiIHN1cHBsaWVkLiIpOw0KCQkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJCX0NCgkJCV9jc3NDbGFzc2VzID0gY2xhc3NlczsNCgkJCV9jc3NDbGFzc0VsbSA9ICRlbG07DQoJCQlTY3JvbGxTY2VuZS5vbigiZW50ZXIuaW50ZXJuYWxfY2xhc3MgbGVhdmUuaW50ZXJuYWxfY2xhc3MiLCBmdW5jdGlvbiAoZSkgew0KCQkJCV9jc3NDbGFzc0VsbS50b2dnbGVDbGFzcyhfY3NzQ2xhc3NlcywgZS50eXBlID09PSAiZW50ZXIiKTsNCgkJCX0pOw0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBSZW1vdmUgdGhlIGNsYXNzIGJpbmRpbmcgZnJvbSB0aGUgc2NlbmUuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gcmVtb3ZlIGNsYXNzIGJpbmRpbmcgZnJvbSB0aGUgc2NlbmUgd2l0aG91dCByZXNldA0KCQkgKiBzY2VuZS5yZW1vdmVDbGFzc1RvZ2dsZSgpOw0KCQkgKg0KCQkgKiAvLyByZW1vdmUgY2xhc3MgYmluZGluZyBhbmQgcmVtb3ZlIHRoZSBjaGFuZ2VzIGl0IGNhdXNlZA0KCQkgKiBzY2VuZS5yZW1vdmVDbGFzc1RvZ2dsZSh0cnVlKTsNCgkJICoNCgkJICogQHBhcmFtIHtib29sZWFufSBbcmVzZXQ9ZmFsc2VdIC0gSWYgYGZhbHNlYCBhbmQgdGhlIGNsYXNzZXMgYXJlIGN1cnJlbnRseSBhY3RpdmUsIHRoZXkgd2lsbCByZW1haW4gb24gdGhlIGVsZW1lbnQuIElmIGB0cnVlYCB0aGV5IHdpbGwgYmUgcmVtb3ZlZC4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMucmVtb3ZlQ2xhc3NUb2dnbGUgPSBmdW5jdGlvbiAocmVzZXQpIHsNCgkJCWlmIChfY3NzQ2xhc3NFbG0gJiYgcmVzZXQpIHsNCgkJCQlfY3NzQ2xhc3NFbG0ucmVtb3ZlQ2xhc3MoX2Nzc0NsYXNzZXMpOw0KCQkJfQ0KCQkJU2Nyb2xsU2NlbmUub2ZmKCJzdGFydC5pbnRlcm5hbF9jbGFzcyBlbmQuaW50ZXJuYWxfY2xhc3MiKTsNCgkJCV9jc3NDbGFzc2VzID0gdW5kZWZpbmVkOw0KCQkJX2Nzc0NsYXNzRWxtID0gdW5kZWZpbmVkOw0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQl9Ow0KDQoJCS8qKg0KCQkgKiBBZGQgdGhlIHNjZW5lIHRvIGEgY29udHJvbGxlci4gIA0KCQkgKiBUaGlzIGlzIHRoZSBlcXVpdmFsZW50IHRvIGBTY3JvbGxNYWdpYy5hZGRTY2VuZShzY2VuZSlgLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGFkZCBhIHNjZW5lIHRvIGEgU2Nyb2xsTWFnaWMgY29udHJvbGxlcg0KCQkgKiBzY2VuZS5hZGRUbyhjb250cm9sbGVyKTsNCgkJICoNCgkJICogQHBhcmFtIHtTY3JvbGxNYWdpY30gY29udHJvbGxlciAtIFRoZSBjb250cm9sbGVyIHRvIHdoaWNoIHRoZSBzY2VuZSBzaG91bGQgYmUgYWRkZWQuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQl0aGlzLmFkZFRvID0gZnVuY3Rpb24gKGNvbnRyb2xsZXIpIHsNCgkJCWlmICghKGNvbnRyb2xsZXIgaW5zdGFuY2VvZiBTY3JvbGxNYWdpYykpIHsNCgkJCQlsb2coMSwgIkVSUk9SOiBzdXBwbGllZCBhcmd1bWVudCBvZiAnYWRkVG8oKScgaXMgbm90IGEgdmFsaWQgU2Nyb2xsTWFnaWMgY29udHJvbGxlciIpOw0KCQkJfSBlbHNlIGlmIChfcGFyZW50ICE9IGNvbnRyb2xsZXIpIHsNCgkJCQkvLyBuZXcgcGFyZW50DQoJCQkJaWYgKF9wYXJlbnQpIHsgLy8gSSBoYWQgYSBwYXJlbnQgYmVmb3JlLCBzbyByZW1vdmUgaXQuLi4NCgkJCQkJX3BhcmVudC5yZW1vdmVTY2VuZShTY3JvbGxTY2VuZSk7DQoJCQkJfQ0KCQkJCV9wYXJlbnQgPSBjb250cm9sbGVyOw0KCQkJCXZhbGlkYXRlT3B0aW9uKCk7DQoJCQkJdXBkYXRlRHVyYXRpb24odHJ1ZSk7DQoJCQkJdXBkYXRlVHJpZ2dlckVsZW1lbnRQb3NpdGlvbih0cnVlKTsNCgkJCQl1cGRhdGVTY3JvbGxPZmZzZXQoKTsNCgkJCQl1cGRhdGVQaW5TcGFjZXJTaXplKCk7DQoJCQkJX3BhcmVudC5pbmZvKCJjb250YWluZXIiKS5vbigicmVzaXplLiIgKyBOQU1FU1BBQ0UsIGZ1bmN0aW9uICgpIHsNCgkJCQkJdXBkYXRlUmVsYXRpdmVQaW5TcGFjZXIoKTsNCgkJCQkJaWYgKFNjcm9sbFNjZW5lLnRyaWdnZXJIb29rKCkgPiAwKSB7DQoJCQkJCQlTY3JvbGxTY2VuZS50cmlnZ2VyKCJzaGlmdCIsIHtyZWFzb246ICJjb250YWluZXJTaXplIn0pOw0KCQkJCQl9DQoJCQkJfSk7DQoJCQkJbG9nKDMsICJhZGRlZCAiICsgTkFNRVNQQUNFICsgIiB0byBjb250cm9sbGVyIik7DQoJCQkJY29udHJvbGxlci5hZGRTY2VuZShTY3JvbGxTY2VuZSk7DQoJCQkJU2Nyb2xsU2NlbmUudXBkYXRlKCk7DQoJCQl9DQoJCQlyZXR1cm4gU2Nyb2xsU2NlbmU7DQoJCX07DQoNCgkJLyoqDQoJCSAqICoqR2V0Kiogb3IgKipTZXQqKiB0aGUgY3VycmVudCBlbmFibGVkIHN0YXRlIG9mIHRoZSBzY2VuZS4gIA0KCQkgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIGRpc2FibGUgdGhpcyBzY2VuZSB3aXRob3V0IHJlbW92aW5nIG9yIGRlc3Ryb3lpbmcgaXQuDQoJCSAqIEBwdWJsaWMNCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogLy8gZ2V0IHRoZSBjdXJyZW50IHZhbHVlDQoJCSAqIHZhciBlbmFibGVkID0gc2NlbmUuZW5hYmxlZCgpOw0KCQkgKg0KCSAJICogLy8gZGlzYWJsZSB0aGUgc2NlbmUNCgkJICogc2NlbmUuZW5hYmxlZChmYWxzZSk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7Ym9vbGVhbn0gW25ld1N0YXRlXSAtIFRoZSBuZXcgZW5hYmxlZCBzdGF0ZSBvZiB0aGUgc2NlbmUgYHRydWVgIG9yIGBmYWxzZWAuDQoJCSAqIEByZXR1cm5zIHsoYm9vbGVhbnxTY3JvbGxTY2VuZSl9IEN1cnJlbnQgZW5hYmxlZCBzdGF0ZSBvciBwYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMuZW5hYmxlZCA9IGZ1bmN0aW9uIChuZXdTdGF0ZSkgew0KCQkJaWYgKCFhcmd1bWVudHMubGVuZ3RoKSB7IC8vIGdldA0KCQkJCXJldHVybiBfZW5hYmxlZDsNCgkJCX0gZWxzZSBpZiAoX2VuYWJsZWQgIT0gbmV3U3RhdGUpIHsgLy8gc2V0DQoJCQkJX2VuYWJsZWQgPSAhIW5ld1N0YXRlOw0KCQkJCVNjcm9sbFNjZW5lLnVwZGF0ZSh0cnVlKTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJfTsNCgkJDQoJCS8qKg0KCQkgKiBSZW1vdmUgdGhlIHNjZW5lIGZyb20gaXRzIHBhcmVudCBjb250cm9sbGVyLiAgDQoJCSAqIFRoaXMgaXMgdGhlIGVxdWl2YWxlbnQgdG8gYFNjcm9sbE1hZ2ljLnJlbW92ZVNjZW5lKHNjZW5lKWAuDQoJCSAqIFRoZSBzY2VuZSB3aWxsIG5vdCBiZSB1cGRhdGVkIGFueW1vcmUgdW50aWwgeW91IHJlYWRkIGl0IHRvIGEgY29udHJvbGxlci4NCgkJICogVG8gcmVtb3ZlIHRoZSBwaW4gb3IgdGhlIHR3ZWVuIHlvdSBuZWVkIHRvIGNhbGwgcmVtb3ZlVHdlZW4oKSBvciByZW1vdmVQaW4oKSByZXNwZWN0aXZlbHkuDQoJCSAqIEBwdWJsaWMNCgkJICogQGV4YW1wbGUNCgkJICogLy8gcmVtb3ZlIHRoZSBzY2VuZSBmcm9tIGl0cyBwYXJlbnQgY29udHJvbGxlcg0KCQkgKiBzY2VuZS5yZW1vdmUoKTsNCgkJICoNCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCXRoaXMucmVtb3ZlID0gZnVuY3Rpb24gKCkgew0KCQkJaWYgKF9wYXJlbnQpIHsNCgkJCQlfcGFyZW50LmluZm8oImNvbnRhaW5lciIpLm9mZigicmVzaXplLiIgKyBOQU1FU1BBQ0UpOw0KCQkJCXZhciB0bXBQYXJlbnQgPSBfcGFyZW50Ow0KCQkJCV9wYXJlbnQgPSB1bmRlZmluZWQ7DQoJCQkJbG9nKDMsICJyZW1vdmVkICIgKyBOQU1FU1BBQ0UgKyAiIGZyb20gY29udHJvbGxlciIpOw0KCQkJCXRtcFBhcmVudC5yZW1vdmVTY2VuZShTY3JvbGxTY2VuZSk7DQoJCQl9DQoJCQlyZXR1cm4gU2Nyb2xsU2NlbmU7DQoJCX07DQoNCgkJLyoqDQoJCSAqIERlc3Ryb3kgdGhlIHNjZW5lIGFuZCBldmVyeXRoaW5nLg0KCQkgKiBAcHVibGljDQoJCSAqIEBleGFtcGxlDQoJCSAqIC8vIGRlc3Ryb3kgdGhlIHNjZW5lIHdpdGhvdXQgcmVzZXR0aW5nIHRoZSBwaW4gYW5kIHR3ZWVuIHRvIHRoZWlyIGluaXRpYWwgcG9zaXRpb25zDQoJCSAqIHNjZW5lID0gc2NlbmUuZGVzdHJveSgpOw0KCQkgKg0KCQkgKiAvLyBkZXN0cm95IHRoZSBzY2VuZSBhbmQgcmVzZXQgdGhlIHBpbiBhbmQgdHdlZW4NCgkJICogc2NlbmUgPSBzY2VuZS5kZXN0cm95KHRydWUpOw0KCQkgKg0KCQkgKiBAcGFyYW0ge2Jvb2xlYW59IFtyZXNldD1mYWxzZV0gLSBJZiBgdHJ1ZWAgdGhlIHBpbiBhbmQgdHdlZW4gKGlmIGV4aXN0ZW50KSB3aWxsIGJlIHJlc2V0Lg0KCQkgKiBAcmV0dXJucyB7bnVsbH0gTnVsbCB0byB1bnNldCBoYW5kbGVyIHZhcmlhYmxlcy4NCgkJICovDQoJCXRoaXMuZGVzdHJveSA9IGZ1bmN0aW9uIChyZXNldCkgew0KCQkJU2Nyb2xsU2NlbmUucmVtb3ZlVHdlZW4ocmVzZXQpOw0KCQkJU2Nyb2xsU2NlbmUucmVtb3ZlUGluKHJlc2V0KTsNCgkJCVNjcm9sbFNjZW5lLnJlbW92ZUNsYXNzVG9nZ2xlKHJlc2V0KTsNCgkJCVNjcm9sbFNjZW5lLnRyaWdnZXIoImRlc3Ryb3kiLCB7cmVzZXQ6IHJlc2V0fSk7DQoJCQlTY3JvbGxTY2VuZS5yZW1vdmUoKTsNCgkJCVNjcm9sbFNjZW5lLm9mZigic3RhcnQgZW5kIGVudGVyIGxlYXZlIHByb2dyZXNzIGNoYW5nZSB1cGRhdGUgc2hpZnQgZGVzdHJveSBzaGlmdC5pbnRlcm5hbCBjaGFuZ2UuaW50ZXJuYWwgcHJvZ3Jlc3MuaW50ZXJuYWwiKTsNCgkJCWxvZygzLCAiZGVzdHJveWVkICIgKyBOQU1FU1BBQ0UgKyAiIChyZXNldDogIiArIChyZXNldCA/ICJ0cnVlIiA6ICJmYWxzZSIpICsgIikiKTsNCgkJCXJldHVybiBudWxsOw0KCQl9Ow0KDQoJCS8qDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICogRVZFTlRTDQoJCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkJICovDQoJCQ0KCQkvKioNCgkJICogU2NlbmUgc3RhcnQgZXZlbnQuICANCgkJICogRmlyZXMgd2hlbmV2ZXIgdGhlIHNjcm9sbCBwb3NpdGlvbiBpdHMgdGhlIHN0YXJ0aW5nIHBvaW50IG9mIHRoZSBzY2VuZS4gIA0KCQkgKiBJdCB3aWxsIGFsc28gZmlyZSB3aGVuIHNjcm9sbGluZyBiYWNrIHVwIGdvaW5nIG92ZXIgdGhlIHN0YXJ0IHBvc2l0aW9uIG9mIHRoZSBzY2VuZS4gSWYgeW91IHdhbnQgc29tZXRoaW5nIHRvIGhhcHBlbiBvbmx5IHdoZW4gc2Nyb2xsaW5nIGRvd24vcmlnaHQsIHVzZSB0aGUgc2Nyb2xsRGlyZWN0aW9uIHBhcmFtZXRlciBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLg0KCQkgKg0KCQkgKiBGb3IgZGV0YWlscyBvbiB0aGlzIGV2ZW50IGFuZCB0aGUgb3JkZXIgaW4gd2hpY2ggaXQgaXMgZmlyZWQsIHBsZWFzZSByZXZpZXcgdGhlIHtAbGluayBTY3JvbGxTY2VuZS5wcm9ncmVzc30gbWV0aG9kLg0KCQkgKg0KCQkgKiBAZXZlbnQgU2Nyb2xsU2NlbmUuc3RhcnQNCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogc2NlbmUub24oInN0YXJ0IiwgZnVuY3Rpb24gKGV2ZW50KSB7DQoJCSAqIAkJYWxlcnQoIkhpdCBzdGFydCBwb2ludCBvZiBzY2VuZS4iKTsNCgkJICogfSk7DQoJCSAqDQoJCSAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBldmVudCAtIFRoZSBldmVudCBPYmplY3QgcGFzc2VkIHRvIGVhY2ggY2FsbGJhY2sNCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnR5cGUgLSBUaGUgbmFtZSBvZiB0aGUgZXZlbnQNCgkJICogQHByb3BlcnR5IHtTY3JvbGxTY2VuZX0gZXZlbnQudGFyZ2V0IC0gVGhlIFNjcm9sbFNjZW5lIG9iamVjdCB0aGF0IHRyaWdnZXJlZCB0aGlzIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBldmVudC5wcm9ncmVzcyAtIFJlZmxlY3RzIHRoZSBjdXJyZW50IHByb2dyZXNzIG9mIHRoZSBzY2VuZQ0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQuc3RhdGUgLSBUaGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgc2NlbmUgYCJCRUZPUkUiYCwgYCJEVVJJTkciYCBvciBgIkFGVEVSImANCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnNjcm9sbERpcmVjdGlvbiAtIEluZGljYXRlcyB3aGljaCB3YXkgd2UgYXJlIHNjcm9sbGluZyBgIlBBVVNFRCJgLCBgIkZPUldBUkQiYCBvciBgIlJFVkVSU0UiYA0KCQkgKi8NCgkJLyoqDQoJCSAqIFNjZW5lIGVuZCBldmVudC4gIA0KCQkgKiBGaXJlcyB3aGVuZXZlciB0aGUgc2Nyb2xsIHBvc2l0aW9uIGl0cyB0aGUgZW5kaW5nIHBvaW50IG9mIHRoZSBzY2VuZS4gIA0KCQkgKiBJdCB3aWxsIGFsc28gZmlyZSB3aGVuIHNjcm9sbGluZyBiYWNrIHVwIGZyb20gYWZ0ZXIgdGhlIHNjZW5lIGFuZCBnb2luZyBvdmVyIGl0cyBlbmQgcG9zaXRpb24uIElmIHlvdSB3YW50IHNvbWV0aGluZyB0byBoYXBwZW4gb25seSB3aGVuIHNjcm9sbGluZyBkb3duL3JpZ2h0LCB1c2UgdGhlIHNjcm9sbERpcmVjdGlvbiBwYXJhbWV0ZXIgcGFzc2VkIHRvIHRoZSBjYWxsYmFjay4NCgkJICoNCgkJICogRm9yIGRldGFpbHMgb24gdGhpcyBldmVudCBhbmQgdGhlIG9yZGVyIGluIHdoaWNoIGl0IGlzIGZpcmVkLCBwbGVhc2UgcmV2aWV3IHRoZSB7QGxpbmsgU2Nyb2xsU2NlbmUucHJvZ3Jlc3N9IG1ldGhvZC4NCgkJICoNCgkJICogQGV2ZW50IFNjcm9sbFNjZW5lLmVuZA0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBzY2VuZS5vbigiZW5kIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQoJCSAqIAkJYWxlcnQoIkhpdCBlbmQgcG9pbnQgb2Ygc2NlbmUuIik7DQoJCSAqIH0pOw0KCQkgKg0KCQkgKiBAcHJvcGVydHkge29iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgT2JqZWN0IHBhc3NlZCB0byBlYWNoIGNhbGxiYWNrDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC50eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7U2Nyb2xsU2NlbmV9IGV2ZW50LnRhcmdldCAtIFRoZSBTY3JvbGxTY2VuZSBvYmplY3QgdGhhdCB0cmlnZ2VyZWQgdGhpcyBldmVudA0KCQkgKiBAcHJvcGVydHkge251bWJlcn0gZXZlbnQucHJvZ3Jlc3MgLSBSZWZsZWN0cyB0aGUgY3VycmVudCBwcm9ncmVzcyBvZiB0aGUgc2NlbmUNCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnN0YXRlIC0gVGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHNjZW5lIGAiQkVGT1JFImAsIGAiRFVSSU5HImAgb3IgYCJBRlRFUiJgDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC5zY3JvbGxEaXJlY3Rpb24gLSBJbmRpY2F0ZXMgd2hpY2ggd2F5IHdlIGFyZSBzY3JvbGxpbmcgYCJQQVVTRUQiYCwgYCJGT1JXQVJEImAgb3IgYCJSRVZFUlNFImANCgkJICovDQoJCS8qKg0KCQkgKiBTY2VuZSBlbnRlciBldmVudC4gIA0KCQkgKiBGaXJlcyB3aGVuZXZlciB0aGUgc2NlbmUgZW50ZXJzIHRoZSAiRFVSSU5HIiBzdGF0ZS4gIA0KCQkgKiBLZWVwIGluIG1pbmQgdGhhdCBpdCBkb2Vzbid0IG1hdHRlciBpZiB0aGUgc2NlbmUgcGxheXMgZm9yd2FyZCBvciBiYWNrd2FyZDogVGhpcyBldmVudCBhbHdheXMgZmlyZXMgd2hlbiB0aGUgc2NlbmUgZW50ZXJzIGl0cyBhY3RpdmUgc2Nyb2xsIHRpbWVmcmFtZSwgcmVnYXJkbGVzcyBvZiB0aGUgc2Nyb2xsLWRpcmVjdGlvbi4NCgkJICoNCgkJICogRm9yIGRldGFpbHMgb24gdGhpcyBldmVudCBhbmQgdGhlIG9yZGVyIGluIHdoaWNoIGl0IGlzIGZpcmVkLCBwbGVhc2UgcmV2aWV3IHRoZSB7QGxpbmsgU2Nyb2xsU2NlbmUucHJvZ3Jlc3N9IG1ldGhvZC4NCgkJICoNCgkJICogQGV2ZW50IFNjcm9sbFNjZW5lLmVudGVyDQoJCSAqDQoJCSAqIEBleGFtcGxlDQoJCSAqIHNjZW5lLm9uKCJlbnRlciIsIGZ1bmN0aW9uIChldmVudCkgew0KCQkgKiAJCWFsZXJ0KCJFbnRlcmVkIGEgc2NlbmUuIik7DQoJCSAqIH0pOw0KCQkgKg0KCQkgKiBAcHJvcGVydHkge29iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgT2JqZWN0IHBhc3NlZCB0byBlYWNoIGNhbGxiYWNrDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC50eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7U2Nyb2xsU2NlbmV9IGV2ZW50LnRhcmdldCAtIFRoZSBTY3JvbGxTY2VuZSBvYmplY3QgdGhhdCB0cmlnZ2VyZWQgdGhpcyBldmVudA0KCQkgKiBAcHJvcGVydHkge251bWJlcn0gZXZlbnQucHJvZ3Jlc3MgLSBSZWZsZWN0cyB0aGUgY3VycmVudCBwcm9ncmVzcyBvZiB0aGUgc2NlbmUNCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnN0YXRlIC0gVGhlIGN1cnJlbnQgc3RhdGUgb2YgdGhlIHNjZW5lIGAiQkVGT1JFImAsIGAiRFVSSU5HImAgb3IgYCJBRlRFUiJgDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC5zY3JvbGxEaXJlY3Rpb24gLSBJbmRpY2F0ZXMgd2hpY2ggd2F5IHdlIGFyZSBzY3JvbGxpbmcgYCJQQVVTRUQiYCwgYCJGT1JXQVJEImAgb3IgYCJSRVZFUlNFImANCgkJICovDQoJCS8qKg0KCQkgKiBTY2VuZSBsZWF2ZSBldmVudC4gIA0KCQkgKiBGaXJlcyB3aGVuZXZlciB0aGUgc2NlbmUncyBzdGF0ZSBnb2VzIGZyb20gIkRVUklORyIgdG8gZWl0aGVyICJCRUZPUkUiIG9yICJBRlRFUiIuICANCgkJICogS2VlcCBpbiBtaW5kIHRoYXQgaXQgZG9lc24ndCBtYXR0ZXIgaWYgdGhlIHNjZW5lIHBsYXlzIGZvcndhcmQgb3IgYmFja3dhcmQ6IFRoaXMgZXZlbnQgYWx3YXlzIGZpcmVzIHdoZW4gdGhlIHNjZW5lIGxlYXZlcyBpdHMgYWN0aXZlIHNjcm9sbCB0aW1lZnJhbWUsIHJlZ2FyZGxlc3Mgb2YgdGhlIHNjcm9sbC1kaXJlY3Rpb24uDQoJCSAqDQoJCSAqIEZvciBkZXRhaWxzIG9uIHRoaXMgZXZlbnQgYW5kIHRoZSBvcmRlciBpbiB3aGljaCBpdCBpcyBmaXJlZCwgcGxlYXNlIHJldmlldyB0aGUge0BsaW5rIFNjcm9sbFNjZW5lLnByb2dyZXNzfSBtZXRob2QuDQoJCSAqDQoJCSAqIEBldmVudCBTY3JvbGxTY2VuZS5sZWF2ZQ0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBzY2VuZS5vbigibGVhdmUiLCBmdW5jdGlvbiAoZXZlbnQpIHsNCgkJICogCQlhbGVydCgiTGVmdCBhIHNjZW5lLiIpOw0KCQkgKiB9KTsNCgkJICoNCgkJICogQHByb3BlcnR5IHtvYmplY3R9IGV2ZW50IC0gVGhlIGV2ZW50IE9iamVjdCBwYXNzZWQgdG8gZWFjaCBjYWxsYmFjaw0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQudHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBldmVudA0KCQkgKiBAcHJvcGVydHkge1Njcm9sbFNjZW5lfSBldmVudC50YXJnZXQgLSBUaGUgU2Nyb2xsU2NlbmUgb2JqZWN0IHRoYXQgdHJpZ2dlcmVkIHRoaXMgZXZlbnQNCgkJICogQHByb3BlcnR5IHtudW1iZXJ9IGV2ZW50LnByb2dyZXNzIC0gUmVmbGVjdHMgdGhlIGN1cnJlbnQgcHJvZ3Jlc3Mgb2YgdGhlIHNjZW5lDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC5zdGF0ZSAtIFRoZSBjdXJyZW50IHN0YXRlIG9mIHRoZSBzY2VuZSBgIkJFRk9SRSJgLCBgIkRVUklORyJgIG9yIGAiQUZURVIiYA0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQuc2Nyb2xsRGlyZWN0aW9uIC0gSW5kaWNhdGVzIHdoaWNoIHdheSB3ZSBhcmUgc2Nyb2xsaW5nIGAiUEFVU0VEImAsIGAiRk9SV0FSRCJgIG9yIGAiUkVWRVJTRSJgDQoJCSAqLw0KCQkvKioNCgkJICogU2NlbmUgdXBkYXRlIGV2ZW50LiAgDQoJCSAqIEZpcmVzIHdoZW5ldmVyIHRoZSBzY2VuZSBpcyB1cGRhdGVkIChidXQgbm90IG5lY2Vzc2FyaWx5IGNoYW5nZXMgdGhlIHByb2dyZXNzKS4NCgkJICoNCgkJICogQGV2ZW50IFNjcm9sbFNjZW5lLnVwZGF0ZQ0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBzY2VuZS5vbigidXBkYXRlIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQoJCSAqIAkJY29uc29sZS5sb2coIlNjZW5lIHVwZGF0ZWQuIik7DQoJCSAqIH0pOw0KCQkgKg0KCQkgKiBAcHJvcGVydHkge29iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgT2JqZWN0IHBhc3NlZCB0byBlYWNoIGNhbGxiYWNrDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC50eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7U2Nyb2xsU2NlbmV9IGV2ZW50LnRhcmdldCAtIFRoZSBTY3JvbGxTY2VuZSBvYmplY3QgdGhhdCB0cmlnZ2VyZWQgdGhpcyBldmVudA0KCQkgKiBAcHJvcGVydHkge251bWJlcn0gZXZlbnQuc3RhcnRQb3MgLSBUaGUgc3RhcnRpbmcgcG9zaXRpb24gb2YgdGhlIHNjZW5lIChpbiByZWxhdGlvbiB0byB0aGUgY29uYWluZXIpDQoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBldmVudC5lbmRQb3MgLSBUaGUgZW5kaW5nIHBvc2l0aW9uIG9mIHRoZSBzY2VuZSAoaW4gcmVsYXRpb24gdG8gdGhlIGNvbmFpbmVyKQ0KCQkgKiBAcHJvcGVydHkge251bWJlcn0gZXZlbnQuc2Nyb2xsUG9zIC0gVGhlIGN1cnJlbnQgc2Nyb2xsIHBvc2l0aW9uIG9mIHRoZSBjb250YWluZXINCgkJICovDQoJCS8qKg0KCQkgKiBTY2VuZSBwcm9ncmVzcyBldmVudC4gIA0KCQkgKiBGaXJlcyB3aGVuZXZlciB0aGUgcHJvZ3Jlc3Mgb2YgdGhlIHNjZW5lIGNoYW5nZXMuDQoJCSAqDQoJCSAqIEZvciBkZXRhaWxzIG9uIHRoaXMgZXZlbnQgYW5kIHRoZSBvcmRlciBpbiB3aGljaCBpdCBpcyBmaXJlZCwgcGxlYXNlIHJldmlldyB0aGUge0BsaW5rIFNjcm9sbFNjZW5lLnByb2dyZXNzfSBtZXRob2QuDQoJCSAqDQoJCSAqIEBldmVudCBTY3JvbGxTY2VuZS5wcm9ncmVzcw0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBzY2VuZS5vbigicHJvZ3Jlc3MiLCBmdW5jdGlvbiAoZXZlbnQpIHsNCgkJICogCQljb25zb2xlLmxvZygiU2NlbmUgcHJvZ3Jlc3MgY2hhbmdlZC4iKTsNCgkJICogfSk7DQoJCSAqDQoJCSAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBldmVudCAtIFRoZSBldmVudCBPYmplY3QgcGFzc2VkIHRvIGVhY2ggY2FsbGJhY2sNCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnR5cGUgLSBUaGUgbmFtZSBvZiB0aGUgZXZlbnQNCgkJICogQHByb3BlcnR5IHtTY3JvbGxTY2VuZX0gZXZlbnQudGFyZ2V0IC0gVGhlIFNjcm9sbFNjZW5lIG9iamVjdCB0aGF0IHRyaWdnZXJlZCB0aGlzIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7bnVtYmVyfSBldmVudC5wcm9ncmVzcyAtIFJlZmxlY3RzIHRoZSBjdXJyZW50IHByb2dyZXNzIG9mIHRoZSBzY2VuZQ0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQuc3RhdGUgLSBUaGUgY3VycmVudCBzdGF0ZSBvZiB0aGUgc2NlbmUgYCJCRUZPUkUiYCwgYCJEVVJJTkciYCBvciBgIkFGVEVSImANCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnNjcm9sbERpcmVjdGlvbiAtIEluZGljYXRlcyB3aGljaCB3YXkgd2UgYXJlIHNjcm9sbGluZyBgIlBBVVNFRCJgLCBgIkZPUldBUkQiYCBvciBgIlJFVkVSU0UiYA0KCQkgKi8NCgkJLyoqDQoJCSAqIFNjZW5lIGNoYW5nZSBldmVudC4gIA0KCQkgKiBGaXJlcyB3aGVudmV2ZXIgYSBwcm9wZXJ0eSBvZiB0aGUgc2NlbmUgaXMgY2hhbmdlZC4NCgkJICoNCgkJICogQGV2ZW50IFNjcm9sbFNjZW5lLmNoYW5nZQ0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBzY2VuZS5vbigiY2hhbmdlIiwgZnVuY3Rpb24gKGV2ZW50KSB7DQoJCSAqIAkJY29uc29sZS5sb2coIlNjZW5lIFByb3BlcnR5IFwiIiArIGV2ZW50LndoYXQgKyAiXCIgY2hhbmdlZCB0byAiICsgZXZlbnQubmV3dmFsKTsNCgkJICogfSk7DQoJCSAqDQoJCSAqIEBwcm9wZXJ0eSB7b2JqZWN0fSBldmVudCAtIFRoZSBldmVudCBPYmplY3QgcGFzc2VkIHRvIGVhY2ggY2FsbGJhY2sNCgkJICogQHByb3BlcnR5IHtzdHJpbmd9IGV2ZW50LnR5cGUgLSBUaGUgbmFtZSBvZiB0aGUgZXZlbnQNCgkJICogQHByb3BlcnR5IHtTY3JvbGxTY2VuZX0gZXZlbnQudGFyZ2V0IC0gVGhlIFNjcm9sbFNjZW5lIG9iamVjdCB0aGF0IHRyaWdnZXJlZCB0aGlzIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC53aGF0IC0gSW5kaWNhdGVzIHdoYXQgdmFsdWUgaGFzIGJlZW4gY2hhbmdlZA0KCQkgKiBAcHJvcGVydHkge21peGVkfSBldmVudC5uZXd2YWwgLSBUaGUgbmV3IHZhbHVlIG9mIHRoZSBjaGFuZ2VkIHByb3BlcnR5DQoJCSAqLw0KCQkvKioNCgkJICogU2NlbmUgc2hpZnQgZXZlbnQuICANCgkJICogRmlyZXMgd2hlbnZldmVyIHRoZSBzdGFydCBvciBlbmQgKipzY3JvbGwgb2Zmc2V0Kiogb2YgdGhlIHNjZW5lIGNoYW5nZS4NCgkJICogVGhpcyBoYXBwZW5zIGV4cGxpY2l0ZWx5LCB3aGVuIG9uZSBvZiB0aGVzZSB2YWx1ZXMgY2hhbmdlOiBgb2Zmc2V0YCwgYGR1cmF0aW9uYCBvciBgdHJpZ2dlckhvb2tgLg0KCQkgKiBJdCB3aWxsIGZpcmUgaW1wbGljaXRseSB3aGVuIHRoZSBgdHJpZ2dlckVsZW1lbnRgIGNoYW5nZXMsIGlmIHRoZSBuZXcgZWxlbWVudCBoYXMgYSBkaWZmZXJlbnQgcG9zaXRpb24gKG1vc3QgY2FzZXMpLg0KCQkgKiBJdCB3aWxsIGFsc28gZmlyZSBpbXBsaWNpdGx5IHdoZW4gdGhlIHNpemUgb2YgdGhlIGNvbnRhaW5lciBjaGFuZ2VzIGFuZCB0aGUgdHJpZ2dlckhvb2sgaXMgYW55dGhpbmcgb3RoZXIgdGhhbiBgb25MZWF2ZWAuDQoJCSAqDQoJCSAqIEBldmVudCBTY3JvbGxTY2VuZS5zaGlmdA0KCQkgKiBAc2luY2UgMS4xLjANCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogc2NlbmUub24oInNoaWZ0IiwgZnVuY3Rpb24gKGV2ZW50KSB7DQoJCSAqIAkJY29uc29sZS5sb2coIlNjZW5lIG1vdmVkLCBiZWNhdXNlIHRoZSAiICsgZXZlbnQucmVhc29uICsgIiBoYXMgY2hhbmdlZC4pIik7DQoJCSAqIH0pOw0KCQkgKg0KCQkgKiBAcHJvcGVydHkge29iamVjdH0gZXZlbnQgLSBUaGUgZXZlbnQgT2JqZWN0IHBhc3NlZCB0byBlYWNoIGNhbGxiYWNrDQoJCSAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBldmVudC50eXBlIC0gVGhlIG5hbWUgb2YgdGhlIGV2ZW50DQoJCSAqIEBwcm9wZXJ0eSB7U2Nyb2xsU2NlbmV9IGV2ZW50LnRhcmdldCAtIFRoZSBTY3JvbGxTY2VuZSBvYmplY3QgdGhhdCB0cmlnZ2VyZWQgdGhpcyBldmVudA0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQucmVhc29uIC0gSW5kaWNhdGVzIHdoeSB0aGUgc2NlbmUgaGFzIHNoaWZ0ZWQNCgkJICovDQoJCS8qKg0KCQkgKiBTY2VuZSBkZXN0cm95IGV2ZW50LiAgDQoJCSAqIEZpcmVzIHdoZW52ZXZlciB0aGUgc2NlbmUgaXMgZGVzdHJveWVkLg0KCQkgKiBUaGlzIGNhbiBiZSB1c2VkIHRvIHRpZHkgdXAgY3VzdG9tIGJlaGF2aW91ciB1c2VkIGluIGV2ZW50cy4NCgkJICoNCgkJICogQGV2ZW50IFNjcm9sbFNjZW5lLmRlc3Ryb3kNCgkJICogQHNpbmNlIDEuMS4wDQoJCSAqDQoJCSAqIEBleGFtcGxlDQoJCSAqIHNjZW5lLm9uKCJlbnRlciIsIGZ1bmN0aW9uIChldmVudCkgew0KCQkgKiAgICAgICAgLy8gYWRkIGN1c3RvbSBhY3Rpb24NCgkJICogICAgICAgICQoIiNteS1lbGVtIikubGVmdCgiMjAwIik7DQoJCSAqICAgICAgfSkNCgkJICogICAgICAub24oImRlc3Ryb3kiLCBmdW5jdGlvbiAoZXZlbnQpIHsNCgkJICogICAgICAgIC8vIHJlc2V0IG15IGVsZW1lbnQgdG8gc3RhcnQgcG9zaXRpb24NCgkJICogICAgICAgIGlmIChldmVudC5yZXNldCkgew0KCQkgKiAgICAgICAgICAkKCIjbXktZWxlbSIpLmxlZnQoIjAiKTsNCgkJICogICAgICAgIH0NCgkJICogICAgICB9KTsNCgkJICoNCgkJICogQHByb3BlcnR5IHtvYmplY3R9IGV2ZW50IC0gVGhlIGV2ZW50IE9iamVjdCBwYXNzZWQgdG8gZWFjaCBjYWxsYmFjaw0KCQkgKiBAcHJvcGVydHkge3N0cmluZ30gZXZlbnQudHlwZSAtIFRoZSBuYW1lIG9mIHRoZSBldmVudA0KCQkgKiBAcHJvcGVydHkge1Njcm9sbFNjZW5lfSBldmVudC50YXJnZXQgLSBUaGUgU2Nyb2xsU2NlbmUgb2JqZWN0IHRoYXQgdHJpZ2dlcmVkIHRoaXMgZXZlbnQNCgkJICogQHByb3BlcnR5IHtib29sZWFufSBldmVudC5yZXNldCAtIEluZGljYXRlcyBpZiB0aGUgZGVzdHJveSBtZXRob2Qgd2FzIGNhbGxlZCB3aXRoIHJlc2V0IGB0cnVlYCBvciBgZmFsc2VgLg0KCQkgKi8NCgkJIA0KCQkgLyoqDQoJCSAqIEFkZCBvbmUgb3JlIG1vcmUgZXZlbnQgbGlzdGVuZXIuICANCgkJICogVGhlIGNhbGxiYWNrIGZ1bmN0aW9uIHdpbGwgYmUgZmlyZWQgYXQgdGhlIHJlc3BlY3RpdmUgZXZlbnQsIGFuZCBhbiBvYmplY3QgY29udGFpbmluZyByZWxldmFudCBkYXRhIHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjay4NCgkJICogQHB1YmxpYw0KCQkgKg0KCQkgKiBAZXhhbXBsZQ0KCQkgKiBmdW5jdGlvbiBjYWxsYmFjayAoZXZlbnQpIHsNCgkJICogCQljb25zb2xlLmxvZygiRXZlbnQgZmlyZWQhICgiICsgZXZlbnQudHlwZSArICIpIik7DQoJCSAqIH0NCgkJICogLy8gYWRkIGxpc3RlbmVycw0KCQkgKiBzY2VuZS5vbigiY2hhbmdlIHVwZGF0ZSBwcm9ncmVzcyBzdGFydCBlbmQgZW50ZXIgbGVhdmUiLCBjYWxsYmFjayk7DQoJCSAqDQoJCSAqIEBwYXJhbSB7c3RyaW5nfSBuYW1lIC0gVGhlIG5hbWUgb3IgbmFtZXMgb2YgdGhlIGV2ZW50IHRoZSBjYWxsYmFjayBzaG91bGQgYmUgYXR0YWNoZWQgdG8uDQoJCSAqIEBwYXJhbSB7ZnVuY3Rpb259IGNhbGxiYWNrIC0gQSBmdW5jdGlvbiB0aGF0IHNob3VsZCBiZSBleGVjdXRlZCwgd2hlbiB0aGUgZXZlbnQgaXMgZGlzcGF0Y2hlZC4gQW4gZXZlbnQgb2JqZWN0IHdpbGwgYmUgcGFzc2VkIHRvIHRoZSBjYWxsYmFjay4NCgkJICogQHJldHVybnMge1Njcm9sbFNjZW5lfSBQYXJlbnQgb2JqZWN0IGZvciBjaGFpbmluZy4NCgkJICovDQoJCSB0aGlzLm9uID0gZnVuY3Rpb24gKG5hbWUsIGNhbGxiYWNrKSB7DQoJCQlpZiAoJC5pc0Z1bmN0aW9uKGNhbGxiYWNrKSkgew0KCQkJCXZhciBuYW1lcyA9ICQudHJpbShuYW1lKS50b0xvd2VyQ2FzZSgpDQoJCQkJCQkJLnJlcGxhY2UoLyhcdyspXC4oXHcrKS9nLCAnJDEuJyArIE5BTUVTUEFDRSArICdfJDInKSAvLyBhZGQgY3VzdG9tIG5hbWVzcGFjZSwgaWYgb25lIGlzIGRlZmluZWQNCgkJCQkJCQkucmVwbGFjZSgvKCB8XikoXHcrKSg/PSB8JCkvZywgJyQxJDIuJyArIE5BTUVTUEFDRSApOyAvLyBhZGQgbmFtZXNwYWNlIHRvIHJlZ3VsYXJzLg0KCQkJCSQoU2Nyb2xsU2NlbmUpLm9uKG5hbWVzLCBjYWxsYmFjayk7DQoJCQl9IGVsc2Ugew0KCQkJCWxvZygxLCAiRVJST1IgY2FsbGluZyBtZXRob2QgJ29uKCknOiBTdXBwbGllZCBhcmd1bWVudCBpcyBub3QgYSB2YWxpZCBjYWxsYmFjayEiKTsNCgkJCX0NCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJIH07DQoNCgkJIC8qKg0KCQkgKiBSZW1vdmUgb25lIG9yIG1vcmUgZXZlbnQgbGlzdGVuZXIuDQoJCSAqIEBwdWJsaWMNCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogZnVuY3Rpb24gY2FsbGJhY2sgKGV2ZW50KSB7DQoJCSAqIAkJY29uc29sZS5sb2coIkV2ZW50IGZpcmVkISAoIiArIGV2ZW50LnR5cGUgKyAiKSIpOw0KCQkgKiB9DQoJCSAqIC8vIGFkZCBsaXN0ZW5lcnMNCgkJICogc2NlbmUub24oImNoYW5nZSB1cGRhdGUiLCBjYWxsYmFjayk7DQoJCSAqIC8vIHJlbW92ZSBsaXN0ZW5lcnMNCgkJICogc2NlbmUub2ZmKCJjaGFuZ2UgdXBkYXRlIiwgY2FsbGJhY2spOw0KCQkgKg0KCQkgKiBAcGFyYW0ge3N0cmluZ30gbmFtZSAtIFRoZSBuYW1lIG9yIG5hbWVzIG9mIHRoZSBldmVudCB0aGF0IHNob3VsZCBiZSByZW1vdmVkLg0KCQkgKiBAcGFyYW0ge2Z1bmN0aW9ufSBbY2FsbGJhY2tdIC0gQSBzcGVjaWZpYyBjYWxsYmFjayBmdW5jdGlvbiB0aGF0IHNob3VsZCBiZSByZW1vdmVkLiBJZiBub25lIGlzIHBhc3NlZCBhbGwgY2FsbGJhY2tzIHRvIHRoZSBldmVudCBsaXN0ZW5lciB3aWxsIGJlIHJlbW92ZWQuDQoJCSAqIEByZXR1cm5zIHtTY3JvbGxTY2VuZX0gUGFyZW50IG9iamVjdCBmb3IgY2hhaW5pbmcuDQoJCSAqLw0KCQkgdGhpcy5vZmYgPSBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHsNCgkJCXZhciBuYW1lcyA9ICQudHJpbShuYW1lKS50b0xvd2VyQ2FzZSgpDQoJCQkJCQkucmVwbGFjZSgvKFx3KylcLihcdyspL2csICckMS4nICsgTkFNRVNQQUNFICsgJ18kMicpIC8vIGFkZCBjdXN0b20gbmFtZXNwYWNlLCBpZiBvbmUgaXMgZGVmaW5lZA0KCQkJCQkJLnJlcGxhY2UoLyggfF4pKFx3KykoPz0gfCQpL2csICckMSQyLicgKyBOQU1FU1BBQ0UgKyAnJDMnKTsgLy8gYWRkIG5hbWVzcGFjZSB0byByZWd1bGFycy4NCgkJCSQoU2Nyb2xsU2NlbmUpLm9mZihuYW1lcywgY2FsbGJhY2spOw0KCQkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCQkgfTsNCg0KCQkgLyoqDQoJCSAqIFRyaWdnZXIgYW4gZXZlbnQuDQoJCSAqIEBwdWJsaWMNCgkJICoNCgkJICogQGV4YW1wbGUNCgkJICogdGhpcy50cmlnZ2VyKCJjaGFuZ2UiKTsNCgkJICoNCgkJICogQHBhcmFtIHtzdHJpbmd9IG5hbWUgLSBUaGUgbmFtZSBvZiB0aGUgZXZlbnQgdGhhdCBzaG91bGQgYmUgdHJpZ2dlcmVkLg0KCQkgKiBAcGFyYW0ge29iamVjdH0gW3ZhcnNdIC0gQW4gb2JqZWN0IGNvbnRhaW5pbmcgaW5mbyB0aGF0IHNob3VsZCBiZSBwYXNzZWQgdG8gdGhlIGNhbGxiYWNrLg0KCQkgKiBAcmV0dXJucyB7U2Nyb2xsU2NlbmV9IFBhcmVudCBvYmplY3QgZm9yIGNoYWluaW5nLg0KCQkgKi8NCgkJIHRoaXMudHJpZ2dlciA9IGZ1bmN0aW9uIChuYW1lLCB2YXJzKSB7DQoJCQlsb2coMywgJ2V2ZW50IGZpcmVkOicsIG5hbWUsICItPiIsIHZhcnMpOw0KCQkJdmFyIGV2ZW50ID0gJC5FdmVudCgkLnRyaW0obmFtZSkudG9Mb3dlckNhc2UoKSwgdmFycyk7DQoJCQkkKFNjcm9sbFNjZW5lKS50cmlnZ2VyKGV2ZW50KTsNCgkJCXJldHVybiBTY3JvbGxTY2VuZTsNCgkJIH07DQoNCgkJLy8gSU5JVA0KCQljb25zdHJ1Y3QoKTsNCgkJcmV0dXJuIFNjcm9sbFNjZW5lOw0KCX07DQoNCgkvKg0KCSAqIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCgkgKiBnbG9iYWwgbG9nZ2luZyBmdW5jdGlvbnMgYW5kIG1ha2luZyBzdXJlIG5vIGNvbnNvbGUgZXJyb3JzIG9jY3VyDQoJICogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KCSAqLw0KDQoJdmFyIGRlYnVnID0gKGZ1bmN0aW9uIChjb25zb2xlKSB7DQoJCXZhciBsb2dsZXZlbHMgPSBbImVycm9yIiwgIndhcm4iLCAibG9nIl07DQoJCWlmICghY29uc29sZS5sb2cpIHsNCgkJCWNvbnNvbGUubG9nID0gZnVuY3Rpb24oKXt9OyAvLyBubyBjb25zb2xlIGxvZywgd2VsbCAtIGRvIG5vdGhpbmcgdGhlbi4uLg0KCQl9DQoJCWZvcih2YXIgaSA9IDAsIG1ldGhvZDsgaTxsb2dsZXZlbHMubGVuZ3RoOyBpKyspIHsgLy8gbWFrZSBzdXJlIG1ldGhvZHMgZm9yIGFsbCBsZXZlbHMgZXhpc3QuDQoJCQltZXRob2QgPSBsb2dsZXZlbHNbaV07DQoJCQlpZiAoIWNvbnNvbGVbbWV0aG9kXSkgew0KCQkJCWNvbnNvbGVbbWV0aG9kXSA9IGNvbnNvbGUubG9nOyAvLyBwcmVmZXIgLmxvZyBvdmVyIG5vdGhpbmcNCgkJCX0NCgkJfQ0KCQkvLyBkZWJ1Z2dpbmcgZnVuY3Rpb24NCgkJcmV0dXJuIGZ1bmN0aW9uIChsb2dsZXZlbCkgew0KCQkJaWYgKGxvZ2xldmVsID4gbG9nbGV2ZWxzLmxlbmd0aCB8fCBsb2dsZXZlbCA8PSAwKSBsb2dsZXZlbCA9IGxvZ2xldmVscy5sZW5ndGg7DQoJCQl2YXIgbm93ID0gbmV3IERhdGUoKSwNCgkJCQl0aW1lID0gKCIwIitub3cuZ2V0SG91cnMoKSkuc2xpY2UoLTIpICsgIjoiICsgKCIwIitub3cuZ2V0TWludXRlcygpKS5zbGljZSgtMikgKyAiOiIgKyAoIjAiK25vdy5nZXRTZWNvbmRzKCkpLnNsaWNlKC0yKSArICI6IiArICgiMDAiK25vdy5nZXRNaWxsaXNlY29uZHMoKSkuc2xpY2UoLTMpLA0KCQkJCW1ldGhvZCA9IGxvZ2xldmVsc1tsb2dsZXZlbC0xXSwNCgkJCQlhcmdzID0gQXJyYXkucHJvdG90eXBlLnNwbGljZS5jYWxsKGFyZ3VtZW50cywgMSksDQoJCQkJZnVuYyA9IEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kLmNhbGwoY29uc29sZVttZXRob2RdLCBjb25zb2xlKTsNCg0KCQkJYXJncy51bnNoaWZ0KHRpbWUpOw0KCQkJZnVuYy5hcHBseShjb25zb2xlLCBhcmdzKTsNCgkJfTsNCgl9KHdpbmRvdy5jb25zb2xlID0gd2luZG93LmNvbnNvbGUgfHwge30pKTsNCgkvLyBhIGhlbHBlciBmdW5jdGlvbiB0aGF0IHNob3VsZCBnZW5lcmFsbHkgYmUgZmFzdGVyIHRoYW4galF1ZXJ5Lm9mZnNldCgpIGFuZCBjYW4gYWxzbyByZXR1cm4gcG9zaXRpb24gaW4gcmVsYXRpb24gdG8gdmlld3BvcnQuDQoJdmFyIGdldE9mZnNldCA9IGZ1bmN0aW9uIChlbGVtLCByZWxhdGl2ZVRvVmlld3BvcnQpIHsNCgkJdmFyIG9mZnNldCA9IHt0b3A6IDAsIGxlZnQ6IDB9Ow0KCQllbGVtID0gZWxlbVswXTsgLy8gdG1wIHdvcmthcm91bmQgdW50aWwgalF1ZXJ5IGRlcGVuZGVuY3kgaXMgcmVtb3ZlZC4NCgkJaWYgKGVsZW0gJiYgZWxlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QpIHsgLy8gY2hlY2sgaWYgYXZhaWxhYmxlDQoJCQl2YXIgcmVjdCA9IGVsZW0uZ2V0Qm91bmRpbmdDbGllbnRSZWN0KCk7DQoJCQlvZmZzZXQudG9wID0gcmVjdC50b3A7DQoJCQlvZmZzZXQubGVmdCA9IHJlY3QubGVmdDsNCgkJCWlmICghcmVsYXRpdmVUb1ZpZXdwb3J0KSB7IC8vIGNsaWVudFJlY3QgaXMgYnkgZGVmYXVsdCByZWxhdGl2ZSB0byB2aWV3cG9ydC4uLg0KCQkJCW9mZnNldC50b3AgKz0gKHdpbmRvdy5wYWdlWU9mZnNldCB8fCBkb2N1bWVudC5zY3JvbGxUb3AgIHx8IDApIC0gKGRvY3VtZW50LmNsaWVudFRvcCAgfHwgMCk7DQoJCQkJb2Zmc2V0LmxlZnQgKz0gKHdpbmRvdy5wYWdlWE9mZnNldCB8fCBkb2N1bWVudC5zY3JvbGxMZWZ0ICB8fCAwKSAtIChkb2N1bWVudC5jbGllbnRMZWZ0IHx8IDApOw0KCQkJfQ0KCQl9DQoJCXJldHVybiBvZmZzZXQ7DQoJfTsNCgl2YXIgaXNEb21FbGVtZW50ID0gZnVuY3Rpb24gKG8pew0KCQlyZXR1cm4gKA0KCQkJdHlwZW9mIEhUTUxFbGVtZW50ID09PSAib2JqZWN0IiA/IG8gaW5zdGFuY2VvZiBIVE1MRWxlbWVudCA6IC8vRE9NMg0KCQkJbyAmJiB0eXBlb2YgbyA9PT0gIm9iamVjdCIgJiYgbyAhPT0gbnVsbCAmJiBvLm5vZGVUeXBlID09PSAxICYmIHR5cGVvZiBvLm5vZGVOYW1lPT09InN0cmluZyINCgkJKTsNCgl9Ow0KCXZhciBpc01hcmdpbkNvbGxhcHNlVHlwZSA9IGZ1bmN0aW9uIChzdHIpIHsNCgkJcmV0dXJuIFsiYmxvY2siLCAiZmxleCIsICJsaXN0LWl0ZW0iLCAidGFibGUiLCAiLXdlYmtpdC1ib3giXS5pbmRleE9mKHN0cikgPiAtMTsNCgl9Ow0KCS8vIGltcGxlbWVudGF0aW9uIG9mIHJlcXVlc3RBbmltYXRpb25GcmFtZQ0KCXZhciBhbmltYXRpb25GcmFtZUNhbGxiYWNrID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZTsNCgl2YXIgYW5pbWF0aW9uRnJhbWVDYW5jZWxDYWxsYmFjayA9IHdpbmRvdy5jYW5jZWxBbmltYXRpb25GcmFtZTsNCg0KCS8vIHBvbHlmaWxsIC0+IGJhc2VkIG9uIGh0dHBzOi8vZ2lzdC5naXRodWIuY29tL3BhdWxpcmlzaC8xNTc5NjcxDQoJKGZ1bmN0aW9uICh3aW5kb3cpIHsNCgkJdmFyDQoJCQlsYXN0VGltZSA9IDAsDQoJCQl2ZW5kb3JzID0gWydtcycsICdtb3onLCAnd2Via2l0JywgJ28nXSwNCgkJCWk7DQoNCgkJLy8gdHJ5IHZlbmRvciBwcmVmaXhlcyBpZiB0aGUgYWJvdmUgZG9lc24ndCB3b3JrDQoJCWZvciAoaSA9IDA7ICFhbmltYXRpb25GcmFtZUNhbGxiYWNrICYmIGkgPCB2ZW5kb3JzLmxlbmd0aDsgKytpKSB7DQoJCQlhbmltYXRpb25GcmFtZUNhbGxiYWNrID0gd2luZG93W3ZlbmRvcnNbaV0gKyAnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107DQoJCQlhbmltYXRpb25GcmFtZUNhbmNlbENhbGxiYWNrID0gd2luZG93W3ZlbmRvcnNbaV0gKyAnQ2FuY2VsQW5pbWF0aW9uRnJhbWUnXSB8fCB3aW5kb3dbdmVuZG9yc1tpXSArICdDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTsNCgkJfQ0KDQoJCS8vIGZhbGxiYWNrcw0KCQlpZiAoIWFuaW1hdGlvbkZyYW1lQ2FsbGJhY2spIHsNCgkJCWFuaW1hdGlvbkZyYW1lQ2FsbGJhY2sgPSBmdW5jdGlvbiAoY2FsbGJhY2spIHsNCgkJCQl2YXINCgkJCQkJY3VyclRpbWUgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKSwNCgkJCQkJdGltZVRvQ2FsbCA9IE1hdGgubWF4KDAsIDE2IC0gKGN1cnJUaW1lIC0gbGFzdFRpbWUpKSwNCgkJCQkJaWQgPSB3aW5kb3cuc2V0VGltZW91dChmdW5jdGlvbiAoKSB7IGNhbGxiYWNrKGN1cnJUaW1lICsgdGltZVRvQ2FsbCk7IH0sIHRpbWVUb0NhbGwpOw0KCQkJCWxhc3RUaW1lID0gY3VyclRpbWUgKyB0aW1lVG9DYWxsOw0KCQkJCXJldHVybiBpZDsNCgkJCX07DQoJCX0NCgkJaWYgKCFhbmltYXRpb25GcmFtZUNhbmNlbENhbGxiYWNrKSB7DQoJCQlhbmltYXRpb25GcmFtZUNhbmNlbENhbGxiYWNrID0gZnVuY3Rpb24gKGlkKSB7DQoJCQkJd2luZG93LmNsZWFyVGltZW91dChpZCk7DQoJCQl9Ow0KCQl9DQoJfSh3aW5kb3cpKTsNCg0KCXJldHVybiB7DQoJCUNvbnRyb2xsZXI6IFNjcm9sbE1hZ2ljLA0KCQlTY2VuZTogU2Nyb2xsU2NlbmUsDQoJfTsNCn0pKTsNCg==
----field----
field: {C06867FE-9A43-4C7D-B739-48780492D06F}
name: Extension
key: extension
content-length: 2

js
----field----
field: {6F47A0A5-9C94-4B48-ABEB-42D38DEF6054}
name: Mime Type
key: mime type
content-length: 24

application/x-javascript
----field----
field: {6954B7C7-2487-423F-8600-436CB3B6DC0E}
name: Size
key: size
content-length: 5

98494
----field----
field: {06D5295C-ED2F-4A54-9BF2-26228D113318}
name: __Icon
key: __icon
content-length: 61

-/media/409690cb37944924a61ff7de0d4743eb.ashx?h=16&thn=1&w=16
----version----
language: en
version: 1
revision: b62a2118-1917-42ae-ab93-9ef5bc394acb

----field----
field: {52807595-0F8F-4B20-8D2A-CB71D28C6103}
name: __Owner
key: __owner
content-length: 19

sitecore\tf-suneeth
----field----
field: {25BED78C-4957-4165-998A-CA1B52F67497}
name: __Created
key: __created
content-length: 16

20210728T054831Z
----field----
field: {5DD74568-4D4B-44C1-B513-0AF5F4CDA34F}
name: __Created by
key: __created by
content-length: 19

sitecore\tf-suneeth
----field----
field: {8CDC337E-A112-42FB-BBB4-4143751E123F}
name: __Revision
key: __revision
content-length: 36

b62a2118-1917-42ae-ab93-9ef5bc394acb
----field----
field: {D9CF14B1-FA16-4BA6-9288-E8A174D4D522}
name: __Updated
key: __updated
content-length: 16

20210728T054831Z
----field----
field: {BADD9CF9-53E0-4D0C-BCC0-2D784C282F6A}
name: __Updated by
key: __updated by
content-length: 19

sitecore\tf-suneeth
